<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì—°ì°¨ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
  
  <!-- ğŸ¨ CSS ìŠ¤íƒ€ì¼ -->
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f5f6fa;
      line-height: 1.6;
    }
    
    /* ğŸ” í—¤ë” */
    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 1rem 2rem;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      position: sticky;
      top: 0;
      z-index: 1000;
    }
    
    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .logo {
      font-size: 1.5rem;
      font-weight: 700;
    }
    
    .header-right {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    
    .notification-icon {
      position: relative;
      background: rgba(255,255,255,0.2);
      border: none;
      color: white;
      padding: 0.5rem;
      border-radius: 50%;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .notification-icon:hover {
      background: rgba(255,255,255,0.3);
    }
    
    .notification-badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background: #ff4757;
      color: white;
      border-radius: 50%;
      padding: 2px 6px;
      font-size: 0.7rem;
      font-weight: bold;
      display: none;
    }
    
    .user-menu {
      position: relative;
    }
    
    .user-button {
      background: rgba(255,255,255,0.2);
      border: none;
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 25px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      transition: all 0.3s ease;
    }
    
    .user-button:hover {
      background: rgba(255,255,255,0.3);
    }
    
    .user-dropdown {
      position: absolute;
      top: 100%;
      right: 0;
      background: white;
      border-radius: 8px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
      padding: 0.5rem 0;
      min-width: 200px;
      display: none;
      z-index: 1001;
      color: #333;
    }
    
    .user-dropdown a {
      display: block;
      padding: 0.75rem 1rem;
      color: #333;
      text-decoration: none;
      transition: background 0.2s ease;
      cursor: pointer;
    }
    
    .user-dropdown a:hover {
      background: #f8f9fa;
    }
    
    /* ğŸ“± ì‚¬ì´ë“œë°” */
    .sidebar {
      width: 250px;
      background: white;
      height: calc(100vh - 70px);
      position: fixed;
      left: 0;
      top: 70px;
      box-shadow: 2px 0 10px rgba(0,0,0,0.1);
      overflow-y: auto;
      transition: transform 0.3s ease;
    }
    
    .sidebar.hidden {
      transform: translateX(-100%);
    }
    
    .menu-item {
      display: block;
      padding: 1rem 1.5rem;
      color: #333;
      text-decoration: none;
      border-bottom: 1px solid #eee;
      transition: all 0.3s ease;
      cursor: pointer;
    }
    
    .menu-item:hover {
      background: #f8f9fa;
      padding-left: 2rem;
    }
    
    .menu-item.active {
      background: #667eea;
      color: white;
      border-left: 4px solid #5a67d8;
    }
    
    .menu-item .icon {
      margin-right: 0.5rem;
    }
    
    /* ğŸ“„ ë©”ì¸ ì½˜í…ì¸  */
    .main-content {
      margin-left: 250px;
      padding: 2rem;
      min-height: calc(100vh - 70px);
      transition: margin-left 0.3s ease;
    }
    
    .main-content.full-width {
      margin-left: 0;
    }
    
    .page {
      display: none;
      animation: fadeIn 0.3s ease-in;
    }
    
    .page.active {
      display: block;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .page-header {
      background: white;
      padding: 1.5rem;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      margin-bottom: 2rem;
    }
    
    .page-title {
      font-size: 1.8rem;
      font-weight: 700;
      color: #333;
      margin-bottom: 0.5rem;
    }
    
    .page-subtitle {
      color: #666;
    }
    
    /* ğŸ  ëŒ€ì‹œë³´ë“œ í—¤ë” ì–‘ìª½ ì •ë ¬ ìŠ¤íƒ€ì¼ */
    .dashboard-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 2rem;
    }
    
    .dashboard-title-section {
      flex: 1;
    }
    
    .dashboard-dept-section {
      flex-shrink: 0;
    }
    
    .dept-badge {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 0.75rem 1.5rem;
      border-radius: 25px;
      font-size: 1rem;
      font-weight: 600;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .dept-badge:before {
      content: "ğŸ¢";
      font-size: 1.1rem;
    }
    
    .dept-badge:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }
    
    /* ë¶€ì„œ ë°°ì§€ ë¡œë”© ìƒíƒœ */
    .dept-badge.loading-badge {
      background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
      animation: pulse-loading 1.5s ease-in-out infinite;
    }
    
    .dept-badge.loading-badge:before {
      content: "â³";
    }
    
    .loading-dots::after {
      content: '...';
      animation: dots 1.5s steps(4, end) infinite;
    }
    
         @keyframes pulse-loading {
       0%, 100% { 
         opacity: 0.7;
         transform: scale(1);
       }
       50% { 
         opacity: 1;
         transform: scale(1.02);
       }
     }
     
     @keyframes dots {
       0%, 20% { 
         color: rgba(255,255,255,0.4);
         text-shadow: 
           .25em 0 0 rgba(255,255,255,0.4),
           .5em 0 0 rgba(255,255,255,0.4);
       }
       40% { 
         color: white;
         text-shadow: 
           .25em 0 0 rgba(255,255,255,0.4),
           .5em 0 0 rgba(255,255,255,0.4);
       }
       60% { 
         text-shadow: 
           .25em 0 0 white,
           .5em 0 0 rgba(255,255,255,0.4);
       }
       80%, 100% { 
         text-shadow: 
           .25em 0 0 white,
           .5em 0 0 white;
       }
     }
     
     @keyframes shimmer {
       0% {
         background-position: -200% 0;
       }
       100% {
         background-position: 200% 0;
       }
     }
    
    /* ğŸ“… ê·¼ë¬´í‘œ ìŠ¤íƒ€ì¼ */
    .schedule-controls {
      background: white;
      padding: 1.5rem;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      margin-bottom: 2rem;
    }
    
    .work-schedule-container {
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }
    
    .work-schedule-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.85rem;
      table-layout: fixed;
    }
    
    .work-schedule-table th,
    .work-schedule-table td {
      border: 1px solid #e0e0e0;
      padding: 0.4rem;
      text-align: center;
      vertical-align: middle;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    
    .work-schedule-table th {
      background: #f8f9fa;
      font-weight: 600;
      color: #495057;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    
    /* ì œëª© í–‰ */
    .schedule-title {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      font-size: 1.2rem;
      font-weight: 700;
      text-align: center;
      padding: 1rem;
    }
    
    /* í—¤ë” í–‰ */
    .schedule-header {
      background: #e3f2fd;
      font-weight: 600;
      color: #1976d2;
    }
    
    /* ì§ì› ì •ë³´ ì—´ */
    .employee-info {
      background: #f8f9fa;
      font-weight: 500;
      text-align: left;
      padding-left: 0.8rem;
    }
    
    /* ì£¼ë§ ìƒ‰ìƒ */
    .weekend-saturday {
      background-color: #e3f2fd !important;
      color: #1976d2;
    }
    
    .weekend-sunday,
    .holiday {
      background-color: #ffebee !important;
      color: #d32f2f;
    }
    
    /* ì—°ì°¨ í‘œì‹œ */
    .leave-full {
      background-color: #c8e6c9 !important;
      color: #2e7d32;
      font-weight: bold;
    }
    
    .leave-half {
      background-color: #fff3e0 !important;
      color: #f57c00;
      font-weight: bold;
    }
    
    /* ê·¼ë¬´ì¼ */
    .work-day {
      background-color: #fafafa;
    }
    
    /* ì‚¬ìš©ì ë¶€ì„œ ì •ë³´ */
    .user-dept-info {
      margin-bottom: 1.5rem;
    }
    
    .dept-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1rem;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 8px;
      font-weight: 600;
      box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
    }
    
    .dept-icon {
      font-size: 1.2rem;
    }
    
    .dept-name {
      font-size: 1rem;
    }

    /* ë¡œë”© ìƒíƒœ ìŠ¤íƒ€ì¼ */
    .loading-badge {
      opacity: 0.6;
      position: relative;
    }

    .loading-badge::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 16px;
      height: 16px;
      margin: -8px 0 0 -8px;
      border: 2px solid #f3f3f3;
      border-top: 2px solid #007bff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    /* ë¡œë”© ìƒíƒœ */
    .schedule-loading {
      text-align: center;
      padding: 3rem;
      color: #666;
    }
    
    .schedule-loading .spinner {
      margin: 0 auto 1rem;
    }

    /* ë¹ˆ ìƒíƒœ ìŠ¤íƒ€ì¼ */
    .empty-state, .error-state, .loading-state {
      text-align: center;
      padding: 60px 20px;
      color: #666;
    }

    .empty-icon, .error-icon {
      font-size: 48px;
      margin-bottom: 16px;
    }

    .empty-state h3, .error-state h3 {
      margin: 16px 0 8px 0;
      color: #333;
    }

    .empty-state p, .error-state p {
      margin: 8px 0 24px 0;
      color: #666;
    }

    /* ë¡œë”© ìŠ¤í”¼ë„ˆ */
    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 4px solid #f3f3f3;
      border-top: 4px solid #007bff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 16px auto;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* ğŸ“Š ëŒ€ì‹œë³´ë“œ ì¹´ë“œ */
    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }
    
    .dashboard-card {
      background: white;
      padding: 1.5rem;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      transition: transform 0.3s ease;
    }
    
    .dashboard-card:hover {
      transform: translateY(-5px);
    }
    
    .card-icon {
      font-size: 2rem;
      margin-bottom: 1rem;
    }
    
    .card-value {
      font-size: 2rem;
      font-weight: 700;
      color: #333;
      margin-bottom: 0.5rem;
    }
    
    .card-label {
      color: #666;
      font-size: 0.9rem;
    }
    
    /* ğŸ“ í¼ ìŠ¤íƒ€ì¼ */
    .form-container {
      background: white;
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }
    
    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    
    .form-group {
      margin-bottom: 1rem;
    }
    
    .form-group label {
      display: block;
      color: #333;
      font-weight: 600;
      margin-bottom: 0.5rem;
      font-size: 0.9rem;
    }
    
    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 1rem;
      transition: all 0.3s ease;
    }
    
    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    .form-group textarea {
      resize: vertical;
      min-height: 100px;
    }
    
    /* ë¡œë”© ìƒíƒœ ì…ë ¥ í•„ë“œ */
    .loading-input {
      background: linear-gradient(90deg, #f8f9fa 0%, #e9ecef 50%, #f8f9fa 100%) !important;
      background-size: 200% 100% !important;
      animation: shimmer 1.5s ease-in-out infinite !important;
      color: #6c757d !important;
      font-style: italic !important;
    }
    
    /* ğŸ”˜ ë²„íŠ¼ */
    .btn {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-block;
      text-align: center;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
    }
    
    .btn-success {
      background: #2ed573;
      color: white;
    }
    
    .btn-danger {
      background: #ff4757;
      color: white;
    }
    
    .btn-secondary {
      background: #747d8c;
      color: white;
    }
    
    .btn:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    /* ğŸ“‹ í…Œì´ë¸” */
    .table-container {
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      overflow: hidden;
    }
    
    .table {
      width: 100%;
      border-collapse: collapse;
    }
    
    .table th,
    .table td {
      padding: 1rem;
      text-align: left;
      border-bottom: 1px solid #eee;
    }
    
    .table th {
      background: #f8f9fa;
      font-weight: 600;
      color: #333;
    }
    
    .table tr:hover {
      background: #f8f9fa;
    }
    
    /* ğŸ·ï¸ ìƒíƒœ ë¼ë²¨ */
    .status-badge {
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
    }
    
    .status-pending {
      background: #fff3cd;
      color: #856404;
    }
    
    .status-approved {
      background: #d4edda;
      color: #155724;
    }
    
    .status-rejected {
      background: #f8d7da;
      color: #721c24;
    }
    
    /* ğŸ“± ëª¨ë°”ì¼ ë°˜ì‘í˜• */
    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
      }
      
      .sidebar.visible {
        transform: translateX(0);
      }
      
      .main-content {
        margin-left: 0;
        padding: 1rem;
      }
      
      .header-content {
        padding: 0 1rem;
      }
      
      .dashboard-grid {
        grid-template-columns: 1fr;
      }
      
      .form-grid {
        grid-template-columns: 1fr;
      }
      
      /* ì§ì› ê´€ë¦¬ ëª¨ë°”ì¼ ìµœì í™” */
      .section-header {
        flex-direction: column;
        align-items: stretch;
        gap: 1rem;
      }
      
      .search-controls {
        flex-direction: column;
        gap: 0.75rem;
      }
      
      .search-input {
        width: 100%;
      }
      
      .btn-reset {
        width: 100%;
        justify-content: center;
      }
      
      /* ëª¨ë°”ì¼ì—ì„œ í…Œì´ë¸” ìŠ¤í¬ë¡¤ */
      .table-container {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }
      
      .employee-table {
        min-width: 650px;
      }
      
      .employee-table .btn {
        padding: 0.3rem 0.6rem;
        font-size: 0.8rem;
        min-width: 50px;
      }
      
      .employee-table .btn-text {
        display: none;
      }
      
      .employee-table .btn-icon {
        font-size: 1rem;
      }
      
      .info-banner {
        flex-direction: column;
        text-align: center;
      }
      
      .info-icon {
        align-self: center;
        margin-top: 0;
      }
      
      .btn-large {
        width: 100%;
        padding: 1rem;
      }
    }
    
    @media (max-width: 480px) {
      .search-input {
        font-size: 16px; /* iOSì—ì„œ ì¤Œ ë°©ì§€ */
      }
      
      .employee-table th,
      .employee-table td {
        padding: 0.75rem 0.5rem;
      }
      
      .col-email {
        min-width: 150px;
      }
    }
    
    /* ğŸ’¬ ë©”ì‹œì§€ */
    .alert {
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 1rem;
      border-left: 4px solid;
    }
    
    .alert-success {
      background: #d4edda;
      color: #155724;
      border-color: #28a745;
    }
    
    .alert-error {
      background: #f8d7da;
      color: #721c24;
      border-color: #dc3545;
    }
    
    .alert-info {
      background: #d1ecf1;
      color: #0c5460;
      border-color: #17a2b8;
    }
    
    /* ğŸ‘¥ ì§ì› ê´€ë¦¬ í˜ì´ì§€ ì „ìš© ìŠ¤íƒ€ì¼ */
    .employee-form-section,
    .employee-list-section {
      margin-bottom: 2.5rem;
    }
    
    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 2px solid #e9ecef;
    }
    
    .section-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: #333;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    /* ì •ë³´ ë°°ë„ˆ ìŠ¤íƒ€ì¼ */
    .info-banner {
      background: linear-gradient(135deg, #e8f4fd 0%, #f1f8ff 100%);
      border: 1px solid #bee5eb;
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 2rem;
      display: flex;
      align-items: flex-start;
      gap: 1rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    
    .info-icon {
      font-size: 1.5rem;
      margin-top: 0.2rem;
    }
    
    .info-content {
      flex: 1;
      color: #0c5460;
    }
    
    .info-content strong {
      display: block;
      margin-bottom: 0.5rem;
      font-size: 1.1rem;
    }
    
    .info-list {
      margin: 0;
      padding-left: 1.2rem;
      list-style: none;
    }
    
    .info-list li {
      position: relative;
      margin-bottom: 0.3rem;
      padding-left: 0.5rem;
    }
    
    .info-list li::before {
      content: 'â€¢';
      position: absolute;
      left: -0.8rem;
      color: #667eea;
      font-weight: bold;
    }
    
    .info-list code {
      background: rgba(255, 255, 255, 0.8);
      padding: 0.2rem 0.4rem;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-weight: bold;
      color: #e74c3c;
    }
    
    /* í¼ ì•¡ì…˜ ë²„íŠ¼ ì˜ì—­ */
    .form-actions {
      text-align: center;
      margin-top: 2.5rem;
      padding-top: 2rem;
      border-top: 1px solid #e9ecef;
    }
    
    .btn-large {
      padding: 1rem 2.5rem;
      font-size: 1.1rem;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 0.7rem;
      min-width: 180px;
      justify-content: center;
    }
    
    .btn-icon {
      font-size: 1.2rem;
    }
    
    .btn-text {
      font-weight: 600;
    }
    
    /* ê²€ìƒ‰ ì»¨íŠ¸ë¡¤ */
    .search-controls {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    
    .search-input-wrapper {
      position: relative;
    }
    
    .search-input {
      padding: 0.75rem 1rem;
      border: 2px solid #e1e5e9;
      border-radius: 8px;
      width: 280px;
      font-size: 0.95rem;
      transition: all 0.3s ease;
      background-color: #f8f9fa;
    }
    
    .search-input:focus {
      outline: none;
      border-color: #667eea;
      background-color: white;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    .btn-reset {
      padding: 0.75rem 1.2rem;
      font-size: 0.9rem;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      min-width: 100px;
      justify-content: center;
    }
    
    /* ì§ì› í…Œì´ë¸” ê°œì„  */
    .employee-table {
      margin: 0;
    }
    
    .employee-table th {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      color: #495057;
      font-weight: 700;
      text-align: center;
      vertical-align: middle;
      padding: 1rem 0.75rem;
      border-bottom: 2px solid #dee2e6;
      white-space: nowrap;
    }
    
    .employee-table td {
      text-align: center;
      vertical-align: middle;
      padding: 1rem 0.75rem;
      border-bottom: 1px solid #e9ecef;
    }
    
    .employee-table tbody tr {
      transition: all 0.2s ease;
    }
    
    .employee-table tbody tr:hover {
      background-color: #f8f9fa;
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(102, 126, 234, 0.1);
    }
    
    /* í…Œì´ë¸” ì»¬ëŸ¼ ë„ˆë¹„ ì¡°ì • */
    .col-empid {
      width: 10%;
      min-width: 80px;
    }
    
    .col-name {
      width: 15%;
      min-width: 100px;
    }
    
    .col-email {
      width: 25%;
      min-width: 200px;
      text-align: left !important;
      padding-left: 1rem !important;
    }
    
    .col-dept {
      width: 15%;
      min-width: 100px;
    }
    
    .col-position {
      width: 15%;
      min-width: 100px;
    }
    
    .col-actions {
      width: 20%;
      min-width: 160px;
    }
    
    /* í…Œì´ë¸” ì•¡ì…˜ ë²„íŠ¼ */
    .employee-table .btn {
      padding: 0.4rem 0.8rem;
      font-size: 0.85rem;
      font-weight: 600;
      margin: 0 0.2rem;
      min-width: 60px;
    }
    
    /* ë¡œë”© ì…€ */
    .loading-cell {
      text-align: center !important;
      color: #6c757d;
      font-style: italic;
      padding: 2rem !important;
      background: linear-gradient(90deg, #f8f9fa 0%, #e9ecef 50%, #f8f9fa 100%);
      background-size: 200% 100%;
      animation: shimmer 1.5s ease-in-out infinite;
    }
    
    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }
    
    /* ë¹ˆ ë©”ì‹œì§€ ì…€ */
    .empty-message {
      text-align: center !important;
      color: #6c757d;
      font-style: italic;
      padding: 2.5rem !important;
      background: #f8f9fa;
      font-size: 1.1rem;
    }
    
    .search-empty-message {
      text-align: center !important;
      color: #856404;
      font-style: italic;
      padding: 2.5rem !important;
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      font-size: 1.1rem;
    }
    
    /* ğŸ”„ ë¡œë”© */
    .loading {
      text-align: center;
      padding: 2rem;
      color: #666;
    }
    
    .loading::after {
      content: '...';
      animation: dots 1.5s steps(4, end) infinite;
    }
    
    @keyframes dots {
      0%, 20% { content: '.'; }
      40% { content: '..'; }
      60% { content: '...'; }
      80%, 100% { content: ''; }
    }
    
    /* ì•Œë¦¼ ì• ë‹ˆë©”ì´ì…˜ */
    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    
    @keyframes slideOut {
      from {
        transform: translateX(0);
        opacity: 1;
      }
      to {
        transform: translateX(100%);
        opacity: 0;
      }
    }
    
    /* ë¡œë”© ìŠ¤í”¼ë„ˆ */
    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #3498db;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 2s linear infinite;
      margin-bottom: 10px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* ì„ íƒëœ ì§ì› ìŠ¤íƒ€ì¼ */
    .selected-employee {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.5rem;
      margin: 0.25rem 0;
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 6px;
    }

    .selected-employee .employee-name {
      font-weight: 600;
      color: #333;
    }

    .selected-employee .employee-dept {
      color: #666;
      font-size: 0.9rem;
    }

    .btn-remove {
      background: #dc3545;
      color: white;
      border: none;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      cursor: pointer;
      font-size: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .btn-remove:hover {
      background: #c82333;
    }
    
    /* ğŸ”§ ì§ì› ìˆ˜ì • ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    
    .modal-container {
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      width: 80%;
      max-width: 800px;
      max-height: 80vh;
      display: flex;
      flex-direction: column;
    }
    
    .modal-header {
      padding: 1rem;
      border-bottom: 1px solid #e9ecef;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .modal-header h3 {
      margin: 0;
      font-size: 1.25rem;
    }
    
    .close-button {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      padding: 0;
      color: #6c757d;
    }
    
    .close-button:hover {
      color: #343a40;
    }
    
    .modal-body {
      padding: 1rem;
      overflow-y: auto;
    }
    
    .search-box {
      margin-bottom: 1rem;
    }
    
    .search-box input {
      width: 100%;
      padding: 0.5rem;
      border: 1px solid #ced4da;
      border-radius: 4px;
      font-size: 1rem;
    }
    
    .employee-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 1rem;
    }
    
    .employee-item {
      border: 1px solid #e9ecef;
      border-radius: 4px;
      padding: 1rem;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .employee-item:hover {
      background-color: #f8f9fa;
      border-color: #dee2e6;
    }
    
    .employee-item.selected {
      background-color: #e7f5ff;
      border-color: #339af0;
    }
    
    .employee-info {
      flex: 1;
    }
    
    .employee-name {
      font-weight: 600;
      margin-bottom: 0.25rem;
    }
    
    .employee-position {
      color: #6c757d;
      font-size: 0.875rem;
    }
    
    .employee-dept {
      color: #495057;
      font-size: 0.875rem;
      padding-left: 1rem;
      border-left: 1px solid #dee2e6;
    }
    
    .modal-footer {
      padding: 1rem;
      border-top: 1px solid #e9ecef;
      display: flex;
      justify-content: flex-end;
      gap: 0.5rem;
    }
    
    .btn-modal {
      padding: 0.5rem 1rem;
      border-radius: 4px;
      border: none;
      cursor: pointer;
      font-size: 0.875rem;
      transition: all 0.2s ease;
    }
    
    .btn-modal-primary {
      background-color: #339af0;
      color: white;
    }
    
    .btn-modal-primary:hover {
      background-color: #228be6;
    }
    
    .btn-modal-secondary {
      background-color: #e9ecef;
      color: #495057;
    }
    
    .btn-modal-secondary:hover {
      background-color: #dee2e6;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    @keyframes slideIn {
      from { opacity: 0; transform: translateY(-50px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* ğŸ“„ í˜ì´ì§€ë„¤ì´ì…˜ ìŠ¤íƒ€ì¼ */
    .pagination-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 1.5rem 0;
      padding: 1rem;
      background: #f8f9fa;
      border-radius: 8px;
      border: 1px solid #e9ecef;
    }
    
    .pagination-info {
      color: #6c757d;
      font-size: 0.9rem;
      font-weight: 500;
    }
    
    .pagination-controls {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .pagination-btn {
      padding: 0.5rem 0.75rem;
      border: 1px solid #dee2e6;
      background: white;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 0.85rem;
      font-weight: 500;
      min-width: 40px;
      text-align: center;
      text-decoration: none;
    }
    
    .pagination-btn:hover {
      background: #e9ecef;
      border-color: #adb5bd;
    }
    
    .pagination-btn.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-color: #667eea;
    }
    
    .pagination-btn:disabled {
      background: #f8f9fa;
      color: #6c757d;
      cursor: not-allowed;
      opacity: 0.6;
    }
    
    .pagination-btn:disabled:hover {
      background: #f8f9fa;
      border-color: #dee2e6;
    }
    
    .pagination-select {
      padding: 0.4rem 0.6rem;
      border: 1px solid #dee2e6;
      border-radius: 6px;
      font-size: 0.85rem;
      margin-left: 0.5rem;
    }
    
    .pagination-select:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
    }
    
    /* í˜ì´ì§€ë„¤ì´ì…˜ ì„¤ì • */
    .pagination-settings {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.85rem;
      color: #6c757d;
    }
    
    /* ëª¨ë°”ì¼ ë°˜ì‘í˜• */
    @media (max-width: 768px) {
      .modal-container {
        width: 95%;
        max-height: 95vh;
        margin: 1rem;
      }
      
      .modal-header,
      .modal-body,
      .modal-footer {
        padding: 1rem;
      }
      
      .form-row {
        flex-direction: column;
        gap: 0;
      }
      
      .modal-footer {
        flex-direction: column;
        gap: 0.5rem;
      }
      
      .btn-modal {
        width: 100%;
        justify-content: center;
      }
      
      /* í˜ì´ì§€ë„¤ì´ì…˜ ëª¨ë°”ì¼ ìµœì í™” */
      .pagination-container {
        flex-direction: column;
        gap: 1rem;
        padding: 0.75rem;
      }
      
      .pagination-info {
        order: 2;
        text-align: center;
      }
      
      .pagination-controls {
        order: 1;
        flex-wrap: wrap;
        justify-content: center;
      }
      
      .pagination-settings {
        order: 3;
        justify-content: center;
      }
      
      .pagination-btn {
        padding: 0.4rem 0.6rem;
        font-size: 0.8rem;
        min-width: 35px;
      }
    }
    
    /* ğŸ¯ ë“œë˜ê·¸ ì•¤ ë“œë¡­ ë³´ë“œ ìŠ¤íƒ€ì¼ */
    
    /* ë·° ì „í™˜ íƒ­ ìŠ¤íƒ€ì¼ */
    .view-controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 1rem;
    }
    
    .view-tabs {
      display: flex;
      background: #f8f9fa;
      border-radius: 8px;
      padding: 0.25rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .view-tab {
      padding: 0.75rem 1.5rem;
      border: none;
      background: transparent;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-weight: 500;
      color: #6c757d;
    }
    
    .view-tab.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }
    
    .view-tab:hover:not(.active) {
      background: #e9ecef;
      color: #495057;
    }
    
    .tab-icon {
      font-size: 1.1rem;
    }
    
    .tab-text {
      font-weight: 600;
    }
    
    /* ì§ì› ë·° ì „í™˜ */
    .employee-view {
      display: none;
      animation: fadeIn 0.4s ease-in-out;
    }
    
    .employee-view.active {
      display: block;
    }
    
    /* ë¶€ì„œ ë·° ì „í™˜ */
    .department-view {
      display: none;
      animation: fadeIn 0.4s ease-in-out;
    }
    
    .department-view.active {
      display: block;
    }
    
    /* ë³´ë“œ ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ */
    .board-container {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
      overflow: hidden;
    }
    
    .board-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 1.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 1rem;
    }
    
    .board-title {
      font-size: 1.5rem;
      font-weight: 700;
      margin: 0;
    }
    
    .board-subtitle {
      color: rgba(255,255,255,0.9);
      margin: 0.5rem 0 0 0;
      font-size: 0.95rem;
    }
    
    .board-stats {
      display: flex;
      gap: 1.5rem;
      align-items: center;
    }
    
    .board-stat {
      background: rgba(255,255,255,0.2);
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-size: 0.9rem;
      font-weight: 500;
      backdrop-filter: blur(10px);
    }
    
    .board-stat strong {
      font-size: 1.1rem;
      font-weight: 700;
    }
    
    /* ğŸ¨ ì»´íŒ©íŠ¸í•œ ë¶€ì„œ ì¶”ê°€ í¼ ìŠ¤íƒ€ì¼ */
    .compact-form-section {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 16px;
      padding: 1.5rem;
      margin-bottom: 2rem;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      position: relative;
      overflow: hidden;
    }
    
    .compact-form-section::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
      pointer-events: none;
    }
    
    .compact-form-header {
      text-align: center;
      margin-bottom: 1.5rem;
      position: relative;
      z-index: 1;
    }
    
    .compact-form-title {
      color: #ffffff;
      font-size: 1.25rem;
      font-weight: 600;
      margin: 0;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }
    
    .compact-form {
      position: relative;
      z-index: 1;
    }
    
    .compact-form-row {
      display: flex;
      gap: 1rem;
      align-items: end;
      justify-content: center;
      flex-wrap: wrap;
    }
    
    .compact-form-group {
      display: flex;
      flex-direction: column;
      min-width: 200px;
    }
    
    .compact-form-group label {
      color: #ffffff;
      font-size: 0.9rem;
      font-weight: 500;
      margin-bottom: 0.5rem;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
    }
    
    .compact-form-group input {
      padding: 0.75rem 1rem;
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.95);
      font-size: 0.95rem;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }
    
    .compact-form-group input:focus {
      outline: none;
      border-color: #ffffff;
      background: #ffffff;
      box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.2);
      transform: translateY(-2px);
    }
    
    .compact-form-group input::placeholder {
      color: #6c757d;
      opacity: 0.7;
    }
    
    .btn-compact {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 8px;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      white-space: nowrap;
      text-transform: none;
      letter-spacing: -0.025em;
      min-height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }
    
    .btn-compact-primary {
      background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
      color: #ffffff;
      box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
    }
    
    .btn-compact-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(40, 167, 69, 0.4);
      background: linear-gradient(135deg, #218838 0%, #1e7e34 100%);
    }
    
    .btn-compact-primary:active {
      transform: translateY(0);
      box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
    }
    
    /* ğŸ¢ ë©”ì¸ ë¶€ì„œ ê´€ë¦¬ ì„¹ì…˜ */
    .department-management-main {
      background: #ffffff;
      border-radius: 16px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
      overflow: hidden;
      min-height: 600px;
    }
    
    .main-section-header {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      padding: 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #dee2e6;
      flex-wrap: wrap;
      gap: 1rem;
    }
    
    .section-title-area {
      flex: 1;
      min-width: 250px;
    }
    
    .main-section-title {
      color: #2c3e50;
      font-size: 1.5rem;
      font-weight: 700;
      margin: 0 0 0.5rem 0;
      letter-spacing: -0.025em;
    }
    
    .main-section-subtitle {
      color: #6c757d;
      font-size: 0.95rem;
      margin: 0;
      line-height: 1.5;
    }
    
    .view-controls {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    
    .view-tabs {
      display: flex;
      background: rgba(255, 255, 255, 0.8);
      border-radius: 12px;
      padding: 0.25rem;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      backdrop-filter: blur(10px);
    }
    
    .view-tab {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1.25rem;
      background: transparent;
      border: none;
      border-radius: 8px;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      white-space: nowrap;
      color: #6c757d;
    }
    
    .view-tab:hover {
      background: rgba(102, 126, 234, 0.1);
      color: #667eea;
      transform: translateY(-1px);
    }
    
    .view-tab.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #ffffff;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }
    
    .tab-icon {
      font-size: 1rem;
    }
    
    .tab-text {
      font-weight: 600;
    }
    
    /* ë¶€ì„œ ë·° ì»¨í…Œì´ë„ˆ */
    .department-view {
      display: none;
      animation: fadeIn 0.3s ease-in-out;
    }
    
    .department-view.active {
      display: block;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* ğŸ¯ ê°œì„ ëœ Kanban ë³´ë“œ ìŠ¤íƒ€ì¼ (ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ) */
    .kanban-board {
      padding: 1.5rem;
      display: grid;
      gap: 1.5rem;
      min-height: 500px;
      background: #f8f9fa;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      max-width: 100%;
    }
    
    /* ë¶€ì„œ ìˆ˜ì— ë”°ë¥¸ ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ ìµœì í™” */
    .kanban-board.departments-1 { grid-template-columns: 1fr; }
    .kanban-board.departments-2 { grid-template-columns: repeat(2, 1fr); }
    .kanban-board.departments-3 { grid-template-columns: repeat(3, 1fr); }
    .kanban-board.departments-4 { grid-template-columns: repeat(2, 1fr); }
    .kanban-board.departments-5 { grid-template-columns: repeat(3, 1fr); }
    .kanban-board.departments-6 { grid-template-columns: repeat(3, 1fr); }
    .kanban-board.departments-7 { grid-template-columns: repeat(4, 1fr); }
    .kanban-board.departments-8 { grid-template-columns: repeat(4, 1fr); }
    .kanban-board.departments-many { grid-template-columns: repeat(4, 1fr); }
    
    .board-loading {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      width: 100%;
      color: #6c757d;
      font-style: italic;
    }
    
    .board-loading .spinner {
      margin-bottom: 1rem;
    }
    
    /* ë¶€ì„œ ì¹¼ëŸ¼ ìŠ¤íƒ€ì¼ */
    .department-column {
      flex: none;
      width: 100%;
      background: #ffffff;
      border-radius: 12px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.08);
      display: flex;
      flex-direction: column;
      max-height: 400px;
      min-height: 300px;
      border: 2px solid transparent;
      transition: all 0.3s ease;
    }
    
    .department-column.drag-over {
      border-color: #667eea;
      background: rgba(102, 126, 234, 0.05);
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.2);
    }
    
    .department-column.drop-available {
      border-color: rgba(102, 126, 234, 0.3);
      background: rgba(102, 126, 234, 0.02);
    }
    
    .department-column.drop-available:not(.drag-over) {
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0% { 
        border-color: rgba(102, 126, 234, 0.2);
        box-shadow: 0 2px 12px rgba(0,0,0,0.08);
      }
      50% { 
        border-color: rgba(102, 126, 234, 0.4);
        box-shadow: 0 4px 20px rgba(102, 126, 234, 0.15);
      }
      100% { 
        border-color: rgba(102, 126, 234, 0.2);
        box-shadow: 0 2px 12px rgba(0,0,0,0.08);
      }
    }
    
    .column-header {
      padding: 1rem;
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border-bottom: 2px solid #dee2e6;
      text-align: center;
      border-radius: 10px 10px 0 0;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    
    .column-title {
      font-size: 1.1rem;
      font-weight: 700;
      color: #495057;
      margin: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }
    
    .column-count {
      background: #667eea;
      color: white;
      padding: 0.25rem 0.75rem;
      border-radius: 15px;
      font-size: 0.8rem;
      font-weight: 600;
      margin-left: 0.5rem;
    }
    
    .column-body {
      flex: 1;
      padding: 1rem;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }
    
    .column-empty {
      text-align: center;
      color: #6c757d;
      font-style: italic;
      padding: 2rem 1rem;
      border: 2px dashed #dee2e6;
      border-radius: 8px;
      background: #f8f9fa;
    }
    
    /* ì§ì› ì¹´ë“œ ìŠ¤íƒ€ì¼ */
    .employee-card {
      background: white;
      border-radius: 8px;
      padding: 1rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      cursor: move;
      transition: all 0.3s ease;
      border: 1px solid #e9ecef;
      position: relative;
    }
    
    .employee-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 16px rgba(0,0,0,0.15);
      border-color: #667eea;
    }
    
    .employee-card.dragging {
      opacity: 0.5;
      transform: rotate(5deg);
      box-shadow: 0 8px 25px rgba(0,0,0,0.2);
      z-index: 1000;
    }
    
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.75rem;
    }
    
    .card-name {
      font-weight: 700;
      color: #333;
      font-size: 1rem;
    }
    
    .card-empid {
      background: #e9ecef;
      color: #6c757d;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      font-size: 0.75rem;
      font-weight: 600;
    }
    
    .card-info {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
    
    .card-email {
      color: #667eea;
      font-size: 0.85rem;
      font-weight: 500;
    }
    
    .card-position {
      color: #6c757d;
      font-size: 0.85rem;
    }
    
    .card-actions {
      display: flex;
      gap: 0.5rem;
      margin-top: 0.75rem;
      padding-top: 0.75rem;
      border-top: 1px solid #e9ecef;
    }
    
    .card-btn {
      padding: 0.25rem 0.5rem;
      border: none;
      border-radius: 4px;
      font-size: 0.75rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      flex: 1;
    }
    
    .card-btn-edit {
      background: #28a745;
      color: white;
    }
    
    .card-btn-edit:hover {
      background: #218838;
    }
    
    .card-btn-delete {
      background: #dc3545;
      color: white;
    }
    
    .card-btn-delete:hover {
      background: #c82333;
    }
    
    /* ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì‹œê°ì  í”¼ë“œë°± */
    .drop-indicator {
      height: 2px;
      background: #667eea;
      margin: 0.5rem 0;
      border-radius: 1px;
      opacity: 0;
      transition: opacity 0.2s ease;
    }
    
    .drop-indicator.active {
      opacity: 1;
    }
    
    .card-placeholder {
      background: rgba(102, 126, 234, 0.1);
      border: 2px dashed #667eea;
      border-radius: 8px;
      padding: 1rem;
      text-align: center;
      color: #667eea;
      font-weight: 600;
      font-size: 0.9rem;
    }
    
    /* ğŸ¨ ê°œì„ ëœ í…Œì´ë¸” ìŠ¤íƒ€ì¼ (ë¶€ì„œ ëª©ë¡ ë·°) */
    .department-view .table-container {
      background: transparent;
      border-radius: 0;
      box-shadow: none;
      margin: 0;
      padding: 1.5rem;
    }
    
    .department-view .table {
      background: #ffffff;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06);
      border: 1px solid #e9ecef;
    }
    
    .department-view .table thead {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border-bottom: 2px solid #dee2e6;
    }
    
    .department-view .table thead th {
      color: #2c3e50;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-size: 0.85rem;
      padding: 1.25rem 1rem;
      border: none;
      text-shadow: none;
      text-align: center;
    }
    
    .department-view .table thead th:nth-child(2) {
      text-align: left;
    }
    
    .department-view .table tbody td {
      padding: 1.25rem 1rem;
      border-bottom: 1px solid #f1f3f4;
      vertical-align: middle;
      font-size: 0.95rem;
      text-align: center;
    }
    
    .department-view .table tbody td:first-child {
      text-align: center;
      font-weight: 600;
    }
    
    .department-view .table tbody td:nth-child(2) {
      text-align: left;
      font-weight: 500;
    }
    
    .department-view .table tbody td:nth-child(3) {
      text-align: center;
    }
    
    .department-view .table tbody td:last-child {
      text-align: center;
    }
    
    .department-view .table tbody tr {
      transition: all 0.3s ease;
    }
    
    .department-view .table tbody tr:hover {
      background: linear-gradient(135deg, #f8f9ff 0%, #f0f4ff 100%);
      transform: translateX(4px);
    }
    
    .department-view .table tbody tr:last-child td {
      border-bottom: none;
    }
    
    .department-view .table .empty-message {
      text-align: center;
      color: #6c757d;
      font-style: italic;
      padding: 3rem 2rem;
      background: #f8f9fa;
    }
    
    /* ğŸ¨ ê°œì„ ëœ ë²„íŠ¼ ìŠ¤íƒ€ì¼ (í…Œì´ë¸” ë‚´) */
    .department-view .btn {
      padding: 0.5rem 1rem;
      border-radius: 8px;
      font-size: 0.85rem;
      font-weight: 600;
      transition: all 0.3s ease;
      border: none;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      text-decoration: none;
    }
    
    .department-view .btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    
    .department-view .btn-secondary {
      background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
      color: #ffffff;
    }
    
    .department-view .btn-secondary:hover {
      background: linear-gradient(135deg, #5a6268 0%, #343a40 100%);
    }
    
    .department-view .btn-danger {
      background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
      color: #ffffff;
    }
    
    .department-view .btn-danger:hover {
      background: linear-gradient(135deg, #c82333 0%, #bd2130 100%);
    }
    
    /* ğŸ“± ë°˜ì‘í˜• ë””ìì¸ ê°œì„  */
    @media (max-width: 768px) {
      .compact-form-row {
        flex-direction: column;
        align-items: stretch;
      }
      
      .compact-form-group {
        min-width: 100%;
        width: 100%;
      }
      
      .main-section-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 1.5rem;
      }
      
      .section-title-area {
        min-width: 100%;
      }
      
      .view-controls {
        width: 100%;
        justify-content: center;
        flex-direction: column;
        align-items: stretch;
      }
      
      .view-tabs {
        width: 100%;
      }
      
      .view-tab {
        flex: 1;
        justify-content: center;
      }
      
      .department-view .table-container {
        padding: 1rem;
      }
      
      .department-view .table {
        font-size: 0.9rem;
      }
      
      .department-view .table thead th {
        padding: 1rem 0.75rem;
        font-size: 0.8rem;
      }
      
      .department-view .table tbody td {
        padding: 1rem 0.75rem;
      }
      
      .board-header {
        flex-direction: column;
        text-align: center;
      }
      
      .board-stats {
        justify-content: center;
      }
      
      .kanban-board {
        display: grid !important;
        grid-template-columns: 1fr !important;
        gap: 1rem;
        padding: 1rem;
      }
      
      .department-column {
        flex: none;
        max-height: none;
      }
      
      .column-body {
        max-height: 300px;
      }
    }
    
    @media (max-width: 480px) {
      .compact-form-section {
        padding: 1rem;
        margin-bottom: 1.5rem;
      }
      
      .compact-form-title {
        font-size: 1.1rem;
      }
      
      .main-section-header {
        padding: 1.5rem;
      }
      
      .main-section-title {
        font-size: 1.25rem;
      }
      
      .department-view .table-container {
        padding: 0.75rem;
      }
      
      .department-view .btn {
        padding: 0.4rem 0.8rem;
        font-size: 0.8rem;
      }
      
      .kanban-board {
        padding: 0.75rem;
      }
      
      .department-column {
        flex: 0 0 240px;
      }
    }
    
    /* ğŸ“ˆ í†µê³„ í˜ì´ì§€ ì „ìš© ìŠ¤íƒ€ì¼ */
    .stats-section {
      background: #ffffff;
      border-radius: 16px;
      padding: 2rem;
      margin-bottom: 2rem;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06);
      border: 1px solid #e9ecef;
    }
    
    .stats-section-title {
      color: #2c3e50;
      font-size: 1.25rem;
      font-weight: 700;
      margin: 0 0 1.5rem 0;
      padding-bottom: 0.75rem;
      border-bottom: 2px solid #e9ecef;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    /* ë°ì´í„° ê´€ë¦¬ ê·¸ë¦¬ë“œ */
    .data-management-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1.5rem;
    }
    
    .data-action-card {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border-radius: 12px;
      padding: 1.5rem;
      text-align: center;
      border: 1px solid #dee2e6;
      transition: all 0.3s ease;
    }
    
    .data-action-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
      background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
    }
    
    .action-icon {
      font-size: 2.5rem;
      margin-bottom: 1rem;
    }
    
    .action-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: #2c3e50;
      margin-bottom: 0.5rem;
    }
    
    .action-desc {
      color: #6c757d;
      font-size: 0.9rem;
      margin-bottom: 1.5rem;
      line-height: 1.4;
    }
    
    /* í†µê³„ ëŒ€ì‹œë³´ë“œ ì¹´ë“œ ê°œì„  */
    #statisticsPage .dashboard-card {
      background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
      border: 1px solid #e9ecef;
      transition: all 0.3s ease;
    }
    
    #statisticsPage .dashboard-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.12);
      background: linear-gradient(135deg, #ffffff 0%, #f0f4ff 100%);
    }
    
    /* ìƒˆë¡œìš´ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    .btn-success {
      background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
      color: #ffffff;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      font-weight: 600;
      transition: all 0.3s ease;
      cursor: pointer;
    }
    
    .btn-success:hover {
      background: linear-gradient(135deg, #218838 0%, #1e7e34 100%);
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(40, 167, 69, 0.4);
    }
    
    /* ìƒíƒœ ìƒ‰ìƒ */
    .status-excellent { color: #28a745; font-weight: 600; }
    .status-good { color: #20c997; font-weight: 600; }
    .status-warning { color: #ffc107; font-weight: 600; }
    .status-danger { color: #dc3545; font-weight: 600; }

    /* ê´€ë¦¬ì ì •ë³´ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
    .dashboard-card.admin-info {
      background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
      color: white;
      border: 1px solid #ff5722;
    }
    
    .dashboard-card.admin-info .card-icon {
      color: rgba(255, 255, 255, 0.9);
    }
    
    .dashboard-card.admin-info .card-value {
      color: white;
      font-weight: 700;
    }
    
    .dashboard-card.admin-info .card-label {
      color: rgba(255, 255, 255, 0.8);
    }
    
    .dashboard-card.admin-info:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 30px rgba(255, 107, 107, 0.4);
    }
    
    /* ì˜¤ë¥˜ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
    .dashboard-card.error {
      background: linear-gradient(135deg, #ff4757 0%, #c44569 100%);
      color: white;
      border: 1px solid #ff3742;
    }
    
    .dashboard-card.error .card-icon {
      color: rgba(255, 255, 255, 0.9);
    }
    
    .dashboard-card.error .card-value {
      color: white;
      font-weight: 700;
    }
    
    .dashboard-card.error .card-label {
      color: rgba(255, 255, 255, 0.8);
      font-size: 0.85rem;
    }

    /* ì§ì› ì„ íƒ ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
    .employee-list {
      max-height: 400px;
      overflow-y: auto;
      border: 1px solid #eee;
      border-radius: 8px;
    }

    .employee-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.75rem 1rem;
      border-bottom: 1px solid #eee;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .employee-item:last-child {
      border-bottom: none;
    }

    .employee-item:hover {
      background-color: #f8f9fa;
    }

    .employee-item.selected {
      background-color: #e3f2fd;
      border-left: 4px solid #1976d2;
    }

    .employee-info {
      flex: 1;
    }

    .employee-name {
      font-weight: 600;
      color: #333;
      margin-bottom: 0.25rem;
    }

    .employee-position {
      font-size: 0.85rem;
      color: #666;
    }

    .employee-dept {
      font-size: 0.85rem;
      color: #666;
      padding: 0.25rem 0.5rem;
      background: #f8f9fa;
      border-radius: 4px;
    }

    .search-box input {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 1rem;
      transition: all 0.3s ease;
    }

    .search-box input:focus {
      border-color: #1976d2;
      box-shadow: 0 0 0 2px rgba(25, 118, 210, 0.1);
      outline: none;
    }
    
    /* ëª¨ë°”ì¼ ë°˜ì‘í˜• - í†µê³„ í˜ì´ì§€ */
    @media (max-width: 768px) {
      .stats-section {
        padding: 1.5rem;
        margin-bottom: 1.5rem;
      }
      
      .stats-section-title {
        font-size: 1.1rem;
      }
      
      .data-management-grid {
        grid-template-columns: 1fr;
      }
      
      .data-action-card {
        padding: 1.25rem;
      }
    }
  </style>
</head>

<body>
  <!-- ğŸ” í—¤ë” -->
  <header class="header">
    <div class="header-content">
      <div class="logo">
        ğŸ“‹ ì—°ì°¨ê´€ë¦¬ ì‹œìŠ¤í…œ
      </div>
      
      <div class="header-right">
        <!-- ğŸ“¢ ì•Œë¦¼ ì•„ì´ì½˜ -->
        <button class="notification-icon" onclick="showNotifications()">
          ğŸ””
          <span id="notificationBadge" class="notification-badge">0</span>
        </button>
        
        <!-- ğŸ‘¤ ì‚¬ìš©ì ë©”ë‰´ -->
        <div class="user-menu">
          <button class="user-button" onclick="toggleUserMenu()">
            <? if (user.userType === 'admin') { ?>
              ğŸ” <?= user.name ?> (ê´€ë¦¬ì)
            <? } else { ?>
              ğŸ‘¤ <?= user.name ?>
            <? } ?>
            <span style="margin-left: 0.5rem;">â–¼</span>
          </button>
          
          <div id="userDropdown" class="user-dropdown">
            <a onclick="showPage('myInfo')">ğŸ‘¤ ë‚´ ì •ë³´</a>
            <a onclick="showPage('changePassword')">ğŸ”‘ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</a>
            <? if (user.isAdmin) { ?>
              <a onclick="showPage('adminMenu')">ğŸ”§ ê´€ë¦¬ì ë©”ë‰´</a>
            <? } ?>
            <a onclick="logout()">ğŸšª ë¡œê·¸ì•„ì›ƒ</a>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- ğŸ“± ì‚¬ì´ë“œë°” -->
  <nav class="sidebar" id="sidebar">
    <a class="menu-item active" onclick="showPage('dashboard')">
      <span class="icon">ğŸ </span> ëŒ€ì‹œë³´ë“œ
    </a>
    <? if (user.userType === 'admin') { ?>
      <!-- ê´€ë¦¬ì ì „ìš© ë©”ë‰´ -->
      <a class="menu-item" onclick="showPage('employeeManagement')">
        <span class="icon">ğŸ‘¥</span> ì§ì› ê´€ë¦¬
      </a>
      <a class="menu-item" onclick="showPage('departmentManagement')">
        <span class="icon">ğŸ¢</span> ë¶€ì„œ ê´€ë¦¬
      </a>
      <a class="menu-item" onclick="showPage('statistics')">
        <span class="icon">ğŸ“ˆ</span> í†µê³„ ë° ë³´ê³ ì„œ
      </a>
      <a class="menu-item" onclick="showPage('systemSettings')">
        <span class="icon">âš™ï¸</span> ì„¤ì •
      </a>
    <? } else { ?>
      <!-- ì§ì› ì „ìš© ë©”ë‰´ -->
      <a class="menu-item" onclick="showPage('leaveRequest')">
        <span class="icon">ğŸ“</span> ì—°ì°¨ ì‹ ì²­
      </a>
      <a class="menu-item" onclick="showPage('myRequests')">
        <span class="icon">ğŸ“Š</span> ë‚´ ì‹ ì²­ í˜„í™©
      </a>
      <a class="menu-item" onclick="showPage('approvals')">
        <span class="icon">âœ…</span> ê²°ì¬/í˜‘ì¡° ì²˜ë¦¬
      </a>
      <a class="menu-item" onclick="showPage('workSchedule')">
        <span class="icon">ğŸ“…</span> ê·¼ë¬´í‘œ
      </a>
      <? if (user.isAdmin) { ?>
        <a class="menu-item" onclick="showPage('adminMenu')">
          <span class="icon">ğŸ”§</span> ê´€ë¦¬ì ë©”ë‰´
        </a>
      <? } ?>
    <? } ?>
  </nav>

  <!-- ğŸ“„ ë©”ì¸ ì½˜í…ì¸  -->
  <main class="main-content" id="mainContent">
    
    <!-- ğŸ  ëŒ€ì‹œë³´ë“œ í˜ì´ì§€ -->
    <div id="dashboardPage" class="page active">
      <div class="page-header dashboard-header">
        <div class="dashboard-title-section">
          <h1 class="page-title">ğŸ  ëŒ€ì‹œë³´ë“œ</h1>
          <? if (user.userType === 'admin') { ?>
            <p class="page-subtitle" id="dashboardSubtitle">ì•ˆë…•í•˜ì„¸ìš”, <?= user.name ?> ê´€ë¦¬ìë‹˜! ì‹œìŠ¤í…œ ê´€ë¦¬ ëŒ€ì‹œë³´ë“œì…ë‹ˆë‹¤.</p>
          <? } else { ?>
            <p class="page-subtitle" id="dashboardSubtitle">ì•ˆë…•í•˜ì„¸ìš”, <?= user.name ?>ë‹˜! ì—°ì°¨ í˜„í™©ì„ í™•ì¸í•´ë³´ì„¸ìš”.</p>
          <? } ?>
        </div>
        <div class="dashboard-dept-section">
          <span class="dept-badge loading-badge" id="dashboardDeptBadge">
            <span class="loading-dots">ë¡œë”©ì¤‘</span>
          </span>
        </div>
      </div>
      
      <? if (user.userType === 'admin') { ?>
        <!-- ê´€ë¦¬ììš© ì‹œìŠ¤í…œ í˜„í™© ëŒ€ì‹œë³´ë“œ -->
        <div class="dashboard-grid">
          <div class="dashboard-card">
            <div class="card-icon">ğŸ‘¥</div>
            <div class="card-value" id="totalEmployees">-</div>
            <div class="card-label">ì „ì²´ ì§ì› ìˆ˜</div>
          </div>
          
          <div class="dashboard-card">
            <div class="card-icon">ğŸ“</div>
            <div class="card-value" id="totalRequests">-</div>
            <div class="card-label">ì´ ì—°ì°¨ ì‹ ì²­</div>
          </div>
          
          <div class="dashboard-card">
            <div class="card-icon">âœ…</div>
            <div class="card-value" id="approvedRequests">-</div>
            <div class="card-label">ìŠ¹ì¸ëœ ì‹ ì²­</div>
          </div>
          
          <div class="dashboard-card">
            <div class="card-icon">ğŸ¢</div>
            <div class="card-value" id="totalDepartments">-</div>
            <div class="card-label">ì „ì²´ ë¶€ì„œ ìˆ˜</div>
          </div>
        </div>
      <? } else { ?>
        <!-- ì§ì›ìš© ê°œì¸ ì—°ì°¨ ëŒ€ì‹œë³´ë“œ -->
        <div class="dashboard-grid">
          <div class="dashboard-card">
            <div class="card-icon">ğŸ“…</div>
            <div class="card-value" id="remainingLeaves">-</div>
            <div class="card-label">ë‚¨ì€ ì—°ì°¨</div>
          </div>
          
          <div class="dashboard-card">
            <div class="card-icon">ğŸ“</div>
            <div class="card-value" id="pendingRequests">-</div>
            <div class="card-label">ëŒ€ê¸° ì¤‘ì¸ ì‹ ì²­</div>
          </div>
          
          <div class="dashboard-card">
            <div class="card-icon">âœ…</div>
            <div class="card-value" id="pendingApprovals">-</div>
            <div class="card-label">ê²°ì¬ ëŒ€ê¸°</div>
          </div>
          
          <div class="dashboard-card">
            <div class="card-icon">ğŸ“Š</div>
            <div class="card-value" id="thisMonthUsed">-</div>
            <div class="card-label">ì´ë²ˆ ë‹¬ ì‚¬ìš©</div>
          </div>
        </div>
      <? } ?>
      
      <!-- ìµœê·¼ í™œë™ -->
      <? if (user.userType === 'admin') { ?>
        <!-- ê´€ë¦¬ììš© ì‹œìŠ¤í…œ ê´€ë¦¬ ë°”ë¡œê°€ê¸° -->
        <div class="recent-activity">
          <h3 style="padding: 1rem; margin: 0; background: #f8f9fa; font-weight: 600;">ğŸ”§ ê´€ë¦¬ ë°”ë¡œê°€ê¸°</h3>
          <div class="dashboard-grid" style="grid-template-columns: repeat(2, 1fr); gap: 1.5rem; padding: 1.5rem;">
            <div class="dashboard-card" onclick="showPage('employeeManagement')" style="cursor: pointer;">
              <div class="card-icon">ğŸ‘¥</div>
              <div class="card-value">ì§ì› ê´€ë¦¬</div>
              <div class="card-label">ì§ì› ì¶”ê°€/ìˆ˜ì •/ì‚­ì œ</div>
            </div>
            
            <div class="dashboard-card" onclick="showPage('departmentManagement')" style="cursor: pointer;">
              <div class="card-icon">ğŸ¢</div>
              <div class="card-value">ë¶€ì„œ ê´€ë¦¬</div>
              <div class="card-label">ë¶€ì„œ ì¶”ê°€/ìˆ˜ì •/ì‚­ì œ</div>
            </div>
          </div>
        </div>
      <? } else { ?>
        <!-- ì§ì›ìš© ìµœê·¼ ì‹ ì²­ ë‚´ì—­ -->
        <div class="table-container">
          <h3 style="padding: 1rem; margin: 0; background: #f8f9fa; font-weight: 600;">ìµœê·¼ ì—°ì°¨ ì‹ ì²­ ë‚´ì—­</h3>
          <table class="table">
            <thead>
              <tr>
                <th>ì‹ ì²­ì¼</th>
                <th>ì—°ì°¨ ì¢…ë¥˜</th>
                <th>ê¸°ê°„</th>
                <th>ìƒíƒœ</th>
                <th>ì‚¬ìœ </th>
              </tr>
            </thead>
            <tbody id="recentRequestsTable">
              <tr>
                <td colspan="5" class="loading">ìµœê·¼ ë‚´ì—­ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤</td>
              </tr>
            </tbody>
          </table>
        </div>
      <? } ?>
    </div>

    <!-- ğŸ“ ì—°ì°¨ ì‹ ì²­ í˜ì´ì§€ -->
    <div id="leaveRequestPage" class="page">
      <div class="page-header">
        <h1 class="page-title">ğŸ“ ì—°ì°¨ ì‹ ì²­</h1>
        <p class="page-subtitle">ì—°ì°¨ë¥¼ ì‹ ì²­í•˜ê³  ê²°ì¬ì/í˜‘ì¡°ìë¥¼ ì„ íƒí•˜ì„¸ìš”.</p>
      </div>
      
      <div class="form-container">
        <form id="leaveRequestForm" onsubmit="submitLeaveRequest(event)">
          <div class="form-grid">
            <div class="form-group">
              <label for="startDate">ì‹œì‘ì¼ *</label>
              <input type="date" id="startDate" required onchange="calculateLeaveDays()">
            </div>
            
            <div class="form-group">
              <label for="endDate">ì¢…ë£Œì¼ *</label>
              <input type="date" id="endDate" required onchange="calculateLeaveDays()">
            </div>
            
            <div class="form-group">
              <label for="leaveType">ì—°ì°¨ ì¢…ë¥˜ *</label>
              <select id="leaveType" required onchange="calculateLeaveDays()">
                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                <option value="ì—°ì°¨">ì—°ì°¨</option>
                <option value="ë°˜ì°¨">ë°˜ì°¨</option>
                <option value="íŠ¹ë³„íœ´ê°€">íŠ¹ë³„íœ´ê°€</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="calculatedDays">ê³„ì‚°ëœ ì¼ìˆ˜</label>
              <input type="text" id="calculatedDays" readonly placeholder="ìë™ ê³„ì‚°ë©ë‹ˆë‹¤">
            </div>
          </div>
          
          <div class="form-group">
            <label for="reason">ì‹ ì²­ ì‚¬ìœ  *</label>
            <textarea id="reason" required placeholder="ì—°ì°¨ ì‹ ì²­ ì‚¬ìœ ë¥¼ ì…ë ¥í•˜ì„¸ìš”"></textarea>
          </div>
          
          <!-- ê²°ì¬ì ì„ íƒ -->
          <div class="form-group">
            <label>ê²°ì¬ì ì„ íƒ *</label>
            <button type="button" class="btn btn-secondary" onclick="openApproverModal()">
              ğŸ” ê²°ì¬ì ì¶”ê°€
            </button>
            <div id="selectedApprovers" style="margin-top: 1rem;">
              <!-- ì„ íƒëœ ê²°ì¬ìë“¤ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
          </div>
          
          <!-- í˜‘ì¡°ì ì„ íƒ -->
          <div class="form-group">
            <label>í˜‘ì¡°ì ì„ íƒ (ì„ íƒì‚¬í•­)</label>
            <button type="button" class="btn btn-secondary" onclick="openCollaboratorModal()">
              ğŸ” í˜‘ì¡°ì ì¶”ê°€
            </button>
            <div id="selectedCollaborators" style="margin-top: 1rem;">
              <!-- ì„ íƒëœ í˜‘ì¡°ìë“¤ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
          </div>
          
          <div style="text-align: center; margin-top: 2rem;">
            <button type="submit" class="btn btn-primary" id="submitLeaveBtn">
              ğŸ“ ì—°ì°¨ ì‹ ì²­í•˜ê¸°
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- ğŸ“Š ë‚´ ì‹ ì²­ í˜„í™© í˜ì´ì§€ -->
    <div id="myRequestsPage" class="page">
      <div class="page-header">
        <h1 class="page-title">ğŸ“Š ë‚´ ì‹ ì²­ í˜„í™©</h1>
        <p class="page-subtitle">ë‚´ê°€ ì‹ ì²­í•œ ì—°ì°¨ì˜ ì§„í–‰ ìƒí™©ì„ í™•ì¸í•˜ì„¸ìš”.</p>
      </div>
      
      <div class="table-container">
        <table class="table">
          <thead>
            <tr>
              <th>ì‹ ì²­ID</th>
              <th>ì‹ ì²­ì¼</th>
              <th>ì—°ì°¨ ì¢…ë¥˜</th>
              <th>ê¸°ê°„</th>
              <th>ì¼ìˆ˜</th>
              <th>ìƒíƒœ</th>
              <th>ì‚¬ìœ </th>
              <th>ê²°ì¬ í˜„í™©</th>
            </tr>
          </thead>
          <tbody id="myRequestsTable">
            <tr>
              <td colspan="8" class="loading">ë‚´ ì‹ ì²­ í˜„í™©ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- âœ… ê²°ì¬/í˜‘ì¡° ì²˜ë¦¬ í˜ì´ì§€ -->
    <div id="approvalsPage" class="page">
      <div class="page-header">
        <h1 class="page-title">âœ… ê²°ì¬/í˜‘ì¡° ì²˜ë¦¬</h1>
        <p class="page-subtitle">ë‚˜ì—ê²Œ í• ë‹¹ëœ ê²°ì¬ ë° í˜‘ì¡° ê±´ì„ ì²˜ë¦¬í•˜ì„¸ìš”.</p>
      </div>
      
      <!-- ê²°ì¬ ëŒ€ê¸° ëª©ë¡ -->
      <div class="table-container" style="margin-bottom: 2rem;">
        <h3 style="padding: 1rem; margin: 0; background: #fff3cd; color: #856404; font-weight: 600;">
          ğŸ”¶ ê²°ì¬ ëŒ€ê¸° ëª©ë¡
        </h3>
        <table class="table">
          <thead>
            <tr>
              <th>ì‹ ì²­ID</th>
              <th>ì‹ ì²­ì</th>
              <th>ì—°ì°¨ ì¢…ë¥˜</th>
              <th>ê¸°ê°„</th>
              <th>ì¼ìˆ˜</th>
              <th>ì‚¬ìœ </th>
              <th>ì²˜ë¦¬</th>
            </tr>
          </thead>
          <tbody id="pendingApprovalsTable">
            <tr>
              <td colspan="7" class="loading">ê²°ì¬ ëŒ€ê¸° ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤</td>
            </tr>
          </tbody>
        </table>
      </div>
      
      <!-- í˜‘ì¡° ëŒ€ê¸° ëª©ë¡ -->
      <div class="table-container">
        <h3 style="padding: 1rem; margin: 0; background: #d1ecf1; color: #0c5460; font-weight: 600;">
          ğŸ”· í˜‘ì¡° ëŒ€ê¸° ëª©ë¡
        </h3>
        <table class="table">
          <thead>
            <tr>
              <th>ì‹ ì²­ID</th>
              <th>ì‹ ì²­ì</th>
              <th>ì—°ì°¨ ì¢…ë¥˜</th>
              <th>ê¸°ê°„</th>
              <th>ì¼ìˆ˜</th>
              <th>ì‚¬ìœ </th>
              <th>ì²˜ë¦¬</th>
            </tr>
          </thead>
          <tbody id="pendingCollaborationsTable">
            <tr>
              <td colspan="7" class="loading">í˜‘ì¡° ëŒ€ê¸° ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- ğŸ“… ê·¼ë¬´í‘œ í˜ì´ì§€ -->
    <div id="workSchedulePage" class="page">
      <div class="page-header">
        <h1 class="page-title">ğŸ“… ê·¼ë¬´í‘œ</h1>
        <p class="page-subtitle">ë¶€ì„œë³„ ì›”ê°„ ê·¼ë¬´ í˜„í™©ì„ í™•ì¸í•˜ì„¸ìš”.</p>
      </div>
      
      <!-- ì‚¬ìš©ì ë¶€ì„œ ì •ë³´ ë° ì›” ì„ íƒ -->
      <div class="schedule-controls">
        <div class="user-dept-info">
          <div class="dept-badge">
            <span class="dept-icon">ğŸ¢</span>
            <span class="dept-name" id="userDeptName">ë¶€ì„œ ì •ë³´ ë¡œë”© ì¤‘...</span>
          </div>
        </div>
        
        <div class="form-grid" style="grid-template-columns: 1fr auto; gap: 1rem; align-items: end;">
          <div class="form-group">
            <label for="scheduleMonth">ì¡°íšŒ ì›”</label>
            <input type="month" id="scheduleMonth" onchange="loadWorkSchedule()">
          </div>
          
          <div class="form-group">
            <button type="button" class="btn btn-primary" onclick="createWorkScheduleSheet()">
              <span>ğŸ“‹</span> ê·¼ë¬´í‘œ ìƒì„±
            </button>
          </div>
        </div>
      </div>
      
      <!-- ê·¼ë¬´í‘œ ì»¨í…Œì´ë„ˆ -->
      <div class="work-schedule-container" id="workScheduleContainer">
        <div class="empty-state">
          <div class="empty-icon">ğŸ“…</div>
          <h3>ê·¼ë¬´í‘œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</h3>
          <p>ë¶€ì„œì™€ ì¡°íšŒí•  ì›”ì„ ì„ íƒí•˜ë©´ ê·¼ë¬´í‘œê°€ í‘œì‹œë©ë‹ˆë‹¤.</p>
        </div>
      </div>
    </div>

    <!-- ğŸ‘¤ ë‚´ ì •ë³´ í˜ì´ì§€ -->
    <div id="myInfoPage" class="page">
      <div class="page-header">
        <h1 class="page-title">ğŸ‘¤ ë‚´ ì •ë³´</h1>
        <p class="page-subtitle">ê°œì¸ ì •ë³´ì™€ ì—°ì°¨ í˜„í™©ì„ í™•ì¸í•˜ì„¸ìš”.</p>
      </div>
      
      <div class="form-container">
        <div class="form-grid">
          <div class="form-group">
            <label>ì‚¬ë²ˆ</label>
            <input type="text" value="<?= user.empId ?>" readonly>
          </div>
          
          <div class="form-group">
            <label>ì´ë¦„</label>
            <input type="text" value="<?= user.name ?>" readonly>
          </div>
          
          <div class="form-group">
            <label>ì´ë©”ì¼</label>
            <input type="text" value="<?= user.email ?>" readonly>
          </div>
          
          <div class="form-group">
            <label>ì†Œì† ë¶€ì„œ</label>
            <input type="text" id="myInfoDeptName" value="â³ ë¡œë”©ì¤‘..." readonly class="loading-input">
          </div>
          
          <div class="form-group">
            <label>ì§ê¸‰</label>
            <input type="text" value="<?= user.position ?>" readonly>
          </div>
        </div>
        
        <div id="myLeaveInfo" class="dashboard-grid" style="margin-top: 2rem;">
          <!-- ì—°ì°¨ ì •ë³´ê°€ ì—¬ê¸°ì— ë¡œë“œë©ë‹ˆë‹¤ -->
        </div>
      </div>
    </div>

    <!-- ğŸ”‘ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ í˜ì´ì§€ -->
    <div id="changePasswordPage" class="page">
      <div class="page-header">
        <h1 class="page-title">ğŸ”‘ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</h1>
        <p class="page-subtitle">ë³´ì•ˆì„ ìœ„í•´ ì£¼ê¸°ì ìœ¼ë¡œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³€ê²½í•˜ì„¸ìš”.</p>
      </div>
      
      <div class="form-container">
        <form id="changePasswordForm" onsubmit="changePassword(event)">
          <div class="form-group">
            <label for="currentPassword">í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ *</label>
            <input type="password" id="currentPassword" required>
          </div>
          
          <div class="form-group">
            <label for="newPassword">ìƒˆ ë¹„ë°€ë²ˆí˜¸ * (8ì ì´ìƒ)</label>
            <input type="password" id="newPassword" required minlength="8">
          </div>
          
          <div class="form-group">
            <label for="confirmPassword">ìƒˆ ë¹„ë°€ë²ˆí˜¸ í™•ì¸ *</label>
            <input type="password" id="confirmPassword" required minlength="8">
          </div>
          
          <div style="text-align: center; margin-top: 2rem;">
            <button type="submit" class="btn btn-primary">
              ğŸ”„ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- ğŸ”§ ê´€ë¦¬ì ë©”ë‰´ í˜ì´ì§€ -->
    <? if (user.isAdmin) { ?>
    <!-- ğŸ”§ ê´€ë¦¬ì ë©”ë‰´ í˜ì´ì§€ (ë” ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ - ì‚¬ì´ë“œë°”ë¡œ ì´ë™) -->
    <!--
    <div id="adminMenuPage" class="page">
      <div class="page-header">
        <h1 class="page-title">ğŸ”§ ê´€ë¦¬ì ë©”ë‰´</h1>
        <p class="page-subtitle">ì‹œìŠ¤í…œ ê´€ë¦¬ ë° ì„¤ì •ì„ ë³€ê²½í•˜ì„¸ìš”.</p>
      </div>
      
      <div class="dashboard-grid">
        <div class="dashboard-card" onclick="showPage('employeeManagement')" style="cursor: pointer;">
          <div class="card-icon">ğŸ‘¥</div>
          <div class="card-value">ì§ì› ê´€ë¦¬</div>
          <div class="card-label">ì§ì› ì¶”ê°€/ìˆ˜ì •/ì‚­ì œ</div>
        </div>
        
        <div class="dashboard-card" onclick="showPage('departmentManagement')" style="cursor: pointer;">
          <div class="card-icon">ğŸ¢</div>
          <div class="card-value">ë¶€ì„œ ê´€ë¦¬</div>
          <div class="card-label">ë¶€ì„œ ì¶”ê°€/ìˆ˜ì •/ì‚­ì œ</div>
        </div>
        
        <div class="dashboard-card" onclick="showPage('systemSettings')" style="cursor: pointer;">
          <div class="card-icon">âš™ï¸</div>
          <div class="card-value">ì‹œìŠ¤í…œ ì„¤ì •</div>
          <div class="card-label">ì—°ì°¨ ì •ì±… ë° ì„¤ì •</div>
        </div>
        
        <div class="dashboard-card" onclick="showPage('statistics')" style="cursor: pointer;">
          <div class="card-icon">ğŸ“ˆ</div>
          <div class="card-value">í†µê³„ ë° ë°±ì—…</div>
          <div class="card-label">ë°ì´í„° ë¶„ì„ ë° ë°±ì—…</div>
        </div>
      </div>
    </div>
    -->

    <!-- ğŸ‘¥ ì§ì› ê´€ë¦¬ í˜ì´ì§€ -->
    <div id="employeeManagementPage" class="page">
      <div class="page-header">
        <h1 class="page-title">ğŸ‘¥ ì§ì› ê´€ë¦¬</h1>
        <p class="page-subtitle">ì§ì› ì •ë³´ë¥¼ ì¶”ê°€, ìˆ˜ì •, ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
      </div>
      
      <!-- ì§ì› ì¶”ê°€ ì„¹ì…˜ -->
      <div class="employee-form-section">
        <div class="section-header">
          <h3 class="section-title">ğŸ“ ì§ì› ì¶”ê°€</h3>
        </div>
        
        <div class="form-container">
          <div class="info-banner">
            <div class="info-icon">ğŸ“‹</div>
            <div class="info-content">
              <strong>ìë™ ìƒì„± ì •ë³´</strong>
              <ul class="info-list">
                <li>ì‚¬ë²ˆ: ì‹œìŠ¤í…œì—ì„œ ìë™ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ (ê¸°ì¡´ ìµœëŒ€ ì‚¬ë²ˆ + 1)</li>
                <li>ì´ˆê¸° ë¹„ë°€ë²ˆí˜¸: <code>temp123</code> (ì²« ë¡œê·¸ì¸ ì‹œ ë³€ê²½ í•„ìš”)</li>
              </ul>
            </div>
          </div>
          
          <form id="addEmployeeForm" onsubmit="addEmployee(event)">
            <div class="form-grid">
              <div class="form-group">
                <label for="empName">ì´ë¦„ *</label>
                <input type="text" id="empName" required placeholder="í™ê¸¸ë™">
              </div>
              
              <div class="form-group">
                <label for="empEmail">ì´ë©”ì¼ *</label>
                <input type="email" id="empEmail" required placeholder="hong@company.com">
              </div>
              
              <div class="form-group">
                <label for="empPhone">ì „í™”ë²ˆí˜¸</label>
                <input type="tel" id="empPhone" placeholder="010-1234-5678">
              </div>
              
              <div class="form-group">
                <label for="empDept">ë¶€ì„œ *</label>
                <select id="empDept" required>
                  <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                  <option value="10">ê°œë°œíŒ€</option>
                  <option value="20">ì˜ì—…íŒ€</option>
                  <option value="30">ì¸ì‚¬íŒ€</option>
                  <option value="40">ì´ë¬´íŒ€</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="empPosition">ì§ê¸‰</label>
                <input type="text" id="empPosition" placeholder="ì˜ˆ: ëŒ€ë¦¬">
              </div>
            </div>
            
            <div class="form-actions">
              <button type="submit" class="btn btn-primary btn-large">
                <span class="btn-icon">ğŸ‘¥</span>
                <span class="btn-text">ì§ì› ì¶”ê°€</span>
              </button>
            </div>
          </form>
        </div>
      </div>
      
      <!-- ì§ì› ëª©ë¡ ì„¹ì…˜ -->
      <div class="employee-list-section">
        <div class="section-header">
          <h3 class="section-title">ğŸ“‹ ì§ì› ëª©ë¡</h3>
          <div class="search-controls">
            <div class="search-input-wrapper">
              <input 
                type="text" 
                id="employeeSearchInput" 
                placeholder="ğŸ” ì´ë¦„, ì´ë©”ì¼, ë¶€ì„œë¡œ ê²€ìƒ‰..." 
                class="search-input"
                onkeyup="searchEmployees()"
                onkeydown="if(event.key==='Enter'){event.preventDefault();searchEmployees();}"
              />
            </div>
            <button 
              type="button" 
              class="btn btn-secondary btn-reset" 
              onclick="clearEmployeeSearch()"
            >
              <span class="btn-icon">ğŸ”„</span>
              <span class="btn-text">ì´ˆê¸°í™”</span>
            </button>
          </div>
        </div>
        
                <div class="table-container">
          <table class="table employee-table">
          <thead>
            <tr>
                <th class="col-empid">ì‚¬ë²ˆ</th>
                <th class="col-name">ì´ë¦„</th>
                <th class="col-email">ì´ë©”ì¼</th>
                <th class="col-dept">ë¶€ì„œ</th>
                <th class="col-position">ì§ê¸‰</th>
                <th class="col-actions">ê´€ë¦¬</th>
            </tr>
          </thead>
          <tbody id="employeeListTable">
            <tr>
                <td colspan="6" class="loading-cell">ì§ì› ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤</td>
            </tr>
          </tbody>
        </table>
        </div>
        
        <!-- ğŸ“„ í˜ì´ì§€ë„¤ì´ì…˜ -->
        <div id="employeePagination" class="pagination-container" style="display: none;">
          <div class="pagination-info">
            <span id="paginationInfo">1-10 of 0 ì§ì›</span>
          </div>
          
          <div class="pagination-controls">
            <button class="pagination-btn" id="firstPageBtn" onclick="goToPage(1)" title="ì²« í˜ì´ì§€">
              â®ï¸
            </button>
            <button class="pagination-btn" id="prevPageBtn" onclick="goToPage(currentPage - 1)" title="ì´ì „ í˜ì´ì§€">
              â—€ï¸
            </button>
            
            <div id="pageNumbers">
              <!-- í˜ì´ì§€ ë²ˆí˜¸ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
            </div>
            
            <button class="pagination-btn" id="nextPageBtn" onclick="goToPage(currentPage + 1)" title="ë‹¤ìŒ í˜ì´ì§€">
              â–¶ï¸
            </button>
            <button class="pagination-btn" id="lastPageBtn" onclick="goToPage(totalPages)" title="ë§ˆì§€ë§‰ í˜ì´ì§€">
              â­ï¸
            </button>
          </div>
          
          <div class="pagination-settings">
            <label for="itemsPerPage">í˜ì´ì§€ë‹¹:</label>
            <select id="itemsPerPage" class="pagination-select" onchange="changeItemsPerPage()">
              <option value="10">10ê°œ</option>
              <option value="20">20ê°œ</option>
              <option value="50">50ê°œ</option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <!-- ğŸ¢ ë¶€ì„œ ê´€ë¦¬ í˜ì´ì§€ -->
    <div id="departmentManagementPage" class="page">
      <div class="page-header">
        <h1 class="page-title">ğŸ¢ ë¶€ì„œ ê´€ë¦¬</h1>
        <p class="page-subtitle">ë¶€ì„œ ì •ë³´ë¥¼ ì¶”ê°€, ìˆ˜ì •, ì‚­ì œí•˜ê³  ì§ì›ì„ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
      </div>
      
      <!-- ğŸ“ ì»´íŒ©íŠ¸í•œ ë¶€ì„œ ì¶”ê°€ í¼ -->
      <div class="compact-form-section">
        <div class="compact-form-header">
          <h3 class="compact-form-title">ğŸ“ ë¶€ì„œ ì¶”ê°€</h3>
        </div>
        
        <form id="addDepartmentForm" onsubmit="addDepartment(event)" class="compact-form">
          <div class="compact-form-row">
            <div class="compact-form-group">
              <label for="deptId">ë¶€ì„œì½”ë“œ *</label>
              <input type="number" id="deptId" required placeholder="ì˜ˆ: 50">
            </div>
            
            <div class="compact-form-group">
              <label for="deptName">ë¶€ì„œëª… *</label>
              <input type="text" id="deptName" required placeholder="ì˜ˆ: ë§ˆì¼€íŒ…íŒ€">
            </div>
            
            <div class="compact-form-group">
              <button type="submit" class="btn-compact btn-compact-primary">
                ğŸ¢ ë¶€ì„œ ì¶”ê°€
              </button>
            </div>
          </div>
        </form>
      </div>
      
      <!-- ğŸ¢ ë©”ì¸ ë¶€ì„œ ê´€ë¦¬ ì„¹ì…˜ -->
      <div class="department-management-main">
        <div class="main-section-header">
          <div class="section-title-area">
            <h3 class="main-section-title">ğŸ“Š ë¶€ì„œ í˜„í™© ë° ì§ì› ê´€ë¦¬</h3>
            <p class="main-section-subtitle">ë¶€ì„œ ì •ë³´ë¥¼ ê´€ë¦¬í•˜ê³  ì§ì›ì„ ë¶€ì„œê°„ ì´ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
          </div>
          <div class="view-controls">
            <!-- ë·° ì „í™˜ íƒ­ -->
            <div class="view-tabs">
              <button 
                type="button" 
                class="view-tab active" 
                id="deptListViewTab"
                onclick="switchDepartmentView('list')"
              >
                <span class="tab-icon">ğŸ“‹</span>
                <span class="tab-text">ëª©ë¡ ë·°</span>
              </button>
              <button 
                type="button" 
                class="view-tab" 
                id="deptBoardViewTab"
                onclick="switchDepartmentView('board')"
              >
                <span class="tab-icon">ğŸ¯</span>
                <span class="tab-text">ë³´ë“œ ë·°</span>
              </button>
            </div>
          </div>
        </div>
        
        <!-- ëª©ë¡ ë·° (ê¸°ë³¸) -->
        <div id="departmentListView" class="department-view active">
          <div class="table-container">
            <table class="table">
              <thead>
                <tr>
                  <th>ë¶€ì„œì½”ë“œ</th>
                  <th>ë¶€ì„œëª…</th>
                  <th>ì†Œì† ì§ì› ìˆ˜</th>
                  <th>ê´€ë¦¬</th>
                </tr>
              </thead>
              <tbody id="departmentListTable">
                <tr>
                  <td colspan="4" class="loading">ë¶€ì„œ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        
        <!-- ğŸ¯ ë“œë˜ê·¸ ì•¤ ë“œë¡­ ë³´ë“œ ë·° -->
        <div id="departmentBoardView" class="department-view">
          <div class="board-container">
            <div class="board-header">
              <div class="board-info">
                <h4 class="board-title">ğŸ¯ ë¶€ì„œë³„ ì§ì› ê´€ë¦¬ ë³´ë“œ</h4>
                <p class="board-subtitle">ì§ì› ì¹´ë“œë¥¼ ë“œë˜ê·¸í•´ì„œ ë‹¤ë¥¸ ë¶€ì„œë¡œ ì´ë™ì‹œí‚¤ì„¸ìš”</p>
              </div>
              <div class="board-stats">
                <span id="deptBoardTotalEmployees" class="board-stat">ì´ <strong>0</strong>ëª…</span>
                <span id="deptBoardTotalDepartments" class="board-stat"><strong>0</strong>ê°œ ë¶€ì„œ</span>
              </div>
            </div>
            
            <div class="kanban-board" id="deptKanbanBoard">
              <!-- ë¶€ì„œë³„ ì¹¼ëŸ¼ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
              <div class="board-loading">
                <div class="spinner"></div>
                <p>ë¶€ì„œë³„ ì§ì› ë³´ë“œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- âš™ï¸ ì‹œìŠ¤í…œ ì„¤ì • í˜ì´ì§€ -->
    <div id="systemSettingsPage" class="page">
      <div class="page-header">
        <h1 class="page-title">âš™ï¸ ì„¤ì •</h1>
        <p class="page-subtitle">ì—°ì°¨ ì •ì±… ë° ì‹œìŠ¤í…œ ì„¤ì •ì„ ê´€ë¦¬í•©ë‹ˆë‹¤.</p>
      </div>
      
      <div class="form-container">
        <h3>ğŸ“‹ ì—°ì°¨ ì •ì±… ì„¤ì •</h3>
        <form id="systemSettingsForm" onsubmit="updateSystemSettings(event)">
          <div class="form-grid">
            <div class="form-group">
              <label for="basicLeaves">ê¸°ë³¸ ì—°ì°¨ ì¼ìˆ˜</label>
              <input type="number" id="basicLeaves" value="15" min="10" max="30">
            </div>
            
            <div class="form-group">
              <label for="maxLeaves">ìµœëŒ€ ì—°ì°¨ ì¼ìˆ˜</label>
              <input type="number" id="maxLeaves" value="25" min="15" max="50">
            </div>
            
            <div class="form-group">
              <label for="sessionTimeout">ì„¸ì…˜ íƒ€ì„ì•„ì›ƒ (ë¶„)</label>
              <input type="number" id="sessionTimeout" value="120" min="30" max="480">
            </div>
            
            <div class="form-group">
              <label for="leavePolicy">ì—°ì°¨ ë°œìƒ ê¸°ì¤€</label>
              <select id="leavePolicy">
                <option value="ì…ì‚¬ì¼ ê¸°ì¤€">ì…ì‚¬ì¼ ê¸°ì¤€</option>
                <option value="íšŒê³„ì—°ë„ ê¸°ì¤€">íšŒê³„ì—°ë„ ê¸°ì¤€</option>
              </select>
            </div>
          </div>
          
          <div style="text-align: center; margin-top: 2rem;">
            <button type="submit" class="btn btn-primary">
              âš™ï¸ ì„¤ì • ì €ì¥
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- ğŸ“ˆ í†µê³„ ë° ë°±ì—… í˜ì´ì§€ -->
    <div id="statisticsPage" class="page">
      <div class="page-header">
        <h1 class="page-title">ğŸ“ˆ í†µê³„ ë° ë³´ê³ ì„œ</h1>
        <p class="page-subtitle">ì‹¤ì‹œê°„ í†µê³„ì™€ ìš´ì˜ ì¸ì‚¬ì´íŠ¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>
      </div>
      
      <!-- ğŸ”¥ ì‹¤ì‹œê°„ ìš´ì˜ ì§€í‘œ -->
      <div class="stats-section">
        <h3 class="stats-section-title">ğŸ”¥ ì‹¤ì‹œê°„ ìš´ì˜ í˜„í™©</h3>
        <div class="dashboard-grid">
          <div class="dashboard-card">
            <div class="card-icon">â°</div>
            <div class="card-value" id="statsPendingRequests">-</div>
            <div class="card-label">ì²˜ë¦¬ ëŒ€ê¸° ì¤‘</div>
          </div>
          
          <div class="dashboard-card">
            <div class="card-icon">ğŸ“…</div>
            <div class="card-value" id="statsThisMonthRequests">-</div>
            <div class="card-label">ì´ë²ˆ ë‹¬ ì‹ ì²­</div>
          </div>
          
          <div class="dashboard-card">
            <div class="card-icon">âš¡</div>
            <div class="card-value" id="statsAvgProcessTime">-</div>
            <div class="card-label">í‰ê·  ì²˜ë¦¬ì‹œê°„</div>
          </div>
          
          <div class="dashboard-card">
            <div class="card-icon">ğŸ“Š</div>
            <div class="card-value" id="statsApprovalRate">-</div>
            <div class="card-label">ìŠ¹ì¸ë¥ </div>
          </div>
        </div>
      </div>
      
      <!-- ğŸ“Š í•µì‹¬ ì„±ê³¼ ì§€í‘œ -->
      <div class="stats-section">
        <h3 class="stats-section-title">ğŸ“Š í•µì‹¬ ì„±ê³¼ ì§€í‘œ (KPI)</h3>
        <div class="dashboard-grid">
          <div class="dashboard-card">
            <div class="card-icon">ğŸ‘¥</div>
            <div class="card-value" id="statsEmployeeCount">-</div>
            <div class="card-label">ì „ì²´ ì§ì› ìˆ˜</div>
          </div>
          
          <div class="dashboard-card">
            <div class="card-icon">ğŸ“ˆ</div>
            <div class="card-value" id="statsAvgLeaveUsage">-</div>
            <div class="card-label">1ì¸ë‹¹ í‰ê·  ì‚¬ìš©</div>
          </div>
          
          <div class="dashboard-card">
            <div class="card-icon">ğŸ¢</div>
            <div class="card-value" id="statsDepartmentCount">-</div>
            <div class="card-label">ìš´ì˜ ë¶€ì„œ ìˆ˜</div>
          </div>
          
          <div class="dashboard-card">
            <div class="card-icon">ğŸ¯</div>
            <div class="card-value" id="statsSystemHealth">-</div>
            <div class="card-label">ì‹œìŠ¤í…œ ê±´ì „ì„±</div>
          </div>
        </div>
      </div>
      
      <!-- ğŸ“‹ ë¶€ì„œë³„ í˜„í™© -->
      <div class="stats-section">
        <h3 class="stats-section-title">ğŸ“‹ ë¶€ì„œë³„ ì—°ì°¨ ì‚¬ìš© í˜„í™©</h3>
        <div class="table-container">
          <table class="table">
            <thead>
              <tr>
                <th>ë¶€ì„œëª…</th>
                <th>ì§ì› ìˆ˜</th>
                <th>í‰ê·  ì‚¬ìš©ë¥ </th>
                <th>ì”ì—¬ ì—°ì°¨</th>
                <th>ìƒíƒœ</th>
              </tr>
            </thead>
            <tbody id="departmentStatsTable">
              <tr>
                <td colspan="5" class="loading">ë¶€ì„œë³„ í˜„í™©ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      
      <!-- ğŸ’¾ ë°ì´í„° ê´€ë¦¬ -->
      <div class="stats-section">
        <h3 class="stats-section-title">ğŸ’¾ ë°ì´í„° ê´€ë¦¬</h3>
        <div class="data-management-grid">
          <div class="data-action-card">
            <div class="action-icon">ğŸ“¥</div>
            <div class="action-title">ë°ì´í„° ë‚´ë³´ë‚´ê¸°</div>
            <div class="action-desc">Excel í˜•íƒœë¡œ í†µê³„ ë°ì´í„° ë‹¤ìš´ë¡œë“œ</div>
            <button type="button" class="btn btn-secondary" onclick="exportData()">
              ğŸ“¥ ë‚´ë³´ë‚´ê¸°
            </button>
          </div>
          
          <div class="data-action-card">
            <div class="action-icon">ğŸ’¾</div>
            <div class="action-title">ì‹œìŠ¤í…œ ë°±ì—…</div>
            <div class="action-desc">ì „ì²´ ë°ì´í„° ë°±ì—… íŒŒì¼ ìƒì„±</div>
            <button type="button" class="btn btn-primary" onclick="backupData()">
              ğŸ’¾ ë°±ì—… ìƒì„±
            </button>
          </div>
          
          <div class="data-action-card">
            <div class="action-icon">ğŸ”„</div>
            <div class="action-title">í†µê³„ ìƒˆë¡œê³ ì¹¨</div>
            <div class="action-desc">ìµœì‹  ë°ì´í„°ë¡œ í†µê³„ ì—…ë°ì´íŠ¸</div>
            <button type="button" class="btn btn-success" onclick="loadStatistics()">
              ğŸ”„ ìƒˆë¡œê³ ì¹¨
            </button>
          </div>
        </div>
      </div>
    </div>
    <? } ?>

  </main>

  <!-- ğŸ”§ ì§ì› ìˆ˜ì • ëª¨ë‹¬ -->
  <div id="editEmployeeModal" class="modal-overlay">
    <div class="modal-container">
      <div class="modal-header">
        <h3 class="modal-title">âœï¸ ì§ì› ì •ë³´ ìˆ˜ì •</h3>
        <button class="modal-close" onclick="closeEditEmployeeModal()">Ã—</button>
      </div>
      
      <div class="modal-body">
        <form id="editEmployeeForm">
          <div class="form-row">
            <div class="form-col">
              <div class="form-group-modal">
                <label for="editEmpId">ì‚¬ë²ˆ</label>
                <input type="text" id="editEmpId" readonly>
              </div>
            </div>
            <div class="form-col">
              <div class="form-group-modal">
                <label for="editEmpName">ì´ë¦„ *</label>
                <input type="text" id="editEmpName" required>
              </div>
            </div>
          </div>
          
          <div class="form-group-modal">
            <label for="editEmpEmail">ì´ë©”ì¼ *</label>
            <input type="email" id="editEmpEmail" required>
          </div>
          
          <div class="form-group-modal">
            <label for="editEmpPhone">ì „í™”ë²ˆí˜¸</label>
            <input type="tel" id="editEmpPhone" placeholder="010-1234-5678">
          </div>
          
          <div class="form-row">
            <div class="form-col">
              <div class="form-group-modal">
                <label for="editEmpDept">ë¶€ì„œ *</label>
                <select id="editEmpDept" required>
                  <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                  <!-- ë¶€ì„œ ì˜µì…˜ë“¤ì´ JavaScriptë¡œ ë™ì  ë¡œë“œë©ë‹ˆë‹¤ -->
                </select>
              </div>
            </div>
            <div class="form-col">
              <div class="form-group-modal">
                <label for="editEmpPosition">ì§ê¸‰</label>
                <input type="text" id="editEmpPosition" placeholder="ì˜ˆ: ëŒ€ë¦¬">
              </div>
            </div>
          </div>
          
          <div class="checkbox-group">
            <input type="checkbox" id="resetPasswordCheckbox">
            <label for="resetPasswordCheckbox">ğŸ”‘ ë¹„ë°€ë²ˆí˜¸ë¥¼ temp123ìœ¼ë¡œ ì´ˆê¸°í™”</label>
          </div>
          
          <div id="editEmployeeMessage" class="alert" style="display: none; margin-top: 1rem;"></div>
        </form>
      </div>
      
      <div class="modal-footer">
        <button type="button" class="btn-modal btn-modal-secondary" onclick="closeEditEmployeeModal()">
          <span>ğŸš«</span> ì·¨ì†Œ
        </button>
        <button type="button" class="btn-modal btn-modal-primary" onclick="saveEmployeeChanges()">
          <span>ğŸ’¾</span> ì €ì¥
        </button>
      </div>
    </div>
  </div>

  <!-- ğŸ¢ ë¶€ì„œ ìˆ˜ì • ëª¨ë‹¬ (ê´€ë¦¬ì ì „ìš©) -->
  <!-- ì¼ë°˜ ì§ì›ì—ê²ŒëŠ” ë¶ˆí•„ìš”í•˜ë¯€ë¡œ ì£¼ì„ ì²˜ë¦¬ -->
  <!--
  <div id="editDepartmentModal" class="modal-overlay">
    <div class="modal-container">
      <div class="modal-header">
        <h3 class="modal-title">ğŸ¢ ë¶€ì„œ ì •ë³´ ìˆ˜ì •</h3>
        <button class="modal-close" onclick="closeEditDepartmentModal()">Ã—</button>
      </div>
      
      <div class="modal-body">
        <form id="editDepartmentForm">
          <div class="form-group-modal">
            <label for="editDeptId">ë¶€ì„œì½”ë“œ</label>
            <input type="text" id="editDeptId" readonly>
          </div>
          
          <div class="form-group-modal">
            <label for="editDeptName">ë¶€ì„œëª… *</label>
            <input type="text" id="editDeptName" required placeholder="ì˜ˆ: ë§ˆì¼€íŒ…íŒ€">
          </div>
          
          <div class="info-banner" style="margin-top: 1rem;">
            <div class="info-icon">â„¹ï¸</div>
            <div class="info-content">
              <strong>ë¶€ì„œ ìˆ˜ì • ì•ˆë‚´</strong>
              <ul class="info-list">
                <li>ë¶€ì„œì½”ë“œëŠ” ë³€ê²½í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤ (ì‹œìŠ¤í…œ ë¬´ê²°ì„± ë³´ì¥)</li>
                <li>ë¶€ì„œëª…ì€ ë‹¤ë¥¸ ë¶€ì„œì™€ ì¤‘ë³µë  ìˆ˜ ì—†ìŠµë‹ˆë‹¤</li>
                <li>ì†Œì† ì§ì›ë“¤ì—ê²Œ ìë™ìœ¼ë¡œ ë³€ê²½ì‚¬í•­ì´ ë°˜ì˜ë©ë‹ˆë‹¤</li>
              </ul>
            </div>
          </div>
          
          <div id="editDepartmentMessage" class="alert" style="display: none; margin-top: 1rem;"></div>
        </form>
      </div>
      
      <div class="modal-footer">
        <button type="button" class="btn-modal btn-modal-secondary" onclick="closeEditDepartmentModal()">
          <span>ğŸš«</span> ì·¨ì†Œ
        </button>
        <button type="button" class="btn-modal btn-modal-primary" onclick="saveDepartmentChanges()">
          <span>ğŸ’¾</span> ì €ì¥
        </button>
      </div>
    </div>
  </div>
  -->

  <!-- ì‚¬ìš©ì ì •ë³´ë¥¼ JavaScriptì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ìˆ¨ê²¨ì§„ ìš”ì†Œë¡œ ì „ë‹¬ -->
  <div id="userInfo" style="display: none;">
    <span id="userEmpId"><?= typeof user !== 'undefined' && user.empId ? user.empId : 'UNKNOWN' ?></span>
    <span id="userName"><?= typeof user !== 'undefined' && user.name ? user.name : 'ì‚¬ìš©ì' ?></span>
    <span id="userEmail"><?= typeof user !== 'undefined' && user.email ? user.email : 'unknown@company.com' ?></span>
    <span id="userPosition"><?= typeof user !== 'undefined' && user.position ? user.position : 'ì§ì›' ?></span>
    <span id="userIsAdmin"><?= typeof user !== 'undefined' && user.isAdmin ? user.isAdmin : false ?></span>
    <span id="userDepartment"><?= typeof user !== 'undefined' && user.department ? user.department : 'ë¯¸ì§€ì •' ?></span>
  </div>
  


  <!-- ğŸ”§ JavaScript -->
  <script>
    // ğŸ“š ì „ì—­ ë³€ìˆ˜ (ìˆ¨ê²¨ì§„ HTML ìš”ì†Œì—ì„œ ê°€ì ¸ì˜´)
    var currentUser = {};
    var allEmployees = []; // ì „ì—­ ì§ì› ëª©ë¡ ì €ì¥
    
    // ğŸ“„ í˜ì´ì§€ë„¤ì´ì…˜ ì „ì—­ ë³€ìˆ˜
    var currentPage = 1;
    var itemsPerPage = 10;
    var totalPages = 1;
    var filteredEmployees = []; // ê²€ìƒ‰ í•„í„°ë§ëœ ì§ì› ëª©ë¡
    
    // ì•ˆì „í•œ ì‚¬ìš©ì ì •ë³´ ë¡œë“œ
    try {
      const userEmpIdEl = document.getElementById('userEmpId');
      const userNameEl = document.getElementById('userName');
      const userEmailEl = document.getElementById('userEmail');
      const userPositionEl = document.getElementById('userPosition');
      const userIsAdminEl = document.getElementById('userIsAdmin');
      
      if (userEmpIdEl && userNameEl && userEmailEl && userPositionEl && userIsAdminEl) {
        currentUser = {
          empId: userEmpIdEl.textContent || 'UNKNOWN',
          name: userNameEl.textContent || 'ì‚¬ìš©ì',
          email: userEmailEl.textContent || 'unknown@company.com',
          position: userPositionEl.textContent || 'ì§ì›',
          isAdmin: userIsAdminEl.textContent === 'true'
        };
        console.log('âœ… ì‚¬ìš©ì ì •ë³´ ë¡œë“œ ì„±ê³µ:', currentUser);
      } else {
        console.error('âŒ ì‚¬ìš©ì ì •ë³´ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
        currentUser = {
          empId: 'ERROR',
          name: 'ì˜¤ë¥˜',
          email: 'error@company.com',
          position: 'ì˜¤ë¥˜',
          isAdmin: false
        };
      }
    } catch (error) {
      console.error('âŒ ì‚¬ìš©ì ì •ë³´ ë¡œë“œ ì˜¤ë¥˜:', error);
      currentUser = {
        empId: 'ERROR',
        name: 'ì˜¤ë¥˜',
        email: 'error@company.com',
        position: 'ì˜¤ë¥˜',
        isAdmin: false
      };
    }
    
    // ì „ì—­ ë³€ìˆ˜ ì„ ì–¸ (ì—°ì°¨ ì‹ ì²­ìš©)
    var selectedApprovers = [];
    var selectedCollaborators = [];
    
    /**
     * ğŸš€ í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
     */
    window.addEventListener('load', function() {
      try {
        // ì‚¬ìš©ì ì •ë³´ ë¡œë“œ
        currentUser = {
          empId: document.getElementById('userEmpId')?.textContent || 'UNKNOWN',
          name: document.getElementById('userName')?.textContent || 'ì‚¬ìš©ì',
          email: document.getElementById('userEmail')?.textContent || 'unknown@company.com',
          position: document.getElementById('userPosition')?.textContent || 'ì§ì›',
          isAdmin: document.getElementById('userIsAdmin')?.textContent === 'true',
          department: document.getElementById('userDepartment')?.textContent || 'ë¯¸ì§€ì •'
        };

        // ì‚¬ìš©ì ì •ë³´ ìœ íš¨ì„± ê²€ì‚¬
        if (currentUser.empId === 'UNKNOWN') {
          showErrorMessage('ì‚¬ìš©ì ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ê±°ë‚˜ ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
          return;
        }
        
        // ê¸°ë³¸ UI ì´ˆê¸°í™”
        initializeUI();
        
        // ëŒ€ì‹œë³´ë“œ í˜ì´ì§€ í‘œì‹œ
        showPage('dashboard');
        
        // ëŒ€ì‹œë³´ë“œ ë°ì´í„° ë¡œë“œ
        loadDashboardData();
      } catch (error) {
        console.error('âŒ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
        showErrorMessage('ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    });
    

    
    /**
     * ğŸ¨ UI ì´ˆê¸°í™”
     */
    function initializeUI() {
      // ì‚¬ìš©ìëª… í‘œì‹œ í™•ì¸
      const userButtons = document.querySelectorAll('.user-button');
      userButtons.forEach(button => {
        if (button.textContent.includes('<?= user.name ?>')) {
          button.innerHTML = `ğŸ‘¤ ${currentUser.name} <span style="margin-left: 0.5rem;">â–¼</span>`;
        }
      });
      
      // ëŒ€ì‹œë³´ë“œ ì¸ì‚¬ë§ ì—…ë°ì´íŠ¸
      const subtitle = document.querySelector('.page-subtitle');
      if (subtitle && subtitle.textContent.includes('<?= user.name ?>')) {
        subtitle.textContent = `ì•ˆë…•í•˜ì„¸ìš”, ${currentUser.name}ë‹˜! ì—°ì°¨ í˜„í™©ì„ í™•ì¸í•´ë³´ì„¸ìš”.`;
      }
      
      console.log('âœ… UI ì´ˆê¸°í™” ì™„ë£Œ');
    }
    
    /**
     * âŒ ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ
     */
    function showErrorMessage(message) {
      const errorDiv = document.createElement('div');
      errorDiv.style.cssText = 'position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: #f8d7da; color: #721c24; padding: 1rem; border-radius: 5px; z-index: 9999; border: 1px solid #f5c6cb;';
      errorDiv.textContent = message;
      document.body.appendChild(errorDiv);
      
      setTimeout(() => {
        document.body.removeChild(errorDiv);
      }, 5000);
    }
    
    /**
     * ğŸ“„ í˜ì´ì§€ ì „í™˜ í•¨ìˆ˜
     */
    function showPage(pageId) {
      console.log('í˜ì´ì§€ ì „í™˜:', pageId);
      
      // userManagementë¥¼ employeeManagementë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ (í˜¸í™˜ì„±)
      if (pageId === 'userManagement') {
        pageId = 'employeeManagement';
      }
      
      // ëª¨ë“  í˜ì´ì§€ ìˆ¨ê¹€
      document.querySelectorAll('.page').forEach(page => {
        page.classList.remove('active');
      });
      
      // ëª¨ë“  ë©”ë‰´ ë¹„í™œì„±í™”
      document.querySelectorAll('.menu-item').forEach(item => {
        item.classList.remove('active');
      });
      
      // ì„ íƒëœ í˜ì´ì§€ í‘œì‹œ
      const targetPage = document.getElementById(pageId + 'Page');
      if (targetPage) {
        targetPage.classList.add('active');
      }
      
      // í•´ë‹¹ ë©”ë‰´ í™œì„±í™” (ì •í™•í•œ ì„ íƒì ì‚¬ìš©)
      const menuItems = document.querySelectorAll('.menu-item');
      menuItems.forEach(item => {
        const onclick = item.getAttribute('onclick');
        if (onclick && onclick.includes(`showPage('${pageId}')`)) {
          item.classList.add('active');
          console.log('ë©”ë‰´ í™œì„±í™”:', pageId);
        }
      });
      
      // í˜ì´ì§€ë³„ ë°ì´í„° ë¡œë“œ
      loadPageData(pageId);
      
      // ì‚¬ìš©ì ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
      hideUserMenu();
    }
    
    /**
     * ğŸ·ï¸ í˜ì´ì§€ ì œëª© ë§¤í•‘
     */
    function getPageTitle(pageId) {
      const titles = {
        'dashboard': 'ëŒ€ì‹œë³´ë“œ',
        'leaveRequest': 'ì—°ì°¨ ì‹ ì²­',
        'myRequests': 'ë‚´ ì‹ ì²­ í˜„í™©',
        'approvals': 'ê²°ì¬/í˜‘ì¡° ì²˜ë¦¬',
        'myInfo': 'ë‚´ ì •ë³´',
        'changePassword': 'ë¹„ë°€ë²ˆí˜¸ ë³€ê²½',
        'adminMenu': 'ê´€ë¦¬ì ë©”ë‰´',
        'employeeManagement': 'ì§ì› ê´€ë¦¬',
        'userManagement': 'ì§ì› ê´€ë¦¬', // ê´€ë¦¬ì ë©”ë‰´ìš© ë³„ì¹­
        'departmentManagement': 'ë¶€ì„œ ê´€ë¦¬',
        'systemSettings': 'ì„¤ì •',
        'statistics': 'í†µê³„ ë° ë³´ê³ ì„œ'
      };
      return titles[pageId] || '';
    }
    
    /**
     * ğŸ“Š ëŒ€ì‹œë³´ë“œ ë°ì´í„° ë¡œë“œ
     */
    async function loadDashboardData() {
      try {
        console.log('ëŒ€ì‹œë³´ë“œ ë°ì´í„° ë¡œë“œ ì¤‘...');
        
        if (currentUser.isAdmin) {
          // ê´€ë¦¬ììš© ì‹œìŠ¤í…œ í˜„í™© ë°ì´í„° ë¡œë“œ
          const systemStats = await callServerFunction('getSystemStatistics');
          const departments = await callServerFunction('getDepartmentsQuick');
          
          if (systemStats) {
            document.getElementById('totalEmployees').textContent = systemStats.totalEmployees || '0';
            document.getElementById('totalRequests').textContent = systemStats.totalRequests || '0';
            document.getElementById('approvedRequests').textContent = systemStats.approvedRequests || '0';
            document.getElementById('totalDepartments').textContent = departments ? departments.length : '0';
          }
        } else {
          // ì§ì›ìš© ê°œì¸ ì—°ì°¨ ë°ì´í„° ë¡œë“œ (ë¹ ë¥¸ í•¨ìˆ˜ ì‚¬ìš©)
          const myLeaveInfo = await callServerFunction('getMyLeaveInfoFast', currentUser.empId);
          
          if (myLeaveInfo) {
            // ëŒ€ì‹œë³´ë“œ ì¹´ë“œ ì—…ë°ì´íŠ¸
            document.getElementById('remainingLeaves').textContent = myLeaveInfo.remainingLeaves || '15';
            document.getElementById('pendingRequests').textContent = myLeaveInfo.pendingRequests || '0';
            document.getElementById('pendingApprovals').textContent = myLeaveInfo.pendingApprovals || '0';
            document.getElementById('thisMonthUsed').textContent = myLeaveInfo.thisYearUsed || '0';
            
            // ë¶€ì„œ ì •ë³´ë„ í•¨ê»˜ ì—…ë°ì´íŠ¸ (ë¡œë”© ìƒíƒœ ì œê±°)
            const deptBadge = document.getElementById('dashboardDeptBadge');
            if (deptBadge) {
              deptBadge.classList.remove('loading-badge');
              deptBadge.innerHTML = myLeaveInfo.deptName || 'ë¶€ì„œ ë¯¸ì§€ì •';
              console.log('âœ… ëŒ€ì‹œë³´ë“œ ë¶€ì„œ ì •ë³´ ì—…ë°ì´íŠ¸ ì™„ë£Œ:', myLeaveInfo.deptName);
            }
            
            // ìµœê·¼ ì‹ ì²­ ë‚´ì—­ ë¡œë“œ
            loadRecentRequests();
          }
        }
        
      } catch (error) {
        console.error('ëŒ€ì‹œë³´ë“œ ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
        // ê¸°ë³¸ê°’ ì„¤ì •
        if (currentUser.isAdmin) {
          if (document.getElementById('totalEmployees')) document.getElementById('totalEmployees').textContent = '0';
          if (document.getElementById('totalRequests')) document.getElementById('totalRequests').textContent = '0';
          if (document.getElementById('approvedRequests')) document.getElementById('approvedRequests').textContent = '0';
          if (document.getElementById('totalDepartments')) document.getElementById('totalDepartments').textContent = '0';
        } else {
          if (document.getElementById('remainingLeaves')) document.getElementById('remainingLeaves').textContent = '15';
          if (document.getElementById('pendingRequests')) document.getElementById('pendingRequests').textContent = '0';
          if (document.getElementById('pendingApprovals')) document.getElementById('pendingApprovals').textContent = '0';
          if (document.getElementById('thisMonthUsed')) document.getElementById('thisMonthUsed').textContent = '0';
          
          // ì˜¤ë¥˜ ì‹œì—ë„ ë¶€ì„œ ë°°ì§€ ë¡œë”© ìƒíƒœ ì œê±°
          const deptBadge = document.getElementById('dashboardDeptBadge');
          if (deptBadge) {
            deptBadge.classList.remove('loading-badge');
            deptBadge.innerHTML = 'ë¶€ì„œ ì •ë³´ ë¡œë“œ ì‹¤íŒ¨';
          }
        }
      }
    }
    
    /**
     * ğŸ“ ìµœê·¼ ì‹ ì²­ ë‚´ì—­ ë¡œë“œ
     */
    async function loadRecentRequests() {
      try {
        const recentRequests = await callServerFunction('getRecentRequests', currentUser.empId);
        const tableBody = document.getElementById('recentRequestsTable');
        
        if (recentRequests && recentRequests.length > 0) {
          tableBody.innerHTML = recentRequests.map(request => `
            <tr>
              <td>${formatDate(request.submitDate)}</td>
              <td>${request.leaveType}</td>
              <td>${formatDate(request.startDate)} ~ ${formatDate(request.endDate)}</td>
              <td><span class="status-badge status-${getStatusClass(request.status)}">${request.status}</span></td>
              <td>${request.reason}</td>
            </tr>
          `).join('');
        } else {
          tableBody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #666;">ìµœê·¼ ì‹ ì²­ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
        }
        
      } catch (error) {
        console.error('ìµœê·¼ ì‹ ì²­ ë‚´ì—­ ë¡œë“œ ì˜¤ë¥˜:', error);
        document.getElementById('recentRequestsTable').innerHTML = 
          '<tr><td colspan="5" style="text-align: center; color: #dc3545;">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
      }
    }
    
    /**
     * ğŸ“„ í˜ì´ì§€ë³„ ë°ì´í„° ë¡œë“œ
     */
    function loadPageData(pageId) {
      try {
        // í˜ì´ì§€ ì „í™˜ ì „ ëª¨ë“  ëª¨ë‹¬ ë‹«ê¸°
        const modals = document.querySelectorAll('.modal-overlay');
        modals.forEach(modal => {
          modal.style.display = 'none';
        });

        switch (pageId) {
          case 'dashboard':
            loadDashboardData();
            break;
          case 'myRequests':
            loadMyRequests();
            break;
          case 'approvals':
            loadApprovals();
            break;
          case 'myInfo':
            loadMyInfo();
            break;
          case 'workSchedule':
            loadWorkSchedulePage();
            break;
          case 'leaveRequest':
            initializeLeaveRequestForm();
            break;
          case 'employeeManagement':
            if (currentUser.isAdmin) {
              loadEmployeeManagement();
            }
            break;
          case 'departmentManagement':
            if (currentUser.isAdmin) {
              loadDepartmentManagement();
            }
            break;
          case 'systemSettings':
            if (currentUser.isAdmin) {
              loadSystemSettings();
            }
            break;
          case 'statistics':
            loadStatistics();
            break;
          default:
            console.warn('âš ï¸ ì•Œ ìˆ˜ ì—†ëŠ” í˜ì´ì§€:', pageId);
        }
      } catch (error) {
        console.error('âŒ í˜ì´ì§€ ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
        showErrorMessage('í˜ì´ì§€ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      }
    }
    
    /**
     * ğŸ“ ì„œë²„ í•¨ìˆ˜ í˜¸ì¶œ í—¬í¼
     */
    function callServerFunction(functionName, ...args) {
      return new Promise((resolve, reject) => {
        try {
          // Google Apps Script í™˜ê²½ í™•ì¸
          if (typeof google === 'undefined' || !google.script || !google.script.run) {
            throw new Error('Google Apps Script í™˜ê²½ì´ ì•„ë‹™ë‹ˆë‹¤. êµ¬ê¸€ ì‹œíŠ¸ì—ì„œ ì‹¤í–‰í•´ì£¼ì„¸ìš”.');
          }

          // í•¨ìˆ˜ ì¡´ì¬ ì—¬ë¶€ í™•ì¸
          if (!google.script.run[functionName]) {
            throw new Error(`ì„œë²„ í•¨ìˆ˜ '${functionName}'ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
          }

          console.log(`ğŸ“ ì„œë²„ í•¨ìˆ˜ í˜¸ì¶œ: ${functionName}(${args.join(', ')})`);
          
          // íƒ€ì„ì•„ì›ƒ ì„¤ì • (30ì´ˆ)
          const timeoutId = setTimeout(() => {
            reject(new Error(`ì„œë²„ í•¨ìˆ˜ '${functionName}' í˜¸ì¶œ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤. (30ì´ˆ)`));
          }, 30000);

          google.script.run
            .withSuccessHandler((result) => {
              clearTimeout(timeoutId);
              console.log(`âœ… ì„œë²„ í•¨ìˆ˜ ì„±ê³µ: ${functionName}`, result);
              resolve(result);
            })
            .withFailureHandler((error) => {
              clearTimeout(timeoutId);
              console.error(`âŒ ì„œë²„ í•¨ìˆ˜ ì‹¤íŒ¨: ${functionName}`, error);
              
              // ì—ëŸ¬ ë©”ì‹œì§€ ì •ë¦¬
              let errorMessage = 'ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
              if (error && typeof error === 'string') {
                errorMessage = error;
              } else if (error && error.message) {
                errorMessage = error.message;
              } else if (error && error.toString) {
                errorMessage = error.toString();
              }
              
              reject(new Error(errorMessage));
            })
            [functionName](...args);
            
        } catch (error) {
          console.error(`âŒ ì„œë²„ í•¨ìˆ˜ í˜¸ì¶œ ì˜¤ë¥˜: ${functionName}`, error);
          reject(error);
        }
      });
    }
    
    /**
     * ğŸ“… ë‚ ì§œ í¬ë§·íŒ…
     */
    function formatDate(dateString) {
      if (!dateString) return '-';
      const date = new Date(dateString);
      return date.toLocaleDateString('ko-KR');
    }
    
    /**
     * ğŸ·ï¸ ìƒíƒœë³„ CSS í´ë˜ìŠ¤
     */
    function getStatusClass(status) {
      switch (status) {
        case 'ëŒ€ê¸°': return 'pending';
        case 'ìŠ¹ì¸': return 'approved';
        case 'ë°˜ë ¤': return 'rejected';
        default: return 'pending';
      }
    }
    
    /**
     * ğŸ‘¤ ì‚¬ìš©ì ë©”ë‰´ í† ê¸€
     */
    function toggleUserMenu() {
      const dropdown = document.getElementById('userDropdown');
      const isVisible = dropdown.style.display === 'block';
      dropdown.style.display = isVisible ? 'none' : 'block';
    }
    
    /**
     * ğŸ™ˆ ì‚¬ìš©ì ë©”ë‰´ ìˆ¨ê¹€
     */
    function hideUserMenu() {
      document.getElementById('userDropdown').style.display = 'none';
    }
    
    /**
     * ğŸ”” ì•Œë¦¼ í‘œì‹œ
     */
    function showNotifications() {
      alert('ì•Œë¦¼ ê¸°ëŠ¥ì€ ê°œë°œ ì¤‘ì…ë‹ˆë‹¤.');
    }
    
    /**
     * ğŸ“ ì—°ì°¨ ì‹ ì²­ í¼ ì´ˆê¸°í™”
     */
    function initializeLeaveRequestForm() {
      // ì˜¤ëŠ˜ ë‚ ì§œë¥¼ ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¤ì •
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('startDate').value = today;
      document.getElementById('endDate').value = today;
      
      // ì„ íƒëœ ê²°ì¬ì/í˜‘ì¡°ì ì´ˆê¸°í™”
      selectedApprovers = [];
      selectedCollaborators = [];
      updateSelectedApprovers();
      updateSelectedCollaborators();
    }
    
    /**
     * ğŸ“… ì—°ì°¨ ì¼ìˆ˜ ìë™ ê³„ì‚°
     */
    function calculateLeaveDays() {
      const startDate = document.getElementById('startDate').value;
      const endDate = document.getElementById('endDate').value;
      const leaveType = document.getElementById('leaveType').value;
      
      if (startDate && endDate && leaveType) {
        const days = calculateDays(startDate, endDate, leaveType);
        document.getElementById('calculatedDays').value = days + 'ì¼';
      } else {
        document.getElementById('calculatedDays').value = '';
      }
    }
    
    /**
     * ğŸ“ ì—°ì°¨ ì‹ ì²­ ì œì¶œ
     */
    async function submitLeaveRequest(event) {
      event.preventDefault();
      
      if (selectedApprovers.length === 0) {
        alert('ê²°ì¬ìë¥¼ ìµœì†Œ 1ëª… ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
      }
      
      // í•„ìˆ˜ í•„ë“œ ê²€ì¦
      const startDate = document.getElementById('startDate').value;
      const endDate = document.getElementById('endDate').value;
      const leaveType = document.getElementById('leaveType').value;
      const reason = document.getElementById('reason').value;
      
      if (!startDate || !endDate || !leaveType || !reason) {
        alert('ëª¨ë“  í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      // ì—°ì°¨ ì¼ìˆ˜ ê³„ì‚°
      const days = calculateLeaveDaysForSubmit(startDate, endDate, leaveType);
      
      const formData = {
        empId: currentUser.empId, // í˜„ì¬ ì‚¬ìš©ì ID
        startDate: startDate,
        endDate: endDate,
        days: days, // ê³„ì‚°ëœ ì¼ìˆ˜
        leaveType: leaveType,
        reason: reason,
        approvers: selectedApprovers.map(a => a.empId), // ê²°ì¬ì ID ë°°ì—´
        collaborators: selectedCollaborators.map(c => c.empId) // í˜‘ì¡°ì ID ë°°ì—´
      };
      
      try {
        console.log('ì—°ì°¨ ì‹ ì²­ ë°ì´í„°:', formData);
        showLoading(true);
        const result = await callServerFunction('submitLeaveRequest', formData);
        
        console.log('ì„œë²„ ì‘ë‹µ:', result);
        
        if (result && result.success) {
          showNotification('ì—°ì°¨ ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
          document.getElementById('leaveRequestForm').reset();
          selectedApprovers = [];
          selectedCollaborators = [];
          updateSelectedApprovers();
          updateSelectedCollaborators();
          showPage('myRequests');
        } else {
          const errorMessage = result && result.message ? result.message : 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
          showNotification('ì—°ì°¨ ì‹ ì²­ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + errorMessage, 'error');
        }
      } catch (error) {
        console.error('ì—°ì°¨ ì‹ ì²­ ì˜¤ë¥˜:', error);
        showNotification('ì—°ì°¨ ì‹ ì²­ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
      } finally {
        showLoading(false);
      }
    }
    
    // ì—°ì°¨ ì‹ ì²­ìš© ì „ì²´ ì§ì› ëª©ë¡ ë³€ìˆ˜
    let leaveEmployeeList = []; // ì „ì²´ ì§ì› ëª©ë¡
    
    /**
     * ğŸ‘¥ ê²°ì¬ì ì„ íƒ ëª¨ë‹¬ ì—´ê¸°
     */
    async function openApproverModal() {
      try {
        // ë¡œë”© í‘œì‹œ ì‹œì‘
        showLoading(true);

        // ì§ì› ëª©ë¡ ë¡œë“œ
        const employees = await callServerFunction('getEmployeesForWeb');
        if (!employees || !Array.isArray(employees)) {
          throw new Error('ì§ì› ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        }

        // í˜„ì¬ ì‚¬ìš©ì ID
        const currentUserId = document.getElementById('userEmpId')?.textContent;
        if (!currentUserId) {
          throw new Error('ì‚¬ìš©ì ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        }

        // ëª¨ë‹¬ ìƒì„± ë° ìŠ¤íƒ€ì¼ ì ìš©
        const modalHtml = `
          <div class="modal-overlay" id="approverModal">
            <div class="modal-container" style="width: 80%; max-width: 800px; max-height: 80vh; margin: 10vh auto;">
              <div class="modal-header">
                <h3>ê²°ì¬ì/í˜‘ì¡°ì ì„ íƒ</h3>
                <button class="close-button" onclick="closeApproverModal()">Ã—</button>
              </div>
              <div class="modal-body" style="max-height: calc(80vh - 180px); overflow-y: auto;">
                <div class="search-box">
                  <input type="text" id="employeeSearchInput" placeholder="ì´ë¦„ ë˜ëŠ” ë¶€ì„œë¡œ ê²€ìƒ‰..." 
                         onkeyup="filterEmployees(this.value)">
                </div>
                <div id="employeeList" class="employee-list">
                  ${employees
                    .filter(emp => emp && emp.empId && emp.empId !== currentUserId)
                    .map(emp => `
                      <div class="employee-item ${selectedApprovers.some(a => a.empId === emp.empId) ? 'selected' : ''}"
                           data-employee='${JSON.stringify(emp)}'
                           onclick="toggleLeaveApprover(this.dataset.employee)">
                        <div class="employee-info">
                          <div class="employee-name">${emp.name || 'ì´ë¦„ ì—†ìŒ'}</div>
                          <div class="employee-position">${emp.position || 'ì§ê¸‰ ë¯¸ì§€ì •'}</div>
                        </div>
                        <div class="employee-dept">${emp.deptName || 'ë¶€ì„œ ë¯¸ì§€ì •'}</div>
                      </div>
                    `).join('')}
                </div>
              </div>
              <div class="modal-footer">
                <button class="btn-modal btn-modal-secondary" onclick="closeApproverModal()">ì·¨ì†Œ</button>
                <button class="btn-modal btn-modal-primary" onclick="confirmApprovers()">í™•ì¸</button>
              </div>
            </div>
          </div>
        `;

        // ê¸°ì¡´ ëª¨ë‹¬ì´ ìˆë‹¤ë©´ ì œê±°
        const existingModal = document.getElementById('approverModal');
        if (existingModal) {
          existingModal.remove();
        }

        // ìƒˆ ëª¨ë‹¬ ì¶”ê°€
        document.body.insertAdjacentHTML('beforeend', modalHtml);

      } catch (error) {
        console.error('ê²°ì¬ì ëª¨ë‹¬ ì˜¤ë¥˜:', error);
        showNotification('ê²°ì¬ì ì„ íƒ ëª¨ë‹¬ì„ ì—´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
      } finally {
        showLoading(false);
      }
    }
    
    /**
     * ğŸ¤ í˜‘ì¡°ì ì„ íƒ ëª¨ë‹¬ ì—´ê¸°
     */
    async function openCollaboratorModal() {
      try {
        // ë¡œë”© í‘œì‹œ ì‹œì‘
        showLoading(true);

        // ì§ì› ëª©ë¡ ë¡œë“œ
        const employees = await callServerFunction('getEmployeesForWeb');
        if (!employees || !Array.isArray(employees)) {
          throw new Error('ì§ì› ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        }

        // í˜„ì¬ ì‚¬ìš©ì ID
        const currentUserId = document.getElementById('userEmpId')?.textContent;
        if (!currentUserId) {
          throw new Error('ì‚¬ìš©ì ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        }

        // ëª¨ë‹¬ ìƒì„± ë° ìŠ¤íƒ€ì¼ ì ìš©
        const modalHtml = `
          <div class="modal-overlay" id="collaboratorModal">
            <div class="modal-container" style="width: 80%; max-width: 800px; max-height: 80vh; margin: 10vh auto;">
              <div class="modal-header">
                <h3>í˜‘ì¡°ì ì„ íƒ</h3>
                <button class="close-button" onclick="closeCollaboratorModal()">Ã—</button>
              </div>
              <div class="modal-body" style="max-height: calc(80vh - 180px); overflow-y: auto;">
                <div class="search-box">
                  <input type="text" id="employeeSearchInput" placeholder="ì´ë¦„ ë˜ëŠ” ë¶€ì„œë¡œ ê²€ìƒ‰..." 
                         onkeyup="filterEmployees(this.value)">
                </div>
                <div id="employeeList" class="employee-list">
                  ${employees
                    .filter(emp => emp && emp.empId && emp.empId !== currentUserId)
                    .map(emp => `
                      <div class="employee-item ${selectedCollaborators.some(c => c.empId === emp.empId) ? 'selected' : ''}"
                           data-employee='${JSON.stringify(emp)}'
                           onclick="toggleLeaveCollaborator(this.dataset.employee)">
                        <div class="employee-info">
                          <div class="employee-name">${emp.name || 'ì´ë¦„ ì—†ìŒ'}</div>
                          <div class="employee-position">${emp.position || 'ì§ê¸‰ ë¯¸ì§€ì •'}</div>
                        </div>
                        <div class="employee-dept">${emp.deptName || 'ë¶€ì„œ ë¯¸ì§€ì •'}</div>
                      </div>
                    `).join('')}
                </div>
              </div>
              <div class="modal-footer">
                <button class="btn-modal btn-modal-secondary" onclick="closeCollaboratorModal()">ì·¨ì†Œ</button>
                <button class="btn-modal btn-modal-primary" onclick="confirmCollaborators()">í™•ì¸</button>
              </div>
            </div>
          </div>
        `;

        // ê¸°ì¡´ ëª¨ë‹¬ì´ ìˆë‹¤ë©´ ì œê±°
        const existingModal = document.getElementById('collaboratorModal');
        if (existingModal) {
          existingModal.remove();
        }

        // ìƒˆ ëª¨ë‹¬ ì¶”ê°€
        document.body.insertAdjacentHTML('beforeend', modalHtml);

      } catch (error) {
        console.error('í˜‘ì¡°ì ëª¨ë‹¬ ì˜¤ë¥˜:', error);
        showNotification('í˜‘ì¡°ì ì„ íƒ ëª¨ë‹¬ì„ ì—´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
      } finally {
        showLoading(false);
      }
    }
    
    /**
     * ğŸ“… ì—°ì°¨ ì¼ìˆ˜ ê³„ì‚° (í™”ë©´ í‘œì‹œìš©)
     */
    function calculateLeaveDays() {
      const startDate = document.getElementById('startDate').value;
      const endDate = document.getElementById('endDate').value;
      const leaveType = document.getElementById('leaveType').value;
      
      if (!startDate || !endDate || !leaveType) {
        document.getElementById('calculatedDays').value = '';
        return;
      }
      
      const calculatedDays = calculateLeaveDaysForSubmit(startDate, endDate, leaveType);
      document.getElementById('calculatedDays').value = calculatedDays + 'ì¼';
    }

    /**
     * ğŸ“… ì—°ì°¨ ì¼ìˆ˜ ê³„ì‚° (ì„œë²„ ì „ì†¡ìš©)
     */
    function calculateLeaveDaysForSubmit(startDate, endDate, leaveType) {
      if (!startDate || !endDate || !leaveType) {
        return 0;
      }
      
      const start = new Date(startDate);
      const end = new Date(endDate);
      const diffTime = Math.abs(end - start);
      const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;
      
      let calculatedDays = 0;
      
      switch (leaveType) {
        case 'ì—°ì°¨':
          calculatedDays = diffDays;
          break;
        case 'ë°˜ì°¨':
          calculatedDays = 0.5;
          break;
        case 'íŠ¹ë³„íœ´ê°€':
          calculatedDays = diffDays;
          break;
        default:
          calculatedDays = 0;
      }
      
      return calculatedDays;
    }

    /**
     * ğŸ‘¥ ê²°ì¬ì í† ê¸€ ì„ íƒ
     */
    function toggleLeaveApprover(employeeData) {
      const employee = JSON.parse(employeeData);
      const index = selectedApprovers.findIndex(a => a.empId === employee.empId);
      
      if (index > -1) {
        selectedApprovers.splice(index, 1);
      } else {
        selectedApprovers.push(employee);
      }
      
      updateSelectedApprovers();
    }

    /**
     * ğŸ¤ í˜‘ì¡°ì í† ê¸€ ì„ íƒ
     */
    function toggleLeaveCollaborator(employeeData) {
      const employee = JSON.parse(employeeData);
      const index = selectedCollaborators.findIndex(c => c.empId === employee.empId);
      
      if (index > -1) {
        selectedCollaborators.splice(index, 1);
      } else {
        selectedCollaborators.push(employee);
      }
      
      updateSelectedCollaborators();
    }

    /**
     * ğŸ‘¥ ì„ íƒëœ ê²°ì¬ì ì—…ë°ì´íŠ¸
     */
    function updateSelectedApprovers() {
      const container = document.getElementById('selectedApprovers');
      if (!container) return;
      
      if (selectedApprovers.length === 0) {
        container.innerHTML = '<p style="color: #666; font-style: italic;">ì„ íƒëœ ê²°ì¬ìê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
        return;
      }
      
      container.innerHTML = selectedApprovers.map((approver, index) => `
        <div class="selected-employee">
          <span class="employee-name">${approver.name}</span>
          <span class="employee-dept">${approver.deptName}</span>
          <button type="button" class="btn-remove" onclick="removeApprover(${index})">Ã—</button>
        </div>
      `).join('');
    }

    /**
     * ğŸ¤ ì„ íƒëœ í˜‘ì¡°ì ì—…ë°ì´íŠ¸
     */
    function updateSelectedCollaborators() {
      const container = document.getElementById('selectedCollaborators');
      if (!container) return;
      
      if (selectedCollaborators.length === 0) {
        container.innerHTML = '<p style="color: #666; font-style: italic;">ì„ íƒëœ í˜‘ì¡°ìê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
        return;
      }
      
      container.innerHTML = selectedCollaborators.map((collaborator, index) => `
        <div class="selected-employee">
          <span class="employee-name">${collaborator.name}</span>
          <span class="employee-dept">${collaborator.deptName}</span>
          <button type="button" class="btn-remove" onclick="removeCollaborator(${index})">Ã—</button>
        </div>
      `).join('');
    }

    /**
     * âŒ ê²°ì¬ì ì œê±°
     */
    function removeApprover(index) {
      selectedApprovers.splice(index, 1);
      updateSelectedApprovers();
    }

    /**
     * âŒ í˜‘ì¡°ì ì œê±°
     */
    function removeCollaborator(index) {
      selectedCollaborators.splice(index, 1);
      updateSelectedCollaborators();
    }

    /**
     * âœ… ê²°ì¬ì í™•ì¸
     */
    function confirmApprovers() {
      closeApproverModal();
      updateSelectedApprovers();
    }

    /**
     * âœ… í˜‘ì¡°ì í™•ì¸
     */
    function confirmCollaborators() {
      closeCollaboratorModal();
      updateSelectedCollaborators();
    }

    /**
     * âŒ ê²°ì¬ì ëª¨ë‹¬ ë‹«ê¸°
     */
    function closeApproverModal() {
      const modal = document.getElementById('approverModal');
      if (modal) {
        modal.remove();
      }
    }

    /**
     * âŒ í˜‘ì¡°ì ëª¨ë‹¬ ë‹«ê¸°
     */
    function closeCollaboratorModal() {
      const modal = document.getElementById('collaboratorModal');
      if (modal) {
        modal.remove();
      }
    }

    /**
     * ğŸ” ì§ì› ëª©ë¡ í•„í„°ë§
     */
    function filterEmployees(keyword) {
      const employees = Array.from(document.querySelectorAll('.employee-item'));
      employees.forEach(item => {
        const name = item.querySelector('.employee-name').textContent.toLowerCase();
        const dept = item.querySelector('.employee-dept').textContent.toLowerCase();
        const keywordLower = keyword.toLowerCase();
        
        if (name.includes(keywordLower) || dept.includes(keywordLower)) {
          item.style.display = 'block';
        } else {
          item.style.display = 'none';
        }
      });
    }

    /**
     * ğŸ” ê²°ì¬ì ëª©ë¡ í•„í„°ë§
     */
    function filterLeaveApproverList(keyword) {
      const employees = Array.from(document.querySelectorAll('#leaveApproverList .employee-item'));
      employees.forEach(item => {
        const text = item.textContent.toLowerCase();
        const search = keyword.toLowerCase();
        item.style.display = text.includes(search) ? '' : 'none';
      });
    }
    
    /**
     * ğŸ” í˜‘ì¡°ì ëª©ë¡ í•„í„°ë§
     */
    function filterLeaveCollaboratorList(keyword) {
      const employees = Array.from(document.querySelectorAll('#leaveCollaboratorList .employee-item'));
      employees.forEach(item => {
        const text = item.textContent.toLowerCase();
        const search = keyword.toLowerCase();
        item.style.display = text.includes(search) ? '' : 'none';
      });
    }
    
    /**
     * âœ… ê²°ì¬ì í† ê¸€ ì„ íƒ
     */
    function toggleLeaveApprover(empData) {
      const emp = typeof empData === 'string' ? JSON.parse(empData) : empData;
      const index = selectedApprovers.findIndex(a => a.empId === emp.empId);
      
      if (index === -1) {
        selectedApprovers.push(emp);
      } else {
        selectedApprovers.splice(index, 1);
      }
      
      // ì„ íƒ ìƒíƒœ UI ì—…ë°ì´íŠ¸
      const employeeItem = document.querySelector(`.employee-item[data-employee='${JSON.stringify(emp)}']`);
      if (employeeItem) {
        employeeItem.classList.toggle('selected');
      }
    }
    
    /**
     * âœ… í˜‘ì¡°ì í† ê¸€ ì„ íƒ
     */
    function toggleLeaveCollaborator(empData) {
      const emp = typeof empData === 'string' ? JSON.parse(empData) : empData;
      const index = selectedCollaborators.findIndex(c => c.empId === emp.empId);
      
      if (index === -1) {
        selectedCollaborators.push(emp);
      } else {
        selectedCollaborators.splice(index, 1);
      }
      
      // ì„ íƒ ìƒíƒœ UI ì—…ë°ì´íŠ¸
      const employeeItem = document.querySelector(`.employee-item[data-employee='${JSON.stringify(emp)}']`);
      if (employeeItem) {
        employeeItem.classList.toggle('selected');
      }
    }
    
    /**
     * âŒ ê²°ì¬ì ì„ íƒ ëª¨ë‹¬ ë‹«ê¸°
     */
    function closeLeaveApproverModal() {
      const modal = document.getElementById('approverModal');
      if (modal) {
        modal.remove();
      }
    }
    
    /**
     * âŒ í˜‘ì¡°ì ì„ íƒ ëª¨ë‹¬ ë‹«ê¸°
     */
    function closeCollaboratorModal() {
      const modal = document.getElementById('collaboratorModal');
      if (modal) {
        modal.remove();
      }
    }
    
    /**
     * âœ… ê²°ì¬ì ì„ íƒ ì™„ë£Œ
     */
    function confirmLeaveApproverSelection() {
      if (selectedApprovers.length === 0) {
        alert('ê²°ì¬ìë¥¼ ìµœì†Œ 1ëª… ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
      }
      updateSelectedApprovers();
      closeLeaveApproverModal();
    }
    
    /**
     * âœ… í˜‘ì¡°ì ì„ íƒ ì™„ë£Œ
     */
    function confirmLeaveCollaboratorSelection() {
      updateSelectedCollaborators();
      closeCollaboratorModal();
    }
    
    /**
     * ğŸ“‹ ì„ íƒëœ ê²°ì¬ì ì—…ë°ì´íŠ¸
     */
    function updateSelectedApprovers() {
      const container = document.getElementById('selectedApprovers');
      if (selectedApprovers.length === 0) {
        container.innerHTML = '<p style="color: #666; font-style: italic;">ì„ íƒëœ ê²°ì¬ìê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
      } else {
        container.innerHTML = selectedApprovers.map((approver, index) => `
          <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem; background: #f8f9fa; border-radius: 5px; margin-bottom: 0.5rem;">
            <span>${index + 1}. ${approver.name} (${approver.position})</span>
            <button type="button" onclick="removeApprover(${index})" style="background: #dc3545; color: white; border: none; border-radius: 3px; padding: 0.25rem 0.5rem; cursor: pointer;">ì œê±°</button>
          </div>
        `).join('');
      }
    }
    
    /**
     * ğŸ“‹ ì„ íƒëœ í˜‘ì¡°ì ì—…ë°ì´íŠ¸
     */
    function updateSelectedCollaborators() {
      const container = document.getElementById('selectedCollaborators');
      if (selectedCollaborators.length === 0) {
        container.innerHTML = '<p style="color: #666; font-style: italic;">ì„ íƒëœ í˜‘ì¡°ìê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
      } else {
        container.innerHTML = selectedCollaborators.map((collaborator, index) => `
          <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem; background: #f8f9fa; border-radius: 5px; margin-bottom: 0.5rem;">
            <span>${collaborator.name} (${collaborator.position})</span>
            <button type="button" onclick="removeCollaborator(${index})" style="background: #dc3545; color: white; border: none; border-radius: 3px; padding: 0.25rem 0.5rem; cursor: pointer;">ì œê±°</button>
          </div>
        `).join('');
      }
    }
    
    /**
     * âŒ ê²°ì¬ì ì œê±°
     */
    function removeApprover(index) {
      selectedApprovers.splice(index, 1);
      updateSelectedApprovers();
    }
    
    /**
     * âŒ í˜‘ì¡°ì ì œê±°
     */
    function removeCollaborator(index) {
      selectedCollaborators.splice(index, 1);
      updateSelectedCollaborators();
    }
    
    /**
     * ğŸ“Š ë‚´ ì‹ ì²­ í˜„í™© ë¡œë“œ (ì™„ì „ ì¬ì‘ì„±)
     */
    async function loadMyRequests() {
      console.log('ğŸš€ loadMyRequests í•¨ìˆ˜ ì‹œì‘');
      
      const tableBody = document.getElementById('myRequestsTable');
      
      try {
        // 1. ê¸°ë³¸ í™˜ê²½ í™•ì¸
        console.log('ğŸ” í™˜ê²½ í™•ì¸ ì¤‘...');
        if (typeof google === 'undefined' || !google.script || !google.script.run) {
          throw new Error('Google Apps Script í™˜ê²½ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
        }
        
        // 2. ì‚¬ìš©ì ì •ë³´ í™•ì¸
        console.log('ğŸ‘¤ ì‚¬ìš©ì ì •ë³´ í™•ì¸ ì¤‘...');
        const empIdElement = document.getElementById('userEmpId');
        const userNameElement = document.getElementById('userName');
        
        if (!empIdElement || !empIdElement.textContent) {
          throw new Error('ì‚¬ìš©ì IDë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
        }
        
        const empId = empIdElement.textContent.trim();
        const userName = userNameElement ? userNameElement.textContent.trim() : 'ì‚¬ìš©ì';
        
        console.log('ğŸ‘¤ ì‚¬ìš©ì ì •ë³´:', { empId, userName, type: typeof empId });
        
        if (!empId || empId === 'UNKNOWN' || empId === 'ERROR') {
          throw new Error(`ìœ íš¨í•˜ì§€ ì•Šì€ ì‚¬ìš©ì ID: ${empId}`);
        }

        // 3. ë¡œë”© ìƒíƒœ í‘œì‹œ
        console.log('â³ ë¡œë”© ìƒíƒœ í‘œì‹œ');
        tableBody.innerHTML = `
          <tr>
            <td colspan="8" style="text-align: center; color: #666; padding: 2rem;">
              <div style="display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                <div style="width: 20px; height: 20px; border: 2px solid #ddd; border-top: 2px solid #667eea; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                <span>ğŸ“Š ${userName}ë‹˜ì˜ ì—°ì°¨ ì‹ ì²­ í˜„í™©ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</span>
              </div>
            </td>
          </tr>
        `;
        
        // 4. ì„œë²„ í•¨ìˆ˜ ì§ì ‘ í˜¸ì¶œ (Promise ë°©ì‹)
        console.log('ğŸ“ ì„œë²„ í•¨ìˆ˜ í˜¸ì¶œ ì‹œì‘ - getMyRequests:', empId);
        
        const myRequests = await new Promise((resolve, reject) => {
          const timeoutId = setTimeout(() => {
            reject(new Error('ì„œë²„ ì‘ë‹µ ì‹œê°„ ì´ˆê³¼ (30ì´ˆ)'));
          }, 30000);
          
          google.script.run
            .withSuccessHandler((result) => {
              clearTimeout(timeoutId);
              console.log('âœ… getMyRequests ì„œë²„ ì‘ë‹µ ì„±ê³µ:', result);
              resolve(result);
            })
            .withFailureHandler((error) => {
              clearTimeout(timeoutId);
              console.error('âŒ getMyRequests ì„œë²„ ì‘ë‹µ ì‹¤íŒ¨:', error);
              reject(new Error(error.toString()));
            })
            .getMyRequests(empId);
        });
        
        // 5. ì‘ë‹µ ì²˜ë¦¬
        console.log('ğŸ“‹ ì‘ë‹µ ë°ì´í„° ì²˜ë¦¬ ì‹œì‘:', { 
          type: typeof myRequests, 
          isArray: Array.isArray(myRequests),
          isNull: myRequests === null,
          length: myRequests ? myRequests.length : 'N/A'
        });
        
        // ì˜¤ë¥˜ ì‘ë‹µ ì²˜ë¦¬
        if (myRequests && typeof myRequests === 'object' && myRequests.error) {
          console.error('ğŸš¨ ì„œë²„ ì˜¤ë¥˜ ì‘ë‹µ:', myRequests);
          throw new Error(`ì„œë²„ ì˜¤ë¥˜: ${myRequests.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`);
        }
        
        // null ì‘ë‹µ ì²˜ë¦¬
        if (myRequests === null || myRequests === undefined) {
          console.warn('âš ï¸ ì„œë²„ì—ì„œ null/undefined ì‘ë‹µ');
          throw new Error('ì„œë²„ì—ì„œ ì‘ë‹µì„ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ë¡œê·¸ì¸ ìƒíƒœë¥¼ í™•ì¸í•˜ê±°ë‚˜ í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
        }
        
        // ì •ìƒ ë°ì´í„° ì²˜ë¦¬
        if (Array.isArray(myRequests) && myRequests.length > 0) {
          console.log('âœ… ì‹ ì²­ ë‚´ì—­ ë°œê²¬:', myRequests.length, 'ê±´');
          console.log('ğŸ“‹ ì²« ë²ˆì§¸ ì‹ ì²­ ë°ì´í„°:', myRequests[0]);
          
          tableBody.innerHTML = myRequests.map((request, index) => {
            console.log(`ğŸ“‹ ì²˜ë¦¬ ì¤‘ ${index + 1}/${myRequests.length}:`, request);
            return `
              <tr>
                <td>${request.reqId || '-'}</td>
                <td>${formatDate(request.submitDate)}</td>
                <td>${request.leaveType || '-'}</td>
                <td>${formatDate(request.startDate)} ~ ${formatDate(request.endDate)}</td>
                <td>${request.days || 0}ì¼</td>
                <td><span class="status-badge status-${getStatusClass(request.status)}">${request.status || 'ëŒ€ê¸°'}</span></td>
                <td>${request.reason || '-'}</td>
                <td><button onclick="showApprovalStatus('${request.reqId}')" class="btn btn-secondary" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;">ìƒì„¸ë³´ê¸°</button></td>
              </tr>
            `;
          }).join('');
          
          console.log('âœ… ë‚´ ì‹ ì²­ í˜„í™© ë¡œë“œ ì™„ë£Œ');
          showNotification(`ì—°ì°¨ ì‹ ì²­ í˜„í™© ${myRequests.length}ê±´ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.`, 'success');
          
        } else {
          console.log('â„¹ï¸ ì‹ ì²­ ë‚´ì—­ ì—†ìŒ');
          tableBody.innerHTML = `
            <tr>
              <td colspan="8" style="text-align: center; color: #666; padding: 2rem;">
                <div style="text-align: center;">
                  <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ“</div>
                  <div style="font-size: 1.1rem; margin-bottom: 0.5rem;">ì•„ì§ ì‹ ì²­í•œ ì—°ì°¨ê°€ ì—†ìŠµë‹ˆë‹¤</div>
                  <div style="color: #999; font-size: 0.9rem;">ì—°ì°¨ ì‹ ì²­ í˜ì´ì§€ì—ì„œ ìƒˆë¡œìš´ ì—°ì°¨ë¥¼ ì‹ ì²­í•´ë³´ì„¸ìš”!</div>
                </div>
              </td>
            </tr>
          `;
        }
        
      } catch (error) {
        console.error('âŒ ë‚´ ì‹ ì²­ í˜„í™© ë¡œë“œ ì „ì²´ ì˜¤ë¥˜:', error);
        console.error('âŒ ì˜¤ë¥˜ ìŠ¤íƒ:', error.stack);
        
        // êµ¬ì²´ì ì¸ ì˜¤ë¥˜ ë©”ì‹œì§€
        let errorMessage = 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
        if (error.message) {
          errorMessage = error.message;
        } else if (typeof error === 'string') {
          errorMessage = error;
        }
        
        tableBody.innerHTML = `
          <tr>
            <td colspan="8" style="text-align: center; color: #dc3545; padding: 2rem;">
              <div style="text-align: center;">
                <div style="font-size: 3rem; margin-bottom: 1rem;">âš ï¸</div>
                <div style="font-size: 1.1rem; margin-bottom: 1rem; color: #dc3545;">
                  ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤
                </div>
                <div style="color: #666; font-size: 0.9rem; margin-bottom: 1rem;">
                  ${errorMessage}
                </div>
                <button onclick="loadMyRequests()" class="btn btn-primary" style="padding: 0.5rem 1rem;">
                  ğŸ”„ ë‹¤ì‹œ ì‹œë„
                </button>
              </div>
            </td>
          </tr>
        `;
        
        // ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
        showNotification(`ë‚´ ì‹ ì²­ í˜„í™©ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${errorMessage}`, 'error');
      }
    }
    
    /**
     * ğŸ“Š ê²°ì¬ í˜„í™© ìƒì„¸ë³´ê¸°
     */
    function showApprovalStatus(reqId) {
      alert('ê²°ì¬ í˜„í™© ìƒì„¸ë³´ê¸° ê¸°ëŠ¥ì€ ê°œë°œ ì¤‘ì…ë‹ˆë‹¤. ì‹ ì²­ID: ' + reqId);
    }
    
    /**
     * âœ… ê²°ì¬/í˜‘ì¡° ì²˜ë¦¬ ëª©ë¡ ë¡œë“œ
     */
    async function loadApprovals() {
      try {
        // ê²°ì¬ ëŒ€ê¸° ëª©ë¡
        const pendingApprovals = await callServerFunction('getPendingApprovals', currentUser.empId);
        const approvalsTable = document.getElementById('pendingApprovalsTable');
        
        if (pendingApprovals && pendingApprovals.length > 0) {
          approvalsTable.innerHTML = pendingApprovals.map(request => `
            <tr>
              <td>${request.reqId}</td>
              <td>${request.applicantName}</td>
              <td>${request.leaveType}</td>
              <td>${formatDate(request.startDate)} ~ ${formatDate(request.endDate)}</td>
              <td>${request.days}ì¼</td>
              <td>${request.reason}</td>
              <td>
                <button onclick="processApproval('${request.reqId}', 'approve')" class="btn btn-success" style="padding: 0.25rem 0.5rem; font-size: 0.8rem; margin-right: 0.25rem;">ìŠ¹ì¸</button>
                <button onclick="processApproval('${request.reqId}', 'reject')" class="btn btn-danger" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;">ë°˜ë ¤</button>
              </td>
            </tr>
          `).join('');
        } else {
          approvalsTable.innerHTML = '<tr><td colspan="7" style="text-align: center; color: #666;">ê²°ì¬ ëŒ€ê¸° ê±´ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
        }
        
        // í˜‘ì¡° ëŒ€ê¸° ëª©ë¡
        const pendingCollaborations = await callServerFunction('getPendingCollaborations', currentUser.empId);
        const collaborationsTable = document.getElementById('pendingCollaborationsTable');
        
        if (pendingCollaborations && pendingCollaborations.length > 0) {
          collaborationsTable.innerHTML = pendingCollaborations.map(request => `
            <tr>
              <td>${request.reqId}</td>
              <td>${request.applicantName}</td>
              <td>${request.leaveType}</td>
              <td>${formatDate(request.startDate)} ~ ${formatDate(request.endDate)}</td>
              <td>${request.days}ì¼</td>
              <td>${request.reason}</td>
              <td>
                <button onclick="processCollaboration('${request.reqId}', 'approve')" class="btn btn-success" style="padding: 0.25rem 0.5rem; font-size: 0.8rem; margin-right: 0.25rem;">í˜‘ì¡°</button>
                <button onclick="processCollaboration('${request.reqId}', 'reject')" class="btn btn-danger" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;">ê±°ë¶€</button>
              </td>
            </tr>
          `).join('');
        } else {
          collaborationsTable.innerHTML = '<tr><td colspan="7" style="text-align: center; color: #666;">í˜‘ì¡° ëŒ€ê¸° ê±´ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
        }
        
      } catch (error) {
        console.error('ê²°ì¬/í˜‘ì¡° ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
        document.getElementById('pendingApprovalsTable').innerHTML = 
          '<tr><td colspan="7" style="text-align: center; color: #dc3545;">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
        document.getElementById('pendingCollaborationsTable').innerHTML = 
          '<tr><td colspan="7" style="text-align: center; color: #dc3545;">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
      }
    }
    
    /**
     * âœ… ê²°ì¬ ì²˜ë¦¬
     */
    async function processApproval(reqId, action) {
      const comment = prompt(action === 'approve' ? 'ìŠ¹ì¸ ì˜ê²¬ì„ ì…ë ¥í•˜ì„¸ìš” (ì„ íƒì‚¬í•­):' : 'ë°˜ë ¤ ì‚¬ìœ ë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
      
      if (action === 'reject' && !comment) {
        alert('ë°˜ë ¤ ì‹œì—ëŠ” ì‚¬ìœ ë¥¼ ë°˜ë“œì‹œ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      try {
        showLoading(true);
        const result = await callServerFunction('processApproval', reqId, action, comment || '');
        
        if (result.success) {
          showNotification(action === 'approve' ? 'ìŠ¹ì¸ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.' : 'ë°˜ë ¤ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
          loadApprovals(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
          updateNotificationBadge(); // ì•Œë¦¼ ë°°ì§€ ì—…ë°ì´íŠ¸
        } else {
          showNotification('ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + result.error, 'error');
        }
      } catch (error) {
        console.error('ê²°ì¬ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
        showNotification('ê²°ì¬ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
      } finally {
        showLoading(false);
      }
    }
    
    /**
     * ğŸ¤ í˜‘ì¡° ì²˜ë¦¬
     */
    async function processCollaboration(reqId, action) {
      const comment = prompt(action === 'approve' ? 'í˜‘ì¡° ì˜ê²¬ì„ ì…ë ¥í•˜ì„¸ìš” (ì„ íƒì‚¬í•­):' : 'ê±°ë¶€ ì‚¬ìœ ë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
      
      try {
        showLoading(true);
        const result = await callServerFunction('processCollaboration', reqId, action, comment || '');
        
        if (result.success) {
          showNotification(action === 'approve' ? 'í˜‘ì¡° ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.' : 'ê±°ë¶€ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
          loadApprovals(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
          updateNotificationBadge(); // ì•Œë¦¼ ë°°ì§€ ì—…ë°ì´íŠ¸
        } else {
          showNotification('ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + result.error, 'error');
        }
      } catch (error) {
        console.error('í˜‘ì¡° ì²˜ë¦¬ ì˜¤ë¥˜:', error);
        showNotification('í˜‘ì¡° ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
      } finally {
        showLoading(false);
      }
    }
    
    /**
     * ğŸ‘¤ ë‚´ ì •ë³´ ë¡œë“œ
     */
    async function loadMyInfo() {
      try {
        // ë¹ ë¥¸ ë¶€ì„œ ì •ë³´ ë¡œë“œë¥¼ ìœ„í•´ ìµœì í™”ëœ í•¨ìˆ˜ ì‚¬ìš©
        const myLeaveInfo = await callServerFunction('getMyLeaveInfoFast', currentUser.empId);
        const container = document.getElementById('myLeaveInfo');
        
        if (myLeaveInfo) {
          // ë‚´ ì •ë³´ í˜ì´ì§€ì˜ ë¶€ì„œëª… ì—…ë°ì´íŠ¸
          const deptNameInput = document.getElementById('myInfoDeptName');
          if (deptNameInput) {
            // ë¡œë”© ìƒíƒœ ì œê±°
            deptNameInput.classList.remove('loading-input');
            deptNameInput.value = myLeaveInfo.deptName || 'ë¶€ì„œ ë¯¸ì§€ì •';
          }
          
          // ëŒ€ì‹œë³´ë“œ í—¤ë”ì˜ ë¶€ì„œ ë°°ì§€ ì—…ë°ì´íŠ¸
          const deptBadge = document.getElementById('dashboardDeptBadge');
          if (deptBadge) {
            // ë¡œë”© ìƒíƒœ ì œê±°
            deptBadge.classList.remove('loading-badge');
            deptBadge.innerHTML = myLeaveInfo.deptName || 'ë¶€ì„œ ë¯¸ì§€ì •';
          }
          
          // ê´€ë¦¬ìì¸ ê²½ìš° íŠ¹ë³„ ì²˜ë¦¬
          if (myLeaveInfo.isAdmin) {
            container.innerHTML = `
              <div class="dashboard-card admin-info">
                <div class="card-icon">ğŸ”</div>
                <div class="card-value">ê´€ë¦¬ì</div>
                <div class="card-label">ì‹œìŠ¤í…œ ê´€ë¦¬ì</div>
              </div>
              <div class="dashboard-card admin-info">
                <div class="card-icon">âš™ï¸</div>
                <div class="card-value">ëª¨ë“  ê¶Œí•œ</div>
                <div class="card-label">ê´€ë¦¬ ê¶Œí•œ</div>
              </div>
              <div class="dashboard-card admin-info">
                <div class="card-icon">ğŸ“Š</div>
                <div class="card-value">ë¬´ì œí•œ</div>
                <div class="card-label">ì‹œìŠ¤í…œ ì ‘ê·¼</div>
              </div>
              <div class="dashboard-card admin-info">
                <div class="card-icon">â„¹ï¸</div>
                <div class="card-value">-</div>
                <div class="card-label">ì—°ì°¨ ì •ë³´ ì—†ìŒ</div>
              </div>
            `;
          } else if (myLeaveInfo.error) {
            // ì˜¤ë¥˜ê°€ ìˆëŠ” ê²½ìš°
            container.innerHTML = `
              <div class="dashboard-card error">
                <div class="card-icon">âš ï¸</div>
                <div class="card-value">ì˜¤ë¥˜</div>
                <div class="card-label">${myLeaveInfo.error}</div>
              </div>
            `;
          } else {
            // ì¼ë°˜ ì§ì›ì¸ ê²½ìš° ê¸°ì¡´ ë¡œì§
            container.innerHTML = `
              <div class="dashboard-card">
                <div class="card-icon">ğŸ‘¤</div>
                <div class="card-value">${myLeaveInfo.empName || currentUser.name}</div>
                <div class="card-label">ì´ë¦„</div>
              </div>
              <div class="dashboard-card">
                <div class="card-icon">ğŸ¢</div>
                <div class="card-value">${myLeaveInfo.deptName || 'ë¶€ì„œ ë¯¸ì§€ì •'}</div>
                <div class="card-label">ì†Œì† ë¶€ì„œ</div>
              </div>
              <div class="dashboard-card">
                <div class="card-icon">ğŸ“…</div>
                <div class="card-value">${myLeaveInfo.totalLeaves || 15}</div>
                <div class="card-label">ì´ ì—°ì°¨ ì¼ìˆ˜</div>
              </div>
              <div class="dashboard-card">
                <div class="card-icon">âœ…</div>
                <div class="card-value">${myLeaveInfo.usedLeaves || 0}</div>
                <div class="card-label">ì‚¬ìš©í•œ ì—°ì°¨</div>
              </div>
              <div class="dashboard-card">
                <div class="card-icon">ğŸ“Š</div>
                <div class="card-value">${myLeaveInfo.remainingLeaves || 15}</div>
                <div class="card-label">ë‚¨ì€ ì—°ì°¨</div>
              </div>
              <div class="dashboard-card">
                <div class="card-icon">ğŸ“ˆ</div>
                <div class="card-value">${myLeaveInfo.thisYearUsed || 0}</div>
                <div class="card-label">ì˜¬í•´ ì‚¬ìš©</div>
              </div>
            `;
          }
        }
      } catch (error) {
        console.error('ë‚´ ì •ë³´ ë¡œë“œ ì˜¤ë¥˜:', error);
        document.getElementById('myLeaveInfo').innerHTML = 
          '<p style="text-align: center; color: #dc3545;">TypeError: google.script.run.withSuccessHandler(...).withFailureHandler(...)[functionName] is not a function<br/>ì„œë²„ í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.</p>';
      }
    }
    
    /**
     * ğŸ”‘ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
     */
    async function changePassword(event) {
      event.preventDefault();
      
      const currentPassword = document.getElementById('currentPassword').value;
      const newPassword = document.getElementById('newPassword').value;
      const confirmPassword = document.getElementById('confirmPassword').value;
      
      if (newPassword !== confirmPassword) {
        alert('ìƒˆ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
        return;
      }
      
      if (newPassword.length < 8) {
        alert('ìƒˆ ë¹„ë°€ë²ˆí˜¸ëŠ” 8ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
        return;
      }
      
      try {
        showLoading(true);
        const result = await callServerFunction('changePassword', currentPassword, newPassword);
        
        if (result && result.success) {
          showNotification('ë¹„ë°€ë²ˆí˜¸ê°€ ì„±ê³µì ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
          document.getElementById('changePasswordForm').reset();
        } else {
          const errorMessage = result && result.message ? result.message : 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
          showNotification('ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì‹¤íŒ¨: ' + errorMessage, 'error');
        }
      } catch (error) {
        console.error('ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì˜¤ë¥˜:', error);
        showNotification('ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
      } finally {
        showLoading(false);
      }
    }
    
    /**
     * ğŸ”„ ì•Œë¦¼ ë°°ì§€ ì—…ë°ì´íŠ¸
     */
    async function updateNotificationBadge() {
      try {
        const notificationCount = await callServerFunction('getNotificationCount', currentUser.empId);
        const badge = document.getElementById('notificationBadge');
        
        if (badge) {
          if (notificationCount > 0) {
            badge.textContent = notificationCount;
            badge.style.display = 'block';
          } else {
            badge.style.display = 'none';
          }
        }
      } catch (error) {
        console.error('ì•Œë¦¼ ë°°ì§€ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
      }
    }
    
    /**
     * ğŸšª ë¡œê·¸ì•„ì›ƒ
     */
    async function logout() {
      if (confirm('ì •ë§ ë¡œê·¸ì•„ì›ƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        try {
          // ë¡œë”© í‘œì‹œ
          showLoading(true);
          
          const result = await callServerFunction('doLogout');
          
          if (result && result.success !== false) {
            // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
            showNotification('ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤. ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.', 'success');
            
            // ì„œë²„ì—ì„œ ë¡œê·¸ì¸ í˜ì´ì§€ HTMLì„ ì§ì ‘ ê°€ì ¸ì™€ì„œ êµì²´
            try {
              const loginPageResult = await callServerFunction('getLoginPageAfterLogout');
              
              if (loginPageResult && loginPageResult.success && loginPageResult.html) {
                // í˜„ì¬ í˜ì´ì§€ ì „ì²´ë¥¼ ë¡œê·¸ì¸ í˜ì´ì§€ HTMLë¡œ êµì²´
                document.open();
                document.write(loginPageResult.html);
                document.close();
              } else {
                throw new Error('ë¡œê·¸ì¸ í˜ì´ì§€ HTML ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨');
              }
            } catch (htmlError) {
              // HTML êµì²´ ì‹¤íŒ¨ ì‹œ URL ë¦¬ë‹¤ì´ë ‰íŠ¸ë¡œ í´ë°±
              const baseUrl = window.location.href.split('?')[0];
              window.location.replace(baseUrl + '?logout=true&t=' + new Date().getTime());
            }
            
          } else {
            throw new Error(result.message || 'ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬ ì‹¤íŒ¨');
          }
          
        } catch (error) {
          showLoading(false);
          
          showNotification('ë¡œê·¸ì•„ì›ƒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤.', 'error');
          
          // ì˜¤ë¥˜ê°€ ë°œìƒí•´ë„ ê°•ì œë¡œ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ (ì„¸ì…˜ ì‚­ì œ ì‹œë„)
          setTimeout(() => {
            const baseUrl = window.location.href.split('?')[0];
            window.location.replace(baseUrl + '?logout=true&t=' + new Date().getTime());
          }, 1500);
        }
      }
    }
    
    /**
     * ğŸ“± ì™¸ë¶€ í´ë¦­ ì‹œ ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
     */
    document.addEventListener('click', function(event) {
      if (!event.target.closest('.user-menu')) {
        hideUserMenu();
      }
    });
    
    // ì›¹ì•± ê³µí†µ í•¨ìˆ˜ë“¤
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = 'notification ' + type;
      notification.textContent = message;
      notification.style.cssText = 
        'position: fixed;' +
        'top: 20px;' +
        'right: 20px;' +
        'padding: 15px 20px;' +
        'border-radius: 5px;' +
        'color: white;' +
        'font-weight: bold;' +
        'z-index: 1000;' +
        'animation: slideIn 0.3s ease-out;' +
        (type === 'success' ? 'background-color: #4CAF50;' : '') +
        (type === 'error' ? 'background-color: #f44336;' : '') +
        (type === 'info' ? 'background-color: #2196F3;' : '');
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease-in';
        setTimeout(() => {
          document.body.removeChild(notification);
        }, 300);
      }, 3000);
    }

    function showLoading(show = true) {
      let loader = document.getElementById('loading');
      if (show) {
        if (!loader) {
          loader = document.createElement('div');
          loader.id = 'loading';
          loader.innerHTML = '<div class="spinner"></div><p>ì²˜ë¦¬ ì¤‘...</p>';
          loader.style.cssText = 
            'position: fixed;' +
            'top: 0;' +
            'left: 0;' +
            'width: 100%;' +
            'height: 100%;' +
            'background-color: rgba(0,0,0,0.5);' +
            'display: flex;' +
            'flex-direction: column;' +
            'justify-content: center;' +
            'align-items: center;' +
            'z-index: 2000;' +
            'color: white;';
          document.body.appendChild(loader);
        }
        loader.style.display = 'flex';
      } else {
        if (loader) {
          loader.style.display = 'none';
        }
      }
    }

    function calculateDays(startDate, endDate, leaveType) {
      if (!startDate || !endDate) return 0;
      
      const start = new Date(startDate);
      const end = new Date(endDate);
      const diffTime = Math.abs(end - start);
      const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;
      
      if (leaveType === 'ë°˜ì°¨') {
        return 0.5;
      } else if (leaveType === 'ì—°ì°¨') {
        return diffDays;
      } else {
        return diffDays; // íŠ¹ë³„íœ´ê°€ëŠ” ì‹¤ì œ ì¼ìˆ˜
      }
    }

    /**
     * ğŸ”” ì•Œë¦¼ í™•ì¸ í•¨ìˆ˜
     */
    async function checkNotifications() {
      try {
        const notifications = await callServerFunction('getNotifications');
        updateNotificationBadge();
        return notifications;
      } catch (error) {
        console.error('ì•Œë¦¼ í™•ì¸ ì˜¤ë¥˜:', error);
        return [];
      }
    }
    
    // 60ì´ˆë§ˆë‹¤ ì•Œë¦¼ í™•ì¸ (ë„¤íŠ¸ì›Œí¬ ìš”ì²­ ë¹ˆë„ ì¤„ì„)
    setInterval(checkNotifications, 60000);

    // =====================================
    // ğŸ“… ê·¼ë¬´í‘œ ê´€ë¦¬ í•¨ìˆ˜ë“¤
    // =====================================

    /**
     * ğŸ“… ê·¼ë¬´í‘œ í˜ì´ì§€ ë¡œë“œ
     */
    async function loadWorkSchedulePage() {
      try {
        console.log('ğŸ“… ê·¼ë¬´í‘œ í˜ì´ì§€ ë¡œë“œ ì‹œì‘...');
        
        // ì‚¬ìš©ì ë¶€ì„œ ì •ë³´ ë¡œë“œ (ë¹„ë™ê¸° ì²˜ë¦¬)
        loadUserDepartmentInfo().then(() => {
          console.log('âœ… ì‚¬ìš©ì ë¶€ì„œ ì •ë³´ ë¡œë“œ ì™„ë£Œ');
        }).catch(error => {
          console.error('âŒ ì‚¬ìš©ì ë¶€ì„œ ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:', error);
        });
        
        // í˜„ì¬ ì›”ë¡œ ê¸°ë³¸ ì„¤ì •
        const now = new Date();
        const currentMonth = `${now.getFullYear()}-${(now.getMonth() + 1).toString().padStart(2, '0')}`;
        document.getElementById('scheduleMonth').value = currentMonth;
        
        console.log('âœ… ê·¼ë¬´í‘œ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
        
      } catch (error) {
        console.error('âŒ ê·¼ë¬´í‘œ í˜ì´ì§€ ë¡œë“œ ì˜¤ë¥˜:', error);
        showNotification('ê·¼ë¬´í‘œ í˜ì´ì§€ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
      }
    }

    /**
     * ğŸ‘¤ í˜„ì¬ ì‚¬ìš©ì ID ê°€ì ¸ì˜¤ê¸°
     */
    function getCurrentUserId() {
      // ì„¸ì…˜ì—ì„œ ì‚¬ìš©ì ID ê°€ì ¸ì˜¤ê¸°
      const session = getValidSession();
      if (session) {
        return session.userType === 'admin' ? session.adminId : session.empId;
      }
      return null;
    }

    /**
     * ğŸ‘¤ í˜„ì¬ ì‚¬ìš©ì ë¶€ì„œ ID ê°€ì ¸ì˜¤ê¸°
     */
    function getCurrentUserDeptId() {
      // ì„¸ì…˜ì—ì„œ ë¶€ì„œ ID ê°€ì ¸ì˜¤ê¸° (ì„ì‹œ)
      const session = getValidSession();
      if (session && session.userType === 'employee') {
        return session.deptId || null;
      }
      return null;
    }

    /**
     * ğŸ‘¤ ì‚¬ìš©ì ë¶€ì„œ ì •ë³´ ë¡œë“œ
     */
    async function loadUserDepartmentInfo() {
      try {
        // í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        const userInfo = await callServerFunction('getMyLeaveInfoFast', getCurrentUserId());
        
        if (userInfo && userInfo.deptName) {
          // ë¶€ì„œ ì •ë³´ í‘œì‹œ
          document.getElementById('userDeptName').textContent = userInfo.deptName;
          
          // ì‚¬ìš©ì ë¶€ì„œ ID ì €ì¥ (ê·¼ë¬´í‘œ ìƒì„± ì‹œ ì‚¬ìš©)
          window.currentUserDeptId = userInfo.deptId || getCurrentUserDeptId();
          
          console.log('âœ… ì‚¬ìš©ì ë¶€ì„œ ì •ë³´ ë¡œë“œ ì™„ë£Œ:', userInfo.deptName);
        } else {
          document.getElementById('userDeptName').textContent = 'ë¶€ì„œ ì •ë³´ ì—†ìŒ';
          console.warn('âš ï¸ ì‚¬ìš©ì ë¶€ì„œ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        }
        
      } catch (error) {
        console.error('âŒ ì‚¬ìš©ì ë¶€ì„œ ì •ë³´ ë¡œë“œ ì˜¤ë¥˜:', error);
        document.getElementById('userDeptName').textContent = 'ë¶€ì„œ ì •ë³´ ë¡œë“œ ì‹¤íŒ¨';
        showNotification('ë¶€ì„œ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
      }
    }

    /**
     * ğŸ“Š ê·¼ë¬´í‘œ ë°ì´í„° ë¡œë“œ
     */
    async function loadWorkScheduleData() {
      const scheduleMonth = document.getElementById('scheduleMonth').value;
      const userDeptId = window.currentUserDeptId;
      
      if (!userDeptId || !scheduleMonth) {
        // ì‚¬ìš©ì ë¶€ì„œ ì •ë³´ê°€ ì—†ê±°ë‚˜ ì›”ì´ ì„ íƒë˜ì§€ ì•Šì€ ê²½ìš°
        showEmptyScheduleState();
        return;
      }
      
      try {
        console.log('ğŸ“Š ê·¼ë¬´í‘œ ë¡œë“œ ì¤‘...', userDeptId, scheduleMonth);
        
        // ë¡œë”© ìƒíƒœ í‘œì‹œ
        showScheduleLoading();
        
        const [year, month] = scheduleMonth.split('-');
        const scheduleData = await callServerFunction('getWorkScheduleData', userDeptId, parseInt(year), parseInt(month));
        
        if (scheduleData) {
          displayWorkSchedule(scheduleData);
        } else {
          showScheduleNotFound(userDeptId, year, month);
        }
        
      } catch (error) {
        console.error('âŒ ê·¼ë¬´í‘œ ë¡œë“œ ì˜¤ë¥˜:', error);
        showScheduleError();
      }
    }

    /**
     * ğŸ“Š ê·¼ë¬´í‘œ ë°ì´í„° ë¡œë“œ (ê¸°ì¡´ í•¨ìˆ˜ëª… ìœ ì§€)
     */
    async function loadWorkSchedule() {
      const scheduleMonth = document.getElementById('scheduleMonth').value;
      const userDeptId = window.currentUserDeptId;
      
      if (!userDeptId || !scheduleMonth) {
        // ì‚¬ìš©ì ë¶€ì„œ ì •ë³´ê°€ ì—†ê±°ë‚˜ ì›”ì´ ì„ íƒë˜ì§€ ì•Šì€ ê²½ìš°
        showEmptyScheduleState();
        return;
      }
      
      try {
        console.log('ğŸ“Š ê·¼ë¬´í‘œ ë¡œë“œ ì¤‘...', userDeptId, scheduleMonth);
        
        // ë¡œë”© ìƒíƒœ í‘œì‹œ
        showScheduleLoading();
        
        const [year, month] = scheduleMonth.split('-');
        const scheduleData = await callServerFunction('getWorkScheduleData', userDeptId, parseInt(year), parseInt(month));
        
        if (scheduleData) {
          displayWorkSchedule(scheduleData);
        } else {
          showScheduleNotFound(userDeptId, year, month);
        }
        
      } catch (error) {
        console.error('âŒ ê·¼ë¬´í‘œ ë¡œë“œ ì˜¤ë¥˜:', error);
        showScheduleError();
      }
    }

    /**
     * ğŸ“‹ ê·¼ë¬´í‘œ ì‹œíŠ¸ ìƒì„±
     */
    async function createWorkScheduleSheet() {
      const scheduleMonth = document.getElementById('scheduleMonth').value;
      const userDeptId = window.currentUserDeptId;
      
      if (!userDeptId || !scheduleMonth) {
        showNotification('ë¶€ì„œ ì •ë³´ê°€ ì—†ê±°ë‚˜ ì›”ì„ ì„ íƒí•´ì£¼ì„¸ìš”.', 'warning');
        return;
      }
      
      const confirmed = confirm('ìƒˆë¡œìš´ ê·¼ë¬´í‘œ ì‹œíŠ¸ë¥¼ ìƒì„±í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nê¸°ì¡´ ë°ì´í„°ê°€ ìˆë‹¤ë©´ ë®ì–´ì“°ì—¬ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
      if (!confirmed) return;
      
      try {
        showLoading(true);
        
        const [year, month] = scheduleMonth.split('-');
        const result = await callServerFunction('createWorkScheduleSheet', userDeptId, parseInt(year), parseInt(month));
        
        if (result.success) {
          showNotification('ê·¼ë¬´í‘œ ì‹œíŠ¸ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
          // ìƒì„± í›„ ìë™ìœ¼ë¡œ ë¡œë“œ
          await loadWorkSchedule();
        } else {
          showNotification('ê·¼ë¬´í‘œ ìƒì„± ì‹¤íŒ¨: ' + result.error, 'error');
        }
        
      } catch (error) {
        console.error('âŒ ê·¼ë¬´í‘œ ìƒì„± ì˜¤ë¥˜:', error);
        showNotification('ê·¼ë¬´í‘œ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
      } finally {
        showLoading(false);
      }
    }

    /**
     * ğŸ“… ê·¼ë¬´í‘œ í‘œì‹œ
     */
    function displayWorkSchedule(scheduleData) {
      const container = document.getElementById('workScheduleContainer');
      
      if (!scheduleData || !scheduleData.employeeData || scheduleData.employeeData.length === 0) {
        showScheduleNotFound();
        return;
      }
      
      // í…Œì´ë¸” HTML ìƒì„±
      let tableHTML = `
        <table class="work-schedule-table">
          <thead>
            <tr class="schedule-title">
              <td colspan="${scheduleData.columnHeaders.length}">${scheduleData.title || 'ê·¼ë¬´í‘œ'}</td>
            </tr>
            <tr class="schedule-header">
              ${scheduleData.columnHeaders.map(header => `<th>${header}</th>`).join('')}
            </tr>
          </thead>
          <tbody>
      `;
      
      // ì§ì› ë°ì´í„° í–‰ ì¶”ê°€
      scheduleData.employeeData.forEach(row => {
        tableHTML += '<tr>';
        row.forEach((cell, index) => {
          const cellClass = getCellClass(cell, index, scheduleData);
          tableHTML += `<td class="${cellClass}">${cell || ''}</td>`;
        });
        tableHTML += '</tr>';
      });
      
      tableHTML += '</tbody></table>';
      
      container.innerHTML = tableHTML;
    }

    /**
     * ğŸ“‹ ë¹ˆ ìƒíƒœ í‘œì‹œ
     */
    function showEmptyScheduleState() {
      const container = document.getElementById('workScheduleContainer');
      container.innerHTML = `
        <div class="empty-state">
          <div class="empty-icon">ğŸ“…</div>
          <h3>ê·¼ë¬´í‘œê°€ ì—†ìŠµë‹ˆë‹¤</h3>
          <p>ì„ íƒí•œ ì›”ì˜ ê·¼ë¬´í‘œê°€ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>
          <button onclick="createWorkScheduleSheet()" class="btn btn-primary">
            ğŸ“‹ ê·¼ë¬´í‘œ ìƒì„±
          </button>
        </div>
      `;
    }

    /**
     * ğŸ” ê·¼ë¬´í‘œ ì—†ìŒ ìƒíƒœ í‘œì‹œ
     */
    function showScheduleNotFound(deptId, year, month) {
      const container = document.getElementById('workScheduleContainer');
      container.innerHTML = `
        <div class="empty-state">
          <div class="empty-icon">ğŸ”</div>
          <h3>ê·¼ë¬´í‘œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</h3>
          <p>${year}ë…„ ${month}ì›”ì˜ ê·¼ë¬´í‘œê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
          <button onclick="createWorkScheduleSheet()" class="btn btn-primary">
            ğŸ“‹ ê·¼ë¬´í‘œ ìƒì„±
          </button>
        </div>
      `;
    }

    /**
     * â³ ë¡œë”© ìƒíƒœ í‘œì‹œ
     */
    function showScheduleLoading() {
      const container = document.getElementById('workScheduleContainer');
      container.innerHTML = `
        <div class="loading-state">
          <div class="loading-spinner"></div>
          <p>ê·¼ë¬´í‘œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        </div>
      `;
    }

    /**
     * âŒ ì˜¤ë¥˜ ìƒíƒœ í‘œì‹œ
     */
    function showScheduleError() {
      const container = document.getElementById('workScheduleContainer');
      container.innerHTML = `
        <div class="error-state">
          <div class="error-icon">âŒ</div>
          <h3>ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤</h3>
          <p>ê·¼ë¬´í‘œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>
          <button onclick="loadWorkScheduleData()" class="btn btn-secondary">
            ğŸ”„ ë‹¤ì‹œ ì‹œë„
          </button>
        </div>
      `;
    }

    /**
     * ğŸ¨ ì…€ í´ë˜ìŠ¤ ê²°ì •
     */
    function getCellClass(cellValue, columnIndex, scheduleData) {
      // ê¸°ë³¸ í´ë˜ìŠ¤
      let classes = [];
      
      // ì§ì› ì •ë³´ ì—´ (ì‚¬ë²ˆ, ì´ë¦„ ë“±)
      if (columnIndex < 4) {
        classes.push('employee-info');
      }
      
      // ì—°ì°¨ í‘œì‹œ
      if (cellValue === 'Y') {
        classes.push('leave-full');
      } else if (cellValue === 'Y/2') {
        classes.push('leave-half');
      } else if (cellValue === 'D') {
        classes.push('work-day');
      } else if (cellValue === 'OFF') {
        classes.push('holiday');
      }
      
      // ì£¼ë§ ìƒ‰ìƒ (ì¶”í›„ êµ¬í˜„)
      // TODO: ë‚ ì§œ ì •ë³´ë¥¼ í†µí•´ ì£¼ë§ íŒë‹¨
      
      return classes.join(' ');
    }

    /**
     * ğŸ”„ ë¡œë”© ìƒíƒœ í‘œì‹œ
     */
    function showScheduleLoading() {
      const container = document.getElementById('workScheduleContainer');
      container.innerHTML = `
        <div class="schedule-loading">
          <div class="spinner"></div>
          <h3>ê·¼ë¬´í‘œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</h3>
          <p>ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.</p>
        </div>
      `;
    }

    /**
     * ğŸ“­ ë¹ˆ ìƒíƒœ í‘œì‹œ
     */
    function showEmptyScheduleState() {
      const container = document.getElementById('workScheduleContainer');
      container.innerHTML = `
        <div class="empty-state">
          <div class="empty-icon">ğŸ“…</div>
          <h3>ê·¼ë¬´í‘œë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”</h3>
          <p>ì¡°íšŒí•  ì›”ì„ ì„ íƒí•˜ë©´ ê·¼ë¬´í‘œê°€ í‘œì‹œë©ë‹ˆë‹¤.</p>
        </div>
      `;
    }

    /**
     * ğŸš« ê·¼ë¬´í‘œ ì—†ìŒ ìƒíƒœ
     */
    function showScheduleNotFound(deptId, year, month) {
      const container = document.getElementById('workScheduleContainer');
      container.innerHTML = `
        <div class="empty-state">
          <div class="empty-icon">ğŸ“‹</div>
          <h3>ê·¼ë¬´í‘œê°€ ì—†ìŠµë‹ˆë‹¤</h3>
          <p>${year}ë…„ ${month}ì›” ê·¼ë¬´í‘œê°€ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>
          <button class="btn btn-primary" onclick="createWorkScheduleSheet()">
            <span>ğŸ“‹</span> ê·¼ë¬´í‘œ ìƒì„±í•˜ê¸°
          </button>
        </div>
      `;
    }

    /**
     * âŒ ì˜¤ë¥˜ ìƒíƒœ í‘œì‹œ
     */
    function showScheduleError() {
      const container = document.getElementById('workScheduleContainer');
      container.innerHTML = `
        <div class="empty-state">
          <div class="empty-icon">âš ï¸</div>
          <h3>ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤</h3>
          <p>ê·¼ë¬´í‘œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>
          <button class="btn btn-secondary" onclick="loadWorkSchedule()">
            <span>ğŸ”„</span> ë‹¤ì‹œ ì‹œë„
          </button>
        </div>
      `;
    }

    // =====================================
    // ğŸ”§ ê´€ë¦¬ì ê¸°ëŠ¥ í•¨ìˆ˜ë“¤
    // =====================================

    /**
     * ğŸ” ë””ë²„ê¹…: ì‹œíŠ¸ ë°ì´í„° í™•ì¸ (ì„ì‹œ í•¨ìˆ˜)
     */
    async function debugEmployeeData() {
      try {
        const result = await callServerFunction('debugSheetData');
        console.log('ì‹œíŠ¸ ë””ë²„ê¹… ê²°ê³¼:', result);
        alert('ì‹œíŠ¸ ë””ë²„ê¹… ê²°ê³¼ë¥¼ ì½˜ì†”ì—ì„œ í™•ì¸í•˜ì„¸ìš”.');
        return result;
      } catch (error) {
        console.error('ë””ë²„ê¹… ì˜¤ë¥˜:', error);
        alert('ë””ë²„ê¹… ì˜¤ë¥˜: ' + error.message);
      }
    }

    /**
     * ğŸ‘¥ ì§ì› ê´€ë¦¬ í˜ì´ì§€ ë¡œë“œ
     */
    async function loadEmployeeManagement() {
      try {
        console.log('ğŸ” ì§ì› ê´€ë¦¬ í˜ì´ì§€ ë¡œë“œ ì‹œì‘');
        
        console.log('ğŸ“ getEmployeesForWeb ì„œë²„ í•¨ìˆ˜ í˜¸ì¶œ ì¤‘...');
        const employees = await callServerFunction('getEmployeesForWeb');
        console.log('âœ… getEmployeesForWeb ê²°ê³¼:', employees);
        
        console.log('ğŸ“ getAllDepartments ì„œë²„ í•¨ìˆ˜ í˜¸ì¶œ ì¤‘...');
        const departments = await callServerFunction('getAllDepartments');
        console.log('âœ… getAllDepartments ê²°ê³¼:', departments);
        
        // ì „ì—­ ì§ì› ëª©ë¡ ì €ì¥
        allEmployees = employees || [];
        
        // ë¶€ì„œ ì„ íƒ ì˜µì…˜ ì—…ë°ì´íŠ¸
        const deptSelect = document.getElementById('empDept');
        if (deptSelect) {
          deptSelect.innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>';
          departments.forEach(dept => {
            deptSelect.innerHTML += `<option value="${dept.deptId}">${dept.deptName}</option>`;
          });
        }
        
        // ì§ì› ëª©ë¡ í‘œì‹œ
        console.log('ğŸ“‹ ì§ì› ëª©ë¡ í‘œì‹œ ì¤‘...');
        displayEmployeeList(allEmployees);
        console.log('âœ… ì§ì› ê´€ë¦¬ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
        
      } catch (error) {
        console.error('âŒ ì§ì› ê´€ë¦¬ í˜ì´ì§€ ë¡œë“œ ì˜¤ë¥˜:', error);
        showNotification('ì§ì› ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
      }
    }

    /**
     * ğŸ‘¥ ì§ì› ëª©ë¡ í‘œì‹œ (í˜ì´ì§€ë„¤ì´ì…˜ ì ìš©)
     */
    function displayEmployeeList(employees) {
      console.log('ğŸ“‹ displayEmployeeList í•¨ìˆ˜ í˜¸ì¶œë¨');
      console.log('ğŸ“Š ì „ë‹¬ë°›ì€ ì§ì› ë°ì´í„°:', employees);
      console.log('ğŸ“ˆ ì§ì› ìˆ˜:', employees ? employees.length : 'undefined');
      
      const tableBody = document.getElementById('employeeListTable');
      console.log('ğŸ¯ í…Œì´ë¸” ìš”ì†Œ:', tableBody);
      
      if (!employees || employees.length === 0) {
        console.log('âš ï¸ ì§ì› ë°ì´í„°ê°€ ì—†ìŒ - ë¹ˆ ë©”ì‹œì§€ í‘œì‹œ');
        tableBody.innerHTML = '<tr><td colspan="6" class="empty-message">ğŸ“‹ ë“±ë¡ëœ ì§ì›ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
        hidePagination();
        return;
      }
      
      // í˜ì´ì§€ë„¤ì´ì…˜ ì ìš©
      filteredEmployees = employees;
      initializePagination();
      
      // í˜„ì¬ í˜ì´ì§€ì˜ ì§ì›ë“¤ë§Œ í‘œì‹œ
      const startIndex = (currentPage - 1) * itemsPerPage;
      const endIndex = startIndex + itemsPerPage;
      const currentPageEmployees = filteredEmployees.slice(startIndex, endIndex);
      
      console.log('âœ… ì§ì› ëª©ë¡ í…Œì´ë¸” ìƒì„± ì¤‘...');
      const tableHTML = currentPageEmployees.map(emp => `
        <tr>
          <td class="col-empid">${emp.empId}</td>
          <td class="col-name">${emp.name}</td>
          <td class="col-email">${emp.email}</td>
          <td class="col-dept">${emp.deptName || 'ë¯¸ì§€ì •'}</td>
          <td class="col-position">${emp.position || '-'}</td>
          <td class="col-actions">
            <button class="btn btn-secondary" onclick="editEmployee('${emp.empId}')">
              <span class="btn-icon">âœï¸</span>
              <span class="btn-text">ìˆ˜ì •</span>
            </button>
            <button class="btn btn-danger" onclick="deleteEmployee('${emp.empId}')">
              <span class="btn-icon">ğŸ—‘ï¸</span>
              <span class="btn-text">ì‚­ì œ</span>
            </button>
          </td>
        </tr>
      `).join('');
      
      console.log('ğŸ“ ìƒì„±ëœ HTML:', tableHTML);
      tableBody.innerHTML = tableHTML;
      updatePaginationUI();
      console.log('âœ… ì§ì› ëª©ë¡ í‘œì‹œ ì™„ë£Œ');
    }
    
    /**
     * ğŸ“„ í˜ì´ì§€ë„¤ì´ì…˜ ì´ˆê¸°í™”
     */
    function initializePagination() {
      const totalItems = filteredEmployees.length;
      totalPages = Math.ceil(totalItems / itemsPerPage);
      
      // í˜„ì¬ í˜ì´ì§€ê°€ ì´ í˜ì´ì§€ ìˆ˜ë¥¼ ì´ˆê³¼í•˜ë©´ 1í˜ì´ì§€ë¡œ ì´ë™
      if (currentPage > totalPages) {
        currentPage = 1;
      }
      
      // í˜ì´ì§€ë„¤ì´ì…˜ UI í‘œì‹œ/ìˆ¨ê¹€
      const paginationContainer = document.getElementById('employeePagination');
      if (totalPages > 1) {
        paginationContainer.style.display = 'flex';
      } else {
        paginationContainer.style.display = 'none';
      }
      
      console.log('ğŸ“„ í˜ì´ì§€ë„¤ì´ì…˜ ì´ˆê¸°í™”: ì´ ' + totalItems + 'ê°œ í•­ëª©, ' + totalPages + 'í˜ì´ì§€');
    }
    
    /**
     * ğŸ™ˆ í˜ì´ì§€ë„¤ì´ì…˜ ìˆ¨ê¹€
     */
    function hidePagination() {
      const paginationContainer = document.getElementById('employeePagination');
      paginationContainer.style.display = 'none';
    }
    
    /**
     * ğŸ”„ í˜ì´ì§€ë„¤ì´ì…˜ UI ì—…ë°ì´íŠ¸
     */
    function updatePaginationUI() {
      const totalItems = filteredEmployees.length;
      const startItem = (currentPage - 1) * itemsPerPage + 1;
      const endItem = Math.min(currentPage * itemsPerPage, totalItems);
      
      // ì •ë³´ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
      document.getElementById('paginationInfo').textContent = 
        `${startItem}-${endItem} of ${totalItems} ì§ì›`;
      
      // í˜ì´ì§€ ë²ˆí˜¸ ë²„íŠ¼ë“¤ ìƒì„±
      generatePageNumbers();
      
      // ì´ì „/ë‹¤ìŒ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
      document.getElementById('firstPageBtn').disabled = currentPage === 1;
      document.getElementById('prevPageBtn').disabled = currentPage === 1;
      document.getElementById('nextPageBtn').disabled = currentPage === totalPages;
      document.getElementById('lastPageBtn').disabled = currentPage === totalPages;
    }
    
    /**
     * ğŸ”¢ í˜ì´ì§€ ë²ˆí˜¸ ë²„íŠ¼ ìƒì„±
     */
    function generatePageNumbers() {
      const pageNumbersContainer = document.getElementById('pageNumbers');
      pageNumbersContainer.innerHTML = '';
      
      // í˜ì´ì§€ ë²ˆí˜¸ í‘œì‹œ ë¡œì§ (ìµœëŒ€ 7ê°œ ë²„íŠ¼)
      let startPage = Math.max(1, currentPage - 3);
      let endPage = Math.min(totalPages, currentPage + 3);
      
      // ì‹œì‘ í˜ì´ì§€ ì¡°ì •
      if (endPage - startPage < 6) {
        if (startPage === 1) {
          endPage = Math.min(totalPages, startPage + 6);
        } else {
          startPage = Math.max(1, endPage - 6);
        }
      }
      
      // í˜ì´ì§€ ë²ˆí˜¸ ë²„íŠ¼ ìƒì„±
      for (let i = startPage; i <= endPage; i++) {
        const pageBtn = document.createElement('button');
        pageBtn.className = 'pagination-btn' + (i === currentPage ? ' active' : '');
        pageBtn.textContent = i;
        pageBtn.onclick = () => goToPage(i);
        pageNumbersContainer.appendChild(pageBtn);
      }
    }
    
    /**
     * ğŸ“„ íŠ¹ì • í˜ì´ì§€ë¡œ ì´ë™
     */
    function goToPage(pageNumber) {
      if (pageNumber < 1 || pageNumber > totalPages) {
        return;
      }
      
      currentPage = pageNumber;
      displayEmployeeList(filteredEmployees);
      
      console.log('ğŸ“„ í˜ì´ì§€ ì´ë™: ' + pageNumber + 'í˜ì´ì§€');
    }
    
    /**
     * ğŸ“Š í˜ì´ì§€ë‹¹ í•­ëª© ìˆ˜ ë³€ê²½
     */
    function changeItemsPerPage() {
      const select = document.getElementById('itemsPerPage');
      itemsPerPage = parseInt(select.value);
      currentPage = 1; // ì²« í˜ì´ì§€ë¡œ ì´ë™
      
      displayEmployeeList(filteredEmployees);
      
      console.log('ğŸ“Š í˜ì´ì§€ë‹¹ í•­ëª© ìˆ˜ ë³€ê²½: ' + itemsPerPage + 'ê°œ');
    }

    /**
     * ğŸ” ì§ì› ê²€ìƒ‰ ê¸°ëŠ¥ (í˜ì´ì§€ë„¤ì´ì…˜ ì—°ë™)
     */
    function searchEmployees() {
      const searchTerm = document.getElementById('employeeSearchInput').value.toLowerCase().trim();
      
      if (!searchTerm) {
        // ê²€ìƒ‰ì–´ê°€ ì—†ìœ¼ë©´ ì „ì²´ ëª©ë¡ í‘œì‹œ
        currentPage = 1; // ì²« í˜ì´ì§€ë¡œ ì´ë™
        displayEmployeeList(allEmployees);
        return;
      }
      
      // ê²€ìƒ‰ì–´ì— ë§ëŠ” ì§ì› í•„í„°ë§
      const searchFilteredEmployees = allEmployees.filter(emp => {
        const empId = emp.empId.toLowerCase();
        const name = emp.name.toLowerCase();
        const email = emp.email.toLowerCase();
        const deptName = (emp.deptName || '').toLowerCase();
        const position = (emp.position || '').toLowerCase();
        
        return empId.includes(searchTerm) || 
               name.includes(searchTerm) || 
               email.includes(searchTerm) || 
               deptName.includes(searchTerm) || 
               position.includes(searchTerm);
      });
      
      // ê²€ìƒ‰ ê²°ê³¼ í‘œì‹œ
      currentPage = 1; // ê²€ìƒ‰ ì‹œ ì²« í˜ì´ì§€ë¡œ ì´ë™
      displayEmployeeList(searchFilteredEmployees);
      
      // ê²€ìƒ‰ ê²°ê³¼ ë©”ì‹œì§€ í‘œì‹œ
      if (searchFilteredEmployees.length === 0) {
        const tableBody = document.getElementById('employeeListTable');
        tableBody.innerHTML = '<tr><td colspan="6" class="search-empty-message">ğŸ” ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. ë‹¤ë¥¸ í‚¤ì›Œë“œë¡œ ê²€ìƒ‰í•´ë³´ì„¸ìš”.</td></tr>';
        hidePagination();
      }
      
      console.log('ğŸ” ê²€ìƒ‰ ì™„ë£Œ: "' + searchTerm + '" -> ' + searchFilteredEmployees.length + 'ê°œ ê²°ê³¼');
    }

    /**
     * ğŸ”„ ì§ì› ê²€ìƒ‰ ì´ˆê¸°í™”
     */
    function clearEmployeeSearch() {
      document.getElementById('employeeSearchInput').value = '';
      currentPage = 1; // ì²« í˜ì´ì§€ë¡œ ì´ë™
      displayEmployeeList(allEmployees); // ì „ì²´ ëª©ë¡ í‘œì‹œ
      console.log('ğŸ”„ ê²€ìƒ‰ ì´ˆê¸°í™” ì™„ë£Œ');
    }

    /**
     * ğŸ‘¥ ì§ì› ì¶”ê°€
     */
    async function addEmployee(event) {
      event.preventDefault();
      
      const formData = {
        name: document.getElementById('empName').value,
        email: document.getElementById('empEmail').value,
        phone: document.getElementById('empPhone').value,
        deptId: document.getElementById('empDept').value,
        position: document.getElementById('empPosition').value
      };
      
      try {
        showLoading(true);
        const result = await callServerFunction('addEmployee', formData);
        
        if (result.success) {
          // ìƒì„¸í•œ ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
          const successMessage = `
            âœ… ì§ì›ì´ ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!
            
            ğŸ“‹ ìƒì„±ëœ ì‚¬ë²ˆ: ${result.empId}
            ğŸ“§ ì´ë©”ì¼: ${result.loginInfo.email}
            ğŸ”‘ ì´ˆê¸° ë¹„ë°€ë²ˆí˜¸: ${result.loginInfo.password}
            
            âš ï¸ í•´ë‹¹ ì§ì›ì—ê²Œ ë¡œê·¸ì¸ ì •ë³´ë¥¼ ì•ˆì „í•˜ê²Œ ì „ë‹¬í•´ì£¼ì„¸ìš”.
            ì²« ë¡œê·¸ì¸ ì‹œ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ì´ í•„ìš”í•©ë‹ˆë‹¤.
          `;
          
          alert(successMessage);
          showNotification('ì§ì› ì¶”ê°€ ì™„ë£Œ (ì‚¬ë²ˆ: ' + result.empId + ')', 'success');
          document.getElementById('addEmployeeForm').reset();
          
          // ì§ì› ëª©ë¡ ìƒˆë¡œê³ ì¹¨ (ìµœì‹  ì§ì›ì´ ë§¨ ìœ„ì— í‘œì‹œë¨)
          await refreshEmployeeList();
          
          // ê²€ìƒ‰ì°½ ì´ˆê¸°í™”
          clearEmployeeSearch();
          
        } else {
          showNotification('ì§ì› ì¶”ê°€ ì‹¤íŒ¨: ' + result.error, 'error');
        }
      } catch (error) {
        console.error('ì§ì› ì¶”ê°€ ì˜¤ë¥˜:', error);
        showNotification('ì§ì› ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
      } finally {
        showLoading(false);
      }
    }

    /**
     * ğŸ”„ ì§ì› ëª©ë¡ ìƒˆë¡œê³ ì¹¨ (í˜ì´ì§€ë„¤ì´ì…˜ ì—°ë™)
     */
    async function refreshEmployeeList() {
      try {
        console.log('ğŸ”„ ì§ì› ëª©ë¡ ìƒˆë¡œê³ ì¹¨ ì¤‘...');
        const employees = await callServerFunction('getEmployeesForWeb');
        
        // ì „ì—­ ë³€ìˆ˜ ì—…ë°ì´íŠ¸
        allEmployees = employees || [];
        
        // í˜„ì¬ ê²€ìƒ‰ ìƒíƒœ í™•ì¸
        const searchTerm = document.getElementById('employeeSearchInput').value.toLowerCase().trim();
        
        if (searchTerm) {
          // ê²€ìƒ‰ ì¤‘ì´ë©´ ë‹¤ì‹œ ê²€ìƒ‰ ì‹¤í–‰
          searchEmployees();
        } else {
          // ê²€ìƒ‰ ì¤‘ì´ ì•„ë‹ˆë©´ ì „ì²´ ëª©ë¡ í‘œì‹œ (í˜„ì¬ í˜ì´ì§€ ìœ ì§€)
          displayEmployeeList(allEmployees);
        }
        
        console.log('âœ… ì§ì› ëª©ë¡ ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ (ì´ ' + allEmployees.length + 'ëª…)');
      } catch (error) {
        console.error('âŒ ì§ì› ëª©ë¡ ìƒˆë¡œê³ ì¹¨ ì˜¤ë¥˜:', error);
        showNotification('ì§ì› ëª©ë¡ ìƒˆë¡œê³ ì¹¨ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
      }
    }

    /**
     * ğŸ¢ ë¶€ì„œ ê´€ë¦¬ í˜ì´ì§€ ë¡œë“œ
     */
    async function loadDepartmentManagement() {
      try {
        // ì§ì› ìˆ˜ê°€ í•„ìš”í•œ ê²½ìš°ì—ë§Œ getAllDepartments ì‚¬ìš©, 
        // ì¼ë°˜ì ì¸ ëª©ë¡ ì¡°íšŒëŠ” ë¹ ë¥¸ í•¨ìˆ˜ ì‚¬ìš© í›„ í•„ìš”ì‹œ ì§ì› ìˆ˜ë§Œ ë³„ë„ ì¡°íšŒ
        const departments = await callServerFunction('getAllDepartments');
        displayDepartmentList(departments);
      } catch (error) {
        console.error('ë¶€ì„œ ê´€ë¦¬ í˜ì´ì§€ ë¡œë“œ ì˜¤ë¥˜:', error);
        showNotification('ë¶€ì„œ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
      }
    }
    
    // ===========================================
    // ğŸ¯ ë¶€ì„œ ê´€ë¦¬ ë“œë˜ê·¸ ì•¤ ë“œë¡­ ë³´ë“œ ê´€ë ¨ í•¨ìˆ˜ë“¤
    // ===========================================
    
    /**
     * ğŸ”„ ë¶€ì„œ ë·° ì „í™˜ (ëª©ë¡ ë·° â†” ë³´ë“œ ë·°)
     */
    function switchDepartmentView(viewType) {
      console.log('ğŸ”„ ë¶€ì„œ ë·° ì „í™˜:', viewType);
      
      // íƒ­ í™œì„±í™” ìƒíƒœ ë³€ê²½
      document.querySelectorAll('#departmentManagementPage .view-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // ì„ íƒëœ íƒ­ í™œì„±í™”
      const activeTab = viewType === 'list' ? 'deptListViewTab' : 'deptBoardViewTab';
      document.getElementById(activeTab).classList.add('active');
      
      // ë·° ì „í™˜
      document.querySelectorAll('.department-view').forEach(view => {
        view.classList.remove('active');
      });
      
      const targetView = viewType === 'list' ? 'departmentListView' : 'departmentBoardView';
      document.getElementById(targetView).classList.add('active');
      
      // ë³´ë“œ ë·°ë¡œ ì „í™˜ ì‹œ ë°ì´í„° ë¡œë“œ
      if (viewType === 'board') {
        loadDepartmentBoard();
      }
    }
    
    /**
     * ğŸ¯ ë¶€ì„œ ë³´ë“œ ë°ì´í„° ë¡œë“œ
     */
    async function loadDepartmentBoard() {
      try {
        console.log('ğŸ¯ ë¶€ì„œ ë³´ë“œ ë¡œë“œ ì‹œì‘...');
        
        // ë¡œë”© í‘œì‹œ
        const kanbanBoard = document.getElementById('deptKanbanBoard');
        kanbanBoard.innerHTML = `
          <div class="board-loading">
            <div class="spinner"></div>
            <p>ë¶€ì„œë³„ ì§ì› ë³´ë“œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>
          </div>
        `;
        
        // ì§ì› ë° ë¶€ì„œ ë°ì´í„° ë¡œë“œ (ë¶€ì„œëŠ” ë¹ ë¥¸ ì¡°íšŒ ì‚¬ìš©)
        const [employees, departments] = await Promise.all([
          callServerFunction('getEmployeesForWeb'),
          callServerFunction('getDepartmentsQuick')
        ]);
        
        console.log('ğŸ“Š ë¡œë“œëœ ì§ì› ìˆ˜:', employees ? employees.length : 0);
        console.log('ğŸ¢ ë¡œë“œëœ ë¶€ì„œ ìˆ˜:', departments ? departments.length : 0);
        
        // ë¶€ì„œë³„ ì§ì› ê·¸ë£¹í•‘
        const employeesByDept = groupEmployeesByDepartmentForBoard(employees, departments);
        
        // ë³´ë“œ í†µê³„ ì—…ë°ì´íŠ¸
        updateDepartmentBoardStats(employees, departments);
        
        // ì¹¸ë°˜ ë³´ë“œ ìƒì„±
        createDepartmentKanbanBoard(employeesByDept);
        
        console.log('âœ… ë¶€ì„œ ë³´ë“œ ë¡œë“œ ì™„ë£Œ');
        
      } catch (error) {
        console.error('âŒ ë¶€ì„œ ë³´ë“œ ë¡œë“œ ì˜¤ë¥˜:', error);
        document.getElementById('deptKanbanBoard').innerHTML = `
          <div class="board-loading">
            <p style="color: #dc3545;">âš ï¸ ë³´ë“œë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.</p>
          </div>
        `;
            }
    }
    
    /**
     * ğŸ“Š ë¶€ì„œë³„ ì§ì› ê·¸ë£¹í•‘ (ë¶€ì„œ ë³´ë“œìš©)
     */
    function groupEmployeesByDepartmentForBoard(employees, departments) {
      const employeesByDept = {};
      
      // ëª¨ë“  ë¶€ì„œ ì´ˆê¸°í™”
      departments.forEach(dept => {
        employeesByDept[dept.deptId] = {
          department: dept,
          employees: []
        };
      });
      
      // ì§ì›ë“¤ì„ ë¶€ì„œë³„ë¡œ ë¶„ë¥˜
      employees.forEach(emp => {
        const deptId = emp.deptId || 'unknown';
        if (employeesByDept[deptId]) {
          employeesByDept[deptId].employees.push(emp);
        } else {
          // ë¯¸ì§€ì • ë¶€ì„œ ì²˜ë¦¬
          if (!employeesByDept['unknown']) {
            employeesByDept['unknown'] = {
              department: { deptId: 'unknown', deptName: 'ë¯¸ì§€ì •' },
              employees: []
            };
          }
          employeesByDept['unknown'].employees.push(emp);
        }
      });
      
      return employeesByDept;
    }
    
    /**
     * ğŸ“ˆ ë¶€ì„œ ë³´ë“œ í†µê³„ ì—…ë°ì´íŠ¸
     */
    function updateDepartmentBoardStats(employees, departments) {
      const totalEmployees = employees ? employees.length : 0;
      const totalDepartments = departments ? departments.length : 0;
      
      document.getElementById('deptBoardTotalEmployees').innerHTML = 
        `ì´ <strong>${totalEmployees}</strong>ëª…`;
      document.getElementById('deptBoardTotalDepartments').innerHTML = 
        `<strong>${totalDepartments}</strong>ê°œ ë¶€ì„œ`;
    }
    
    /**
     * ğŸ¯ ë¶€ì„œ ì¹¸ë°˜ ë³´ë“œ ìƒì„±
     */
    function createDepartmentKanbanBoard(employeesByDept) {
      const kanbanBoard = document.getElementById('deptKanbanBoard');
      
      // ê¸°ì¡´ ë‚´ìš© ì œê±°
      kanbanBoard.innerHTML = '';
      
      // ë¶€ì„œ ìˆ˜ì— ë”°ë¥¸ ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ í´ë˜ìŠ¤ ì ìš©
      const departmentCount = Object.keys(employeesByDept).length;
      
      // ê¸°ì¡´ í´ë˜ìŠ¤ ì œê±°
      kanbanBoard.className = 'kanban-board';
      
      // ë¶€ì„œ ìˆ˜ì— ë”°ë¥¸ í´ë˜ìŠ¤ ì¶”ê°€
      if (departmentCount === 1) {
        kanbanBoard.classList.add('departments-1');
      } else if (departmentCount === 2) {
        kanbanBoard.classList.add('departments-2');
      } else if (departmentCount === 3) {
        kanbanBoard.classList.add('departments-3');
      } else if (departmentCount === 4) {
        kanbanBoard.classList.add('departments-4');
      } else if (departmentCount === 5) {
        kanbanBoard.classList.add('departments-5');
      } else if (departmentCount === 6) {
        kanbanBoard.classList.add('departments-6');
      } else if (departmentCount === 7) {
        kanbanBoard.classList.add('departments-7');
      } else if (departmentCount === 8) {
        kanbanBoard.classList.add('departments-8');
      } else {
        kanbanBoard.classList.add('departments-many');
      }
      
      // ë¶€ì„œë³„ ì¹¼ëŸ¼ ìƒì„±
      Object.values(employeesByDept).forEach(deptData => {
        const column = createDepartmentBoardColumn(deptData.department, deptData.employees);
        kanbanBoard.appendChild(column);
      });
      
      // ì¹¼ëŸ¼ì´ ì—†ìœ¼ë©´ ì•ˆë‚´ ë©”ì‹œì§€ í‘œì‹œ
      if (departmentCount === 0) {
        kanbanBoard.innerHTML = `
          <div class="board-loading">
            <p>í‘œì‹œí•  ë¶€ì„œê°€ ì—†ìŠµë‹ˆë‹¤. ë¶€ì„œë¥¼ ë¨¼ì € ìƒì„±í•´ì£¼ì„¸ìš”.</p>
          </div>
        `;
      }
    }
    
    /**
     * ğŸ¢ ë¶€ì„œ ë³´ë“œ ì¹¼ëŸ¼ ìƒì„±
     */
    function createDepartmentBoardColumn(department, employees) {
      const column = document.createElement('div');
      column.className = 'department-column';
      column.setAttribute('data-dept-id', department.deptId);
      
      // ì¹¼ëŸ¼ í—¤ë”
      const header = document.createElement('div');
      header.className = 'column-header';
      header.innerHTML = `
        <h3 class="column-title">
          ğŸ¢ ${department.deptName}
          <span class="column-count">${employees.length}</span>
        </h3>
      `;
      
      // ì¹¼ëŸ¼ ë°”ë””
      const body = document.createElement('div');
      body.className = 'column-body';
      
      if (employees.length === 0) {
        // ì§ì›ì´ ì—†ëŠ” ê²½ìš°
        body.innerHTML = `
          <div class="column-empty">
            ğŸ‘¥ ì†Œì† ì§ì›ì´ ì—†ìŠµë‹ˆë‹¤<br>
            <small>ë‹¤ë¥¸ ë¶€ì„œì—ì„œ ì§ì›ì„ ë“œë˜ê·¸í•´ë³´ì„¸ìš”</small>
          </div>
        `;
      } else {
        // ì§ì› ì¹´ë“œë“¤ ìƒì„±
        employees.forEach(employee => {
          const card = createDepartmentEmployeeCard(employee);
          body.appendChild(card);
        });
      }
      
      column.appendChild(header);
      column.appendChild(body);
      
      // ğŸ¯ ë“œë¡­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
      setupDepartmentColumnDropEvents(column, department);
      
      return column;
    }
    
    /**
     * ğŸ‘¤ ë¶€ì„œ ë³´ë“œìš© ì§ì› ì¹´ë“œ ìƒì„±
     */
    function createDepartmentEmployeeCard(employee) {
      const card = document.createElement('div');
      card.className = 'employee-card';
      card.draggable = true;
      card.setAttribute('data-emp-id', employee.empId);
      
      card.innerHTML = `
        <div class="card-header">
          <div class="card-name">${employee.name}</div>
          <div class="card-empid">${employee.empId}</div>
        </div>
        <div class="card-info">
          <div class="card-email">${employee.email}</div>
          <div class="card-position">${employee.position || 'ì§ê¸‰ ë¯¸ì§€ì •'}</div>
        </div>
        <div class="card-actions">
          <button class="card-btn card-btn-edit" onclick="editEmployee('${employee.empId}')">
            âœï¸ ìˆ˜ì •
          </button>
          <button class="card-btn card-btn-delete" onclick="deleteEmployee('${employee.empId}')">
            ğŸ—‘ï¸ ì‚­ì œ
          </button>
        </div>
      `;
      
      // ğŸ¯ ë“œë˜ê·¸ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
      setupDepartmentCardDragEvents(card, employee);
      
      return card;
    }
    
    /**
     * ğŸ”„ ë¶€ì„œ ë³´ë“œ ìƒˆë¡œê³ ì¹¨
     */
    async function refreshDepartmentBoard() {
      try {
        console.log('ğŸ”„ ë¶€ì„œ ë³´ë“œ ìƒˆë¡œê³ ì¹¨ ì¤‘...');
        await loadDepartmentBoard();
        console.log('âœ… ë¶€ì„œ ë³´ë“œ ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ');
      } catch (error) {
        console.error('âŒ ë¶€ì„œ ë³´ë“œ ìƒˆë¡œê³ ì¹¨ ì˜¤ë¥˜:', error);
        showNotification('ë³´ë“œ ìƒˆë¡œê³ ì¹¨ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
      }
    }
 
    /**
     * ğŸ¢ ë¶€ì„œ ëª©ë¡ í‘œì‹œ (ê°œì„ ëœ ë²„ì „)
     */
    function displayDepartmentList(departments) {
      const tableBody = document.getElementById('departmentListTable');
      
      if (!departments || departments.length === 0) {
        tableBody.innerHTML = '<tr><td colspan="4" class="empty-message">ğŸ¢ ë“±ë¡ëœ ë¶€ì„œê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
        return;
      }
      
      tableBody.innerHTML = departments.map(dept => `
        <tr>
          <td>${dept.deptId}</td>
          <td>${dept.deptName}</td>
          <td>
            <span style="color: ${dept.employeeCount > 0 ? '#28a745' : '#6c757d'}; font-weight: 600;">
              ${dept.employeeCount || 0}ëª…
            </span>
          </td>
          <td>
            <button class="btn btn-secondary" onclick="editDepartment('${dept.deptId}')" style="margin-right: 0.5rem;">
              <span>âœï¸</span> ìˆ˜ì •
            </button>
            <button class="btn btn-danger" onclick="deleteDepartment('${dept.deptId}', '${dept.deptName}', ${dept.employeeCount || 0})">
              <span>ğŸ—‘ï¸</span> ì‚­ì œ
            </button>
          </td>
        </tr>
      `).join('');
    }

    /**
     * ğŸ¢ ë¶€ì„œ ì¶”ê°€
     */
    async function addDepartment(event) {
      event.preventDefault();
      
      const formData = {
        deptId: document.getElementById('deptId').value,
        deptName: document.getElementById('deptName').value
      };
      
      try {
        showLoading(true);
        const result = await callServerFunction('addDepartment', formData);
        
        if (result.success) {
          showNotification('ë¶€ì„œê°€ ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
          document.getElementById('addDepartmentForm').reset();
          loadDepartmentManagement(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
        } else {
          showNotification('ë¶€ì„œ ì¶”ê°€ ì‹¤íŒ¨: ' + result.error, 'error');
        }
      } catch (error) {
        console.error('ë¶€ì„œ ì¶”ê°€ ì˜¤ë¥˜:', error);
        showNotification('ë¶€ì„œ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
      } finally {
        showLoading(false);
      }
    }

    /**
     * âš™ï¸ ì‹œìŠ¤í…œ ì„¤ì • í˜ì´ì§€ ë¡œë“œ
     */
    async function loadSystemSettings() {
      try {
        const settings = await callServerFunction('getSystemSettings');
        
        // ì„¤ì •ê°’ë“¤ì„ í¼ì— ì ìš©
        if (settings) {
          document.getElementById('basicLeaves').value = settings.basicLeaves || 15;
          document.getElementById('maxLeaves').value = settings.maxLeaves || 25;
          document.getElementById('sessionTimeout').value = settings.sessionTimeout || 120;
          document.getElementById('leavePolicy').value = settings.leavePolicy || 'ì…ì‚¬ì¼ ê¸°ì¤€';
        }
      } catch (error) {
        console.error('ì‹œìŠ¤í…œ ì„¤ì • ë¡œë“œ ì˜¤ë¥˜:', error);
        showNotification('ì‹œìŠ¤í…œ ì„¤ì •ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
      }
    }

    /**
     * âš™ï¸ ì‹œìŠ¤í…œ ì„¤ì • ì—…ë°ì´íŠ¸
     */
    async function updateSystemSettings(event) {
      event.preventDefault();
      
      const settings = {
        basicLeaves: document.getElementById('basicLeaves').value,
        maxLeaves: document.getElementById('maxLeaves').value,
        sessionTimeout: document.getElementById('sessionTimeout').value,
        leavePolicy: document.getElementById('leavePolicy').value
      };
      
      try {
        showLoading(true);
        const result = await callServerFunction('updateSystemSettings', settings);
        
        if (result.success) {
          showNotification('ì‹œìŠ¤í…œ ì„¤ì •ì´ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        } else {
          showNotification('ì„¤ì • ì €ì¥ ì‹¤íŒ¨: ' + result.error, 'error');
        }
      } catch (error) {
        console.error('ì‹œìŠ¤í…œ ì„¤ì • ì €ì¥ ì˜¤ë¥˜:', error);
        showNotification('ì„¤ì • ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
      } finally {
        showLoading(false);
      }
    }

    /**
     * ğŸ“ˆ ê°œì„ ëœ í†µê³„ í˜ì´ì§€ ë¡œë“œ
     */
    async function loadStatistics() {
      try {
        console.log('ğŸ“Š í†µê³„ ë°ì´í„° ë¡œë“œ ì‹œì‘...');
        
        // ë³‘ë ¬ë¡œ ë°ì´í„° ë¡œë“œ
        const [stats, departmentStats] = await Promise.all([
          callServerFunction('getAdvancedStatistics'),
          callServerFunction('getDepartmentStatistics')
        ]);
        
        console.log('ğŸ“Š ë°›ì€ í†µê³„ ë°ì´í„°:', stats);
        console.log('ğŸ¢ ë°›ì€ ë¶€ì„œë³„ í†µê³„:', departmentStats);
        
        // ì‹¤ì‹œê°„ ìš´ì˜ ì§€í‘œ ì—…ë°ì´íŠ¸
        if (stats) {
          updateElement('statsPendingRequests', stats.pendingRequests + 'ê±´');
          updateElement('statsThisMonthRequests', stats.thisMonthRequests + 'ê±´');
          updateElement('statsAvgProcessTime', stats.avgProcessTime + 'ì¼');
          updateElement('statsApprovalRate', stats.approvalRate + '%');
          
          // í•µì‹¬ ì„±ê³¼ ì§€í‘œ ì—…ë°ì´íŠ¸
          updateElement('statsEmployeeCount', stats.totalEmployees + 'ëª…');
          updateElement('statsAvgLeaveUsage', stats.avgLeaveUsage + 'ì¼');
          updateElement('statsDepartmentCount', stats.totalDepartments + 'ê°œ');
          updateElement('statsSystemHealth', getSystemHealthText(stats.systemHealth));
        }
        
        // ë¶€ì„œë³„ í˜„í™© í…Œì´ë¸” ì—…ë°ì´íŠ¸
        if (departmentStats) {
          updateDepartmentStatsTable(departmentStats);
        }
        
        console.log('âœ… í†µê³„ ë°ì´í„° ë¡œë“œ ì™„ë£Œ');
        
      } catch (error) {
        console.error('âŒ í†µê³„ ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
        showNotification('í†µê³„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ìƒˆë¡œê³ ì¹¨ì„ ì‹œë„í•´ë³´ì„¸ìš”.', 'error');
        
        // ê¸°ë³¸ê°’ ì„¤ì •
        setDefaultStatValues();
      }
    }
    
    /**
     * ğŸ“Š ìš”ì†Œ ì—…ë°ì´íŠ¸ í—¬í¼ í•¨ìˆ˜
     */
    function updateElement(id, value) {
      const element = document.getElementById(id);
      if (element) {
        element.textContent = value || '-';
      }
    }
    
    /**
     * ğŸ¯ ì‹œìŠ¤í…œ ê±´ì „ì„± í…ìŠ¤íŠ¸ ë³€í™˜
     */
    function getSystemHealthText(healthScore) {
      if (healthScore >= 90) return 'ìš°ìˆ˜';
      if (healthScore >= 80) return 'ì–‘í˜¸';
      if (healthScore >= 70) return 'ë³´í†µ';
      if (healthScore >= 60) return 'ì£¼ì˜';
      return 'ìœ„í—˜';
    }
    
    /**
     * ğŸ“‹ ë¶€ì„œë³„ í†µê³„ í…Œì´ë¸” ì—…ë°ì´íŠ¸
     */
    function updateDepartmentStatsTable(departmentStats) {
      const tableBody = document.getElementById('departmentStatsTable');
      
      if (!departmentStats || departmentStats.length === 0) {
        tableBody.innerHTML = '<tr><td colspan="5" class="empty-message">ğŸ¢ ë¶€ì„œë³„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
        return;
      }
      
      tableBody.innerHTML = departmentStats.map(dept => {
        const statusClass = getUsageStatusClass(dept.usageRate);
        const statusText = getUsageStatusText(dept.usageRate);
        
        return `
          <tr>
            <td style="font-weight: 500;">${dept.deptName}</td>
            <td style="text-align: center;">${dept.employeeCount}ëª…</td>
            <td style="text-align: center;">${dept.usageRate}%</td>
            <td style="text-align: center;">${dept.avgRemainingLeaves}ì¼</td>
            <td style="text-align: center;">
              <span class="${statusClass}">${statusText}</span>
            </td>
          </tr>
        `;
      }).join('');
    }
    
    /**
     * ğŸ“Š ì‚¬ìš©ë¥ ì— ë”°ë¥¸ ìƒíƒœ í´ë˜ìŠ¤
     */
    function getUsageStatusClass(usageRate) {
      if (usageRate >= 80) return 'status-excellent';
      if (usageRate >= 60) return 'status-good';
      if (usageRate >= 40) return 'status-warning';
      return 'status-danger';
    }
    
    /**
     * ğŸ“Š ì‚¬ìš©ë¥ ì— ë”°ë¥¸ ìƒíƒœ í…ìŠ¤íŠ¸
     */
    function getUsageStatusText(usageRate) {
      if (usageRate >= 80) return 'í™œë°œ';
      if (usageRate >= 60) return 'ì ì ˆ';
      if (usageRate >= 40) return 'ì €ì¡°';
      return 'ë¯¸í¡';
    }
    
    /**
     * âš ï¸ ê¸°ë³¸ê°’ ì„¤ì •
     */
    function setDefaultStatValues() {
      // ì‹¤ì‹œê°„ ìš´ì˜ ì§€í‘œ
      updateElement('statsPendingRequests', '0ê±´');
      updateElement('statsThisMonthRequests', '0ê±´');
      updateElement('statsAvgProcessTime', '0ì¼');
      updateElement('statsApprovalRate', '0%');
      
      // í•µì‹¬ ì„±ê³¼ ì§€í‘œ
      updateElement('statsEmployeeCount', '0ëª…');
      updateElement('statsAvgLeaveUsage', '0ì¼');
      updateElement('statsDepartmentCount', '0ê°œ');
      updateElement('statsSystemHealth', 'ë°ì´í„° ì—†ìŒ');
    }

    /**
     * ğŸ“¥ ë°ì´í„° ë‚´ë³´ë‚´ê¸°
     */
    async function exportData() {
      try {
        showLoading(true);
        const result = await callServerFunction('exportSystemData');
        
        if (result.success) {
          showNotification('ë°ì´í„° ë‚´ë³´ë‚´ê¸°ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
          // ë‹¤ìš´ë¡œë“œ ë§í¬ ì œê³µ ë“±ì˜ ì¶”ê°€ ì²˜ë¦¬
        } else {
          showNotification('ë°ì´í„° ë‚´ë³´ë‚´ê¸° ì‹¤íŒ¨: ' + result.error, 'error');
        }
      } catch (error) {
        console.error('ë°ì´í„° ë‚´ë³´ë‚´ê¸° ì˜¤ë¥˜:', error);
        showNotification('ë°ì´í„° ë‚´ë³´ë‚´ê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
      } finally {
        showLoading(false);
      }
    }

    /**
     * ğŸ’¾ ë°±ì—… ìƒì„±
     */
    async function backupData() {
      try {
        showLoading(true);
        const result = await callServerFunction('createSystemBackup');
        
        if (result.success) {
          showNotification('ì‹œìŠ¤í…œ ë°±ì—…ì´ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        } else {
          showNotification('ë°±ì—… ìƒì„± ì‹¤íŒ¨: ' + result.error, 'error');
        }
      } catch (error) {
        console.error('ë°±ì—… ìƒì„± ì˜¤ë¥˜:', error);
        showNotification('ë°±ì—… ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
      } finally {
        showLoading(false);
      }
    }

    /**
     * âœï¸ ì§ì› ìˆ˜ì • ëª¨ë‹¬ ì—´ê¸°
     */
    async function editEmployee(empId) {
      try {
        console.log('ğŸ“ ì§ì› ìˆ˜ì • ëª¨ë‹¬ ì—´ê¸°:', empId);
        
        // í•´ë‹¹ ì§ì› ì •ë³´ ì°¾ê¸°
        const employee = allEmployees.find(emp => emp.empId === empId);
        if (!employee) {
          showNotification('ì§ì› ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
          return;
        }
        
        // ëª¨ë‹¬ í•„ë“œì— ê¸°ì¡´ ë°ì´í„° ì±„ìš°ê¸°
        document.getElementById('editEmpId').value = employee.empId;
        document.getElementById('editEmpName').value = employee.name;
        document.getElementById('editEmpEmail').value = employee.email;
        document.getElementById('editEmpPhone').value = employee.phone || '';
        document.getElementById('editEmpDept').value = employee.deptId || '';
        document.getElementById('editEmpPosition').value = employee.position || '';
        document.getElementById('resetPasswordCheckbox').checked = false;
        
        // ë¶€ì„œ ì„ íƒ ì˜µì…˜ ì—…ë°ì´íŠ¸
        await loadDepartmentOptionsForEdit();
        
        // ëª¨ë‹¬ ì—´ê¸°
        const modal = document.getElementById('editEmployeeModal');
        modal.style.display = 'flex';
        
        // ë©”ì‹œì§€ ì´ˆê¸°í™”
        const messageDiv = document.getElementById('editEmployeeMessage');
        messageDiv.style.display = 'none';
        
        console.log('âœ… ì§ì› ìˆ˜ì • ëª¨ë‹¬ ì—´ê¸° ì™„ë£Œ');
      } catch (error) {
        console.error('âŒ ì§ì› ìˆ˜ì • ëª¨ë‹¬ ì—´ê¸° ì˜¤ë¥˜:', error);
        showNotification('ì§ì› ìˆ˜ì • ëª¨ë‹¬ì„ ì—´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
      }
    }

    /**
     * ğŸ¢ ìˆ˜ì • ëª¨ë‹¬ìš© ë¶€ì„œ ì˜µì…˜ ë¡œë“œ
     */
    async function loadDepartmentOptionsForEdit() {
      try {
        const departments = await callServerFunction('getAllDepartments');
        const selectElement = document.getElementById('editEmpDept');
        
        selectElement.innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>';
        departments.forEach(dept => {
          selectElement.innerHTML += `<option value="${dept.deptId}">${dept.deptName}</option>`;
        });
      } catch (error) {
        console.error('ë¶€ì„œ ì˜µì…˜ ë¡œë“œ ì˜¤ë¥˜:', error);
      }
    }

    /**
     * ğŸ’¾ ì§ì› ì •ë³´ ë³€ê²½ì‚¬í•­ ì €ì¥
     */
    async function saveEmployeeChanges() {
      try {
        const empId = document.getElementById('editEmpId').value;
        const name = document.getElementById('editEmpName').value.trim();
        const email = document.getElementById('editEmpEmail').value.trim();
        const phone = document.getElementById('editEmpPhone').value.trim();
        const deptId = document.getElementById('editEmpDept').value;
        const position = document.getElementById('editEmpPosition').value.trim();
        const resetPassword = document.getElementById('resetPasswordCheckbox').checked;
        
        // í•„ìˆ˜ í•„ë“œ ê²€ì¦
        if (!name || !email || !deptId) {
          showEditEmployeeMessage('ì´ë¦„, ì´ë©”ì¼, ë¶€ì„œëŠ” í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤.', 'error');
          return;
        }
        
        // ì´ë©”ì¼ í˜•ì‹ ê²€ì¦
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email)) {
          showEditEmployeeMessage('ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
          return;
        }
        
        // ì €ì¥ ë²„íŠ¼ ë¹„í™œì„±í™”
        const saveBtn = document.querySelector('.btn-modal-primary');
        saveBtn.disabled = true;
        saveBtn.innerHTML = '<span>ğŸ’¾</span> ì €ì¥ ì¤‘...';
        
        // ì„œë²„ì— ë³€ê²½ì‚¬í•­ ì „ì†¡
        const updateData = {
          empId: empId,
          name: name,
          email: email,
          phone: phone,
          deptId: deptId,
          position: position,
          resetPassword: resetPassword
        };
        
        const result = await callServerFunction('updateEmployee', updateData);
        
        if (result.success) {
          showEditEmployeeMessage('ì§ì› ì •ë³´ê°€ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
          
          // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ í›„ ëª¨ë‹¬ ë‹«ê¸°
          setTimeout(() => {
            closeEditEmployeeModal();
            showNotification('ì§ì› ì •ë³´ ìˆ˜ì • ì™„ë£Œ', 'success');
            
            // ì§ì› ëª©ë¡ ìƒˆë¡œê³ ì¹¨
            refreshEmployeeList();
          }, 1500);
          
        } else {
          showEditEmployeeMessage('ì§ì› ì •ë³´ ìˆ˜ì • ì‹¤íŒ¨: ' + result.error, 'error');
        }
        
      } catch (error) {
        console.error('âŒ ì§ì› ì •ë³´ ì €ì¥ ì˜¤ë¥˜:', error);
        showEditEmployeeMessage('ì§ì› ì •ë³´ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
      } finally {
        // ì €ì¥ ë²„íŠ¼ í™œì„±í™”
        const saveBtn = document.querySelector('.btn-modal-primary');
        saveBtn.disabled = false;
        saveBtn.innerHTML = '<span>ğŸ’¾</span> ì €ì¥';
      }
    }

    /**
     * ğŸš« ì§ì› ìˆ˜ì • ëª¨ë‹¬ ë‹«ê¸°
     */
    function closeEditEmployeeModal() {
      const modal = document.getElementById('editEmployeeModal');
      modal.style.display = 'none';
      
      // í¼ ì´ˆê¸°í™”
      document.getElementById('editEmployeeForm').reset();
      
      // ë©”ì‹œì§€ ì´ˆê¸°í™”
      const messageDiv = document.getElementById('editEmployeeMessage');
      messageDiv.style.display = 'none';
    }

    /**
     * ğŸ“§ ìˆ˜ì • ëª¨ë‹¬ ë‚´ ë©”ì‹œì§€ í‘œì‹œ
     */
    function showEditEmployeeMessage(message, type) {
      const messageDiv = document.getElementById('editEmployeeMessage');
      messageDiv.textContent = message;
      messageDiv.className = 'alert';
      
      if (type === 'success') {
        messageDiv.classList.add('alert-success');
      } else if (type === 'error') {
        messageDiv.classList.add('alert-error');
      }
      
      messageDiv.style.display = 'block';
      
      // ìë™ ìˆ¨ê¹€ (ì„±ê³µ ë©”ì‹œì§€ê°€ ì•„ë‹Œ ê²½ìš°)
      if (type !== 'success') {
        setTimeout(() => {
          messageDiv.style.display = 'none';
        }, 5000);
      }
    }

    /**
     * ğŸ—‘ï¸ ì§ì› ì‚­ì œ (2ë‹¨ê³„ í™•ì¸)
     */
    async function deleteEmployee(empId) {
      try {
        // í•´ë‹¹ ì§ì› ì •ë³´ ì°¾ê¸°
        const employee = allEmployees.find(emp => emp.empId === empId);
        if (!employee) {
          showNotification('ì§ì› ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
          return;
        }
        
        // 1ë‹¨ê³„ í™•ì¸
        const firstConfirm = confirm(
          `âš ï¸ ì§ì› ì‚­ì œ í™•ì¸\n\n` +
          `ì‚¬ë²ˆ: ${employee.empId}\n` +
          `ì´ë¦„: ${employee.name}\n` +
          `ì´ë©”ì¼: ${employee.email}\n\n` +
          `ì •ë§ë¡œ ì´ ì§ì›ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`
        );
        
        if (!firstConfirm) {
          return;
        }
        
        // 2ë‹¨ê³„ í™•ì¸ (ì•ˆì „ì¥ì¹˜)
        const secondConfirm = confirm(
          `ğŸš¨ ìµœì¢… í™•ì¸\n\n` +
          `"${employee.name}" ì§ì›ì„ ì‚­ì œí•˜ë©´ ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n` +
          `ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\n` +
          `ì‚­ì œí•˜ë ¤ë©´ "í™•ì¸"ì„ í´ë¦­í•˜ì„¸ìš”.`
        );
        
        if (!secondConfirm) {
          return;
        }
        
        // ë¡œë”© í‘œì‹œ
        showLoading(true);
        
        // ì„œë²„ì— ì‚­ì œ ìš”ì²­
        const result = await callServerFunction('deleteEmployee', empId);
        
        if (result.success) {
          showNotification(`${employee.name} ì§ì›ì´ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
          
          // ì§ì› ëª©ë¡ ìƒˆë¡œê³ ì¹¨
          await refreshEmployeeList();
          
          // ê²€ìƒ‰ì°½ ì´ˆê¸°í™”
          clearEmployeeSearch();
          
        } else {
          showNotification('ì§ì› ì‚­ì œ ì‹¤íŒ¨: ' + result.error, 'error');
        }
        
      } catch (error) {
        console.error('âŒ ì§ì› ì‚­ì œ ì˜¤ë¥˜:', error);
        showNotification('ì§ì› ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
      } finally {
        showLoading(false);
      }
    }

    /**
     * âœï¸ ë¶€ì„œ ìˆ˜ì • ëª¨ë‹¬ ì—´ê¸°
     */
    async function editDepartment(deptId) {
      try {
        console.log('ğŸ¢ ë¶€ì„œ ìˆ˜ì • ëª¨ë‹¬ ì—´ê¸°:', deptId);
        
        // í•´ë‹¹ ë¶€ì„œ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        const department = await callServerFunction('getDepartmentById', deptId);
        if (!department) {
          showNotification('ë¶€ì„œ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
          return;
        }
        
        // ëª¨ë‹¬ í•„ë“œì— ê¸°ì¡´ ë°ì´í„° ì±„ìš°ê¸°
        document.getElementById('editDeptId').value = department.deptId;
        document.getElementById('editDeptName').value = department.deptName;
        
        // ëª¨ë‹¬ ì—´ê¸°
        const modal = document.getElementById('editDepartmentModal');
        modal.style.display = 'flex';
        
        // ë©”ì‹œì§€ ì´ˆê¸°í™”
        const messageDiv = document.getElementById('editDepartmentMessage');
        messageDiv.style.display = 'none';
        
        console.log('âœ… ë¶€ì„œ ìˆ˜ì • ëª¨ë‹¬ ì—´ê¸° ì™„ë£Œ');
      } catch (error) {
        console.error('âŒ ë¶€ì„œ ìˆ˜ì • ëª¨ë‹¬ ì—´ê¸° ì˜¤ë¥˜:', error);
        showNotification('ë¶€ì„œ ìˆ˜ì • ëª¨ë‹¬ì„ ì—´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
      }
    }

    /**
     * ğŸš« ë¶€ì„œ ìˆ˜ì • ëª¨ë‹¬ ë‹«ê¸° (ê´€ë¦¬ì ì „ìš©)
     */
    function closeEditDepartmentModal() {
      // ì¼ë°˜ ì§ì›ì—ê²ŒëŠ” ë¶ˆí•„ìš”í•œ ê¸°ëŠ¥ì´ë¯€ë¡œ ë¹ˆ í•¨ìˆ˜ë¡œ ì²˜ë¦¬
      console.log('ë¶€ì„œ ìˆ˜ì • ëª¨ë‹¬ ë‹«ê¸° (ê´€ë¦¬ì ì „ìš© ê¸°ëŠ¥)');
    }

    /**
     * ğŸ’¾ ë¶€ì„œ ì •ë³´ ë³€ê²½ì‚¬í•­ ì €ì¥ (ê´€ë¦¬ì ì „ìš©)
     */
    async function saveDepartmentChanges() {
      // ì¼ë°˜ ì§ì›ì—ê²ŒëŠ” ë¶ˆí•„ìš”í•œ ê¸°ëŠ¥ì´ë¯€ë¡œ ë¹ˆ í•¨ìˆ˜ë¡œ ì²˜ë¦¬
      console.log('ë¶€ì„œ ì •ë³´ ì €ì¥ (ê´€ë¦¬ì ì „ìš© ê¸°ëŠ¥)');
    }

    /**
     * ğŸ“§ ë¶€ì„œ ìˆ˜ì • ëª¨ë‹¬ ë‚´ ë©”ì‹œì§€ í‘œì‹œ (ê´€ë¦¬ì ì „ìš©)
     */
    function showEditDepartmentMessage(message, type) {
      // ì¼ë°˜ ì§ì›ì—ê²ŒëŠ” ë¶ˆí•„ìš”í•œ ê¸°ëŠ¥ì´ë¯€ë¡œ ë¹ˆ í•¨ìˆ˜ë¡œ ì²˜ë¦¬
      console.log('ë¶€ì„œ ìˆ˜ì • ë©”ì‹œì§€ (ê´€ë¦¬ì ì „ìš© ê¸°ëŠ¥):', message, type);
    }

    /**
     * ğŸ—‘ï¸ ë¶€ì„œ ì‚­ì œ (ìŠ¤ë§ˆíŠ¸ ì•ˆì „ì¥ì¹˜)
     */
    async function deleteDepartment(deptId, deptName, employeeCount) {
      try {
        console.log('ğŸ—‘ï¸ ë¶€ì„œ ì‚­ì œ ìš”ì²­:', deptId, deptName, employeeCount);
        
        // ì†Œì† ì§ì›ì´ ìˆëŠ”ì§€ í™•ì¸
        if (employeeCount > 0) {
          alert(
            `âš ï¸ ë¶€ì„œ ì‚­ì œ ë¶ˆê°€\n\n` +
            `ë¶€ì„œëª…: ${deptName}\n` +
            `ì†Œì† ì§ì›: ${employeeCount}ëª…\n\n` +
            `ì†Œì† ì§ì›ì´ ìˆëŠ” ë¶€ì„œëŠ” ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n` +
            `ë¨¼ì € ì†Œì† ì§ì›ë“¤ì„ ë‹¤ë¥¸ ë¶€ì„œë¡œ ì´ë™ì‹œí‚¨ í›„ ì‚­ì œí•´ì£¼ì„¸ìš”.`
          );
          return;
        }
        
        // 1ë‹¨ê³„ í™•ì¸
        const firstConfirm = confirm(
          `âš ï¸ ë¶€ì„œ ì‚­ì œ í™•ì¸\n\n` +
          `ë¶€ì„œì½”ë“œ: ${deptId}\n` +
          `ë¶€ì„œëª…: ${deptName}\n` +
          `ì†Œì† ì§ì›: ${employeeCount}ëª…\n\n` +
          `ì •ë§ë¡œ ì´ ë¶€ì„œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`
        );
        
        if (!firstConfirm) {
          return;
        }
        
        // 2ë‹¨ê³„ í™•ì¸ (ì•ˆì „ì¥ì¹˜)
        const secondConfirm = confirm(
          `ğŸš¨ ìµœì¢… í™•ì¸\n\n` +
          `"${deptName}" ë¶€ì„œë¥¼ ì‚­ì œí•˜ë©´ ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n` +
          `ë¶€ì„œ ê´€ë ¨ ëª¨ë“  ì´ë ¥ì´ í•¨ê»˜ ì‚­ì œë©ë‹ˆë‹¤.\n\n` +
          `ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\n` +
          `ì‚­ì œí•˜ë ¤ë©´ "í™•ì¸"ì„ í´ë¦­í•˜ì„¸ìš”.`
        );
        
        if (!secondConfirm) {
          return;
        }
        
        // ë¡œë”© í‘œì‹œ
        showLoading(true);
        
        // ì„œë²„ì— ì‚­ì œ ìš”ì²­
        const result = await callServerFunction('deleteDepartment', deptId);
        
        if (result.success) {
          showNotification(`${deptName} ë¶€ì„œê°€ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
          
          // ë¶€ì„œ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
          loadDepartmentManagement();
          
        } else {
          showNotification('ë¶€ì„œ ì‚­ì œ ì‹¤íŒ¨: ' + result.error, 'error');
        }
        
      } catch (error) {
        console.error('âŒ ë¶€ì„œ ì‚­ì œ ì˜¤ë¥˜:', error);
        showNotification('ë¶€ì„œ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
      } finally {
        showLoading(false);
      }
    }
    
    /**
     * ğŸ¯ ëª¨ë‹¬ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
     */
    document.addEventListener('DOMContentLoaded', function() {
      // ì§ì› ìˆ˜ì • ëª¨ë‹¬ ë°°ê²½ í´ë¦­ ì‹œ ë‹«ê¸°
      const editEmployeeModal = document.getElementById('editEmployeeModal');
      if (editEmployeeModal) {
        editEmployeeModal.addEventListener('click', function(event) {
          // ëª¨ë‹¬ ë°°ê²½(overlay)ì„ í´ë¦­í–ˆì„ ë•Œë§Œ ë‹«ê¸° (ëª¨ë‹¬ ë‚´ìš© í´ë¦­ ì‹œì—ëŠ” ë‹«ì§€ ì•ŠìŒ)
          if (event.target === editEmployeeModal) {
            closeEditEmployeeModal();
          }
        });
      }
      
      // ë¶€ì„œ ìˆ˜ì • ëª¨ë‹¬ ë°°ê²½ í´ë¦­ ì‹œ ë‹«ê¸°
      const editDepartmentModal = document.getElementById('editDepartmentModal');
      if (editDepartmentModal) {
        editDepartmentModal.addEventListener('click', function(event) {
          // ëª¨ë‹¬ ë°°ê²½(overlay)ì„ í´ë¦­í–ˆì„ ë•Œë§Œ ë‹«ê¸° (ëª¨ë‹¬ ë‚´ìš© í´ë¦­ ì‹œì—ëŠ” ë‹«ì§€ ì•ŠìŒ)
          if (event.target === editDepartmentModal) {
            closeEditDepartmentModal();
          }
        });
      }
      
      // ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸°
      document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
          // ì§ì› ìˆ˜ì • ëª¨ë‹¬ ë‹«ê¸°
          const empModal = document.getElementById('editEmployeeModal');
          if (empModal && empModal.style.display === 'flex') {
            closeEditEmployeeModal();
            return;
          }
          
          // ë¶€ì„œ ìˆ˜ì • ëª¨ë‹¬ ë‹«ê¸°
          const deptModal = document.getElementById('editDepartmentModal');
          if (deptModal && deptModal.style.display === 'flex') {
            closeEditDepartmentModal();
            return;
          }
        }
      });
    });
    
    // ===========================================
    // ğŸ¯ ë¶€ì„œ ê´€ë¦¬ ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì´ë²¤íŠ¸ ì²˜ë¦¬ í•¨ìˆ˜ë“¤
    // ===========================================
    
    // ë“œë˜ê·¸ ì¤‘ì¸ ì§ì› ì •ë³´ ì €ì¥ (ë¶€ì„œ ê´€ë¦¬ìš©)
    let deptDraggedEmployee = null;
    let deptDraggedCard = null;
    
    /**
     * ğŸ‘¤ ë¶€ì„œ ë³´ë“œìš© ì§ì› ì¹´ë“œ ë“œë˜ê·¸ ì´ë²¤íŠ¸ ì„¤ì •
     */
    function setupDepartmentCardDragEvents(card, employee) {
      // ë“œë˜ê·¸ ì‹œì‘
      card.addEventListener('dragstart', function(e) {
        console.log('ğŸ¯ ë¶€ì„œ ë³´ë“œ ë“œë˜ê·¸ ì‹œì‘:', employee.name);
        
        deptDraggedEmployee = employee;
        deptDraggedCard = card;
        
        // ë“œë˜ê·¸ ì¤‘ì¸ ì¹´ë“œ ìŠ¤íƒ€ì¼ ì ìš©
        card.classList.add('dragging');
        
        // ë“œë˜ê·¸ ë°ì´í„° ì„¤ì •
        e.dataTransfer.setData('text/plain', employee.empId);
        e.dataTransfer.effectAllowed = 'move';
        
        // ëª¨ë“  ì¹¼ëŸ¼ì— ë“œë¡­ ê°€ëŠ¥ ìƒíƒœ í‘œì‹œ
        document.querySelectorAll('#deptKanbanBoard .department-column').forEach(column => {
          column.classList.add('drop-available');
        });
      });
      
      // ë“œë˜ê·¸ ì¢…ë£Œ
      card.addEventListener('dragend', function(e) {
        console.log('ğŸ ë¶€ì„œ ë³´ë“œ ë“œë˜ê·¸ ì¢…ë£Œ');
        
        // ë“œë˜ê·¸ ìŠ¤íƒ€ì¼ ì œê±°
        card.classList.remove('dragging');
        
        // ëª¨ë“  ì¹¼ëŸ¼ì˜ ë“œë¡­ ìƒíƒœ ì œê±°
        document.querySelectorAll('#deptKanbanBoard .department-column').forEach(column => {
          column.classList.remove('drop-available', 'drag-over');
        });
        
        // ë“œë˜ê·¸ ìƒíƒœ ì´ˆê¸°í™”
        deptDraggedEmployee = null;
        deptDraggedCard = null;
      });
    }
    
    /**
     * ğŸ¢ ë¶€ì„œ ë³´ë“œìš© ì¹¼ëŸ¼ ë“œë¡­ ì´ë²¤íŠ¸ ì„¤ì •
     */
    function setupDepartmentColumnDropEvents(column, department) {
      // ë“œë˜ê·¸ ì˜¤ë²„ (ë“œë¡­ ì¡´ ìœ„ì— ìˆì„ ë•Œ)
      column.addEventListener('dragover', function(e) {
        e.preventDefault(); // ë“œë¡­ í—ˆìš©
        e.dataTransfer.dropEffect = 'move';
        
        // ê°™ì€ ë¶€ì„œì¸ì§€ í™•ì¸
        if (deptDraggedEmployee && deptDraggedEmployee.deptId !== department.deptId) {
          column.classList.add('drag-over');
        }
      });
      
      // ë“œë˜ê·¸ ì—”í„° (ë“œë¡­ ì¡´ì— ë“¤ì–´ê°ˆ ë•Œ)
      column.addEventListener('dragenter', function(e) {
        e.preventDefault();
        
        if (deptDraggedEmployee && deptDraggedEmployee.deptId !== department.deptId) {
          column.classList.add('drag-over');
        }
      });
      
      // ë“œë˜ê·¸ ë¦¬ë¸Œ (ë“œë¡­ ì¡´ì„ ë²—ì–´ë‚  ë•Œ)
      column.addEventListener('dragleave', function(e) {
        // ì¹¼ëŸ¼ ë‚´ë¶€ ìš”ì†Œë¡œ ì´ë™í•˜ëŠ” ê²½ìš°ëŠ” ì œì™¸
        if (!column.contains(e.relatedTarget)) {
          column.classList.remove('drag-over');
        }
      });
      
      // ë“œë¡­ (ì‹¤ì œ ë“œë¡­ ì‹œ)
      column.addEventListener('drop', function(e) {
        e.preventDefault();
        
        console.log('ğŸ¯ ë¶€ì„œ ë³´ë“œ ë“œë¡­ ì´ë²¤íŠ¸:', department.deptName);
        
        // ê°™ì€ ë¶€ì„œë¡œ ë“œë¡­í•˜ëŠ” ê²½ìš° ë¬´ì‹œ
        if (!deptDraggedEmployee || deptDraggedEmployee.deptId === department.deptId) {
          console.log('âš ï¸ ê°™ì€ ë¶€ì„œë¡œ ì´ë™ - ë¬´ì‹œ');
          return;
        }
        
        // ë¶€ì„œ ì´ë™ í™•ì¸ ë° ì²˜ë¦¬
        handleDepartmentEmployeeMove(deptDraggedEmployee, department);
        
        // ë“œë˜ê·¸ ì˜¤ë²„ ìŠ¤íƒ€ì¼ ì œê±°
        column.classList.remove('drag-over');
      });
    }
    
    /**
     * ğŸ”„ ë¶€ì„œ ë³´ë“œì—ì„œ ì§ì› ë¶€ì„œ ì´ë™ ì²˜ë¦¬
     */
    async function handleDepartmentEmployeeMove(employee, targetDepartment) {
      try {
        console.log('ğŸ”„ ë¶€ì„œ ë³´ë“œ ë¶€ì„œ ì´ë™ ì²˜ë¦¬:', employee.name, '->', targetDepartment.deptName);
        
        // í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸
        const confirmed = confirm(
          `ğŸ‘¤ ì§ì› ë¶€ì„œ ì´ë™ í™•ì¸\n\n` +
          `ì§ì›: ${employee.name} (${employee.empId})\n` +
          `í˜„ì¬ ë¶€ì„œ: ${employee.deptName || 'ë¯¸ì§€ì •'}\n` +
          `ì´ë™í•  ë¶€ì„œ: ${targetDepartment.deptName}\n\n` +
          `ì •ë§ë¡œ ë¶€ì„œë¥¼ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`
        );
        
        if (!confirmed) {
          console.log('ğŸš« ë¶€ì„œ ì´ë™ ì·¨ì†Œë¨');
          return;
        }
        
        // ë¡œë”© í‘œì‹œ
        showLoading(true);
        
        // ì„œë²„ì— ë¶€ì„œ ì´ë™ ìš”ì²­
        const result = await callServerFunction('moveEmployeeDepartment', {
          empId: employee.empId,
          newDeptId: targetDepartment.deptId
        });
        
        if (result.success) {
          showNotification(
            `${employee.name}ë‹˜ì´ ${targetDepartment.deptName}ìœ¼ë¡œ ì´ë™ë˜ì—ˆìŠµë‹ˆë‹¤.`, 
            'success'
          );
          
          // ë¶€ì„œ ë³´ë“œ ìƒˆë¡œê³ ì¹¨
          await refreshDepartmentBoard();
          
          // ë¶€ì„œ ëª©ë¡ë„ ìƒˆë¡œê³ ì¹¨ (ì†Œì† ì§ì› ìˆ˜ ì—…ë°ì´íŠ¸)
          await loadDepartmentManagement();
          
          // ì§ì› ëª©ë¡ë„ ìƒˆë¡œê³ ì¹¨ (ë™ê¸°í™”)
          if (typeof refreshEmployeeList === 'function') {
            await refreshEmployeeList();
          }
          
        } else {
          showNotification('ë¶€ì„œ ì´ë™ ì‹¤íŒ¨: ' + result.error, 'error');
        }
        
      } catch (error) {
        console.error('âŒ ë¶€ì„œ ì´ë™ ì˜¤ë¥˜:', error);
        showNotification('ë¶€ì„œ ì´ë™ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
      } finally {
        showLoading(false);
      }
    }
    
    // ë¶€ì„œ ê´€ë¦¬ í˜ì´ì§€ ë¡œë“œ ì‹œ ë³´ë“œ ì´ˆê¸°í™” ì—°ë™
    const originalLoadDepartmentManagement = loadDepartmentManagement;
    loadDepartmentManagement = async function() {
      await originalLoadDepartmentManagement();
      
      // ë³´ë“œ ë·°ê°€ í™œì„±í™”ëœ ê²½ìš° ë³´ë“œ ë°ì´í„°ë„ ë¡œë“œ
      const boardView = document.getElementById('departmentBoardView');
      if (boardView && boardView.classList.contains('active')) {
        await loadDepartmentBoard();
      }
    };

    // ì§ì› í•„í„°ë§ í•¨ìˆ˜
    function filterEmployees(searchTerm) {
      const employeeList = document.getElementById('employeeList');
      const items = employeeList.getElementsByClassName('employee-item');
      
      searchTerm = searchTerm.toLowerCase();
      
      for (const item of items) {
        const name = item.querySelector('.employee-name').textContent.toLowerCase();
        const dept = item.querySelector('.employee-dept').textContent.toLowerCase();
        const position = item.querySelector('.employee-position').textContent.toLowerCase();
        
        if (name.includes(searchTerm) || dept.includes(searchTerm) || position.includes(searchTerm)) {
          item.style.display = '';
        } else {
          item.style.display = 'none';
        }
      }
    }

    // ê²°ì¬ì ì„ íƒ ê´€ë ¨ í•¨ìˆ˜ë“¤
    function toggleLeaveApprover(empData) {
      const emp = typeof empData === 'string' ? JSON.parse(empData) : empData;
      const index = selectedApprovers.findIndex(a => a.empId === emp.empId);
      
      if (index === -1) {
        selectedApprovers.push(emp);
      } else {
        selectedApprovers.splice(index, 1);
      }
      
      // ì„ íƒ ìƒíƒœ UI ì—…ë°ì´íŠ¸
      const employeeItem = document.querySelector(`.employee-item[data-employee='${JSON.stringify(emp)}']`);
      if (employeeItem) {
        employeeItem.classList.toggle('selected');
      }
    }

    function closeApproverModal() {
      const modal = document.getElementById('approverModal');
      if (modal) {
        modal.remove();
      }
    }

    function confirmApprovers() {
      if (selectedApprovers.length === 0) {
        showNotification('ê²°ì¬ìë¥¼ í•œ ëª… ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”.', 'error');
        return;
      }
      
      // ì„ íƒëœ ê²°ì¬ì ëª©ë¡ ì—…ë°ì´íŠ¸
      updateSelectedApprovers();
      
      // ëª¨ë‹¬ ë‹«ê¸°
      closeApproverModal();
    }

    /**
     * ğŸ¤ í˜‘ì¡°ì ì„ íƒ ëª¨ë‹¬ ì—´ê¸°
     */
    async function openCollaboratorModal() {
      try {
        // ë¡œë”© í‘œì‹œ ì‹œì‘
        showLoading(true);

        // ì§ì› ëª©ë¡ ë¡œë“œ
        const employees = await callServerFunction('getEmployeesForWeb');
        if (!employees || !Array.isArray(employees)) {
          throw new Error('ì§ì› ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        }

        // í˜„ì¬ ì‚¬ìš©ì ID
        const currentUserId = document.getElementById('userEmpId')?.textContent;
        if (!currentUserId) {
          throw new Error('ì‚¬ìš©ì ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        }

        // ëª¨ë‹¬ ìƒì„± ë° ìŠ¤íƒ€ì¼ ì ìš©
        const modalHtml = `
          <div class="modal-overlay" id="collaboratorModal">
            <div class="modal-container" style="width: 80%; max-width: 800px; max-height: 80vh; margin: 10vh auto;">
              <div class="modal-header">
                <h3>í˜‘ì¡°ì ì„ íƒ</h3>
                <button class="close-button" onclick="closeCollaboratorModal()">Ã—</button>
              </div>
              <div class="modal-body" style="max-height: calc(80vh - 180px); overflow-y: auto;">
                <div class="search-box">
                  <input type="text" id="employeeSearchInput" placeholder="ì´ë¦„ ë˜ëŠ” ë¶€ì„œë¡œ ê²€ìƒ‰..." 
                         onkeyup="filterEmployees(this.value)">
                </div>
                <div id="employeeList" class="employee-list">
                  ${employees
                    .filter(emp => emp && emp.empId && emp.empId !== currentUserId)
                    .map(emp => `
                      <div class="employee-item ${selectedCollaborators.some(c => c.empId === emp.empId) ? 'selected' : ''}"
                           data-employee='${JSON.stringify(emp)}'
                           onclick="toggleLeaveCollaborator(this.dataset.employee)">
                        <div class="employee-info">
                          <div class="employee-name">${emp.name || 'ì´ë¦„ ì—†ìŒ'}</div>
                          <div class="employee-position">${emp.position || 'ì§ê¸‰ ë¯¸ì§€ì •'}</div>
                        </div>
                        <div class="employee-dept">${emp.deptName || 'ë¶€ì„œ ë¯¸ì§€ì •'}</div>
                      </div>
                    `).join('')}
                </div>
              </div>
              <div class="modal-footer">
                <button class="btn-modal btn-modal-secondary" onclick="closeCollaboratorModal()">ì·¨ì†Œ</button>
                <button class="btn-modal btn-modal-primary" onclick="confirmCollaborators()">í™•ì¸</button>
              </div>
            </div>
          </div>
        `;

        // ê¸°ì¡´ ëª¨ë‹¬ì´ ìˆë‹¤ë©´ ì œê±°
        const existingModal = document.getElementById('collaboratorModal');
        if (existingModal) {
          existingModal.remove();
        }

        // ìƒˆ ëª¨ë‹¬ ì¶”ê°€
        document.body.insertAdjacentHTML('beforeend', modalHtml);

      } catch (error) {
        console.error('í˜‘ì¡°ì ëª¨ë‹¬ ì˜¤ë¥˜:', error);
        showNotification('í˜‘ì¡°ì ì„ íƒ ëª¨ë‹¬ì„ ì—´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
      } finally {
        showLoading(false);
      }
    }

    /**
     * âœ… í˜‘ì¡°ì í† ê¸€ ì„ íƒ
     */
    function toggleLeaveCollaborator(empData) {
      const emp = typeof empData === 'string' ? JSON.parse(empData) : empData;
      const index = selectedCollaborators.findIndex(c => c.empId === emp.empId);
      
      if (index === -1) {
        selectedCollaborators.push(emp);
      } else {
        selectedCollaborators.splice(index, 1);
      }
      
      // ì„ íƒ ìƒíƒœ UI ì—…ë°ì´íŠ¸
      const employeeItem = document.querySelector(`.employee-item[data-employee='${JSON.stringify(emp)}']`);
      if (employeeItem) {
        employeeItem.classList.toggle('selected');
      }
    }

    /**
     * âŒ í˜‘ì¡°ì ì„ íƒ ëª¨ë‹¬ ë‹«ê¸°
     */
    function closeCollaboratorModal() {
      const modal = document.getElementById('collaboratorModal');
      if (modal) {
        modal.remove();
      }
    }

    /**
     * âœ… í˜‘ì¡°ì ì„ íƒ ì™„ë£Œ
     */
    function confirmCollaborators() {
      updateSelectedCollaborators();
      closeCollaboratorModal();
    }

    /**
     * ğŸ”§ ì‹œìŠ¤í…œ ì§„ë‹¨ ë„êµ¬
     */
    async function runSystemDiagnostics() {
      const diagnostics = {
        timestamp: new Date().toISOString(),
        currentUser: currentUser,
        googleScriptAvailable: typeof google !== 'undefined' && !!google.script,
        userAgent: navigator.userAgent,
        url: window.location.href,
        checks: []
      };

      // 1. ì‚¬ìš©ì ì •ë³´ í™•ì¸
      const userCheck = {
        test: 'ì‚¬ìš©ì ì •ë³´ ë¡œë“œ',
        passed: false,
        message: '',
        details: null
      };

      try {
        if (currentUser && currentUser.empId && currentUser.empId !== 'UNKNOWN' && currentUser.empId !== 'ERROR') {
          userCheck.passed = true;
          userCheck.message = 'ì‚¬ìš©ì ì •ë³´ ì •ìƒ';
          userCheck.details = currentUser;
        } else {
          userCheck.message = 'ì‚¬ìš©ì ì •ë³´ ì˜¤ë¥˜: ' + JSON.stringify(currentUser);
        }
      } catch (error) {
        userCheck.message = 'ì‚¬ìš©ì ì •ë³´ í™•ì¸ ì‹¤íŒ¨: ' + error.message;
      }
      diagnostics.checks.push(userCheck);

      // 2. Google Apps Script í™˜ê²½ í™•ì¸
      const gasCheck = {
        test: 'Google Apps Script í™˜ê²½',
        passed: false,
        message: '',
        details: null
      };

      try {
        if (typeof google !== 'undefined' && google.script && google.script.run) {
          gasCheck.passed = true;
          gasCheck.message = 'Google Apps Script í™˜ê²½ ì •ìƒ';
          gasCheck.details = {
            googleDefined: typeof google !== 'undefined',
            scriptDefined: !!google.script,
            runDefined: !!google.script.run
          };
        } else {
          gasCheck.message = 'Google Apps Script í™˜ê²½ ì˜¤ë¥˜';
          gasCheck.details = {
            googleDefined: typeof google !== 'undefined',
            scriptDefined: typeof google !== 'undefined' && !!google.script,
            runDefined: typeof google !== 'undefined' && !!google.script && !!google.script.run
          };
        }
      } catch (error) {
        gasCheck.message = 'Google Apps Script í™˜ê²½ í™•ì¸ ì‹¤íŒ¨: ' + error.message;
      }
      diagnostics.checks.push(gasCheck);

      // 3. ì„œë²„ í•¨ìˆ˜ í…ŒìŠ¤íŠ¸
      const serverCheck = {
        test: 'ì„œë²„ í•¨ìˆ˜ í˜¸ì¶œ',
        passed: false,
        message: '',
        details: null
      };

      try {
        const testResult = await callServerFunction('getMyRequests', currentUser.empId);
        serverCheck.passed = true;
        serverCheck.message = 'ì„œë²„ í•¨ìˆ˜ í˜¸ì¶œ ì„±ê³µ';
        serverCheck.details = {
          resultType: typeof testResult,
          isArray: Array.isArray(testResult),
          length: testResult ? testResult.length : 0
        };
      } catch (error) {
        serverCheck.message = 'ì„œë²„ í•¨ìˆ˜ í˜¸ì¶œ ì‹¤íŒ¨: ' + error.message;
        serverCheck.details = { error: error.toString() };
      }
      diagnostics.checks.push(serverCheck);

      // 4. ì‹œíŠ¸ êµ¬ì¡° í™•ì¸
      const sheetCheck = {
        test: 'ì‹œíŠ¸ êµ¬ì¡° í™•ì¸',
        passed: false,
        message: '',
        details: null
      };

      try {
        const sheetInfo = await callServerFunction('debugLeaveRequestsSheet');
        if (sheetInfo && !sheetInfo.error) {
          sheetCheck.passed = true;
          sheetCheck.message = `ì‹œíŠ¸ êµ¬ì¡° í™•ì¸ ì„±ê³µ - ì´ ${sheetInfo.totalRows}í–‰, ${sheetInfo.totalCols}ì—´`;
          sheetCheck.details = sheetInfo;
        } else {
          sheetCheck.message = 'ì‹œíŠ¸ êµ¬ì¡° í™•ì¸ ì‹¤íŒ¨: ' + (sheetInfo.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜');
          sheetCheck.details = sheetInfo;
        }
      } catch (error) {
        sheetCheck.message = 'ì‹œíŠ¸ êµ¬ì¡° í™•ì¸ ì‹¤íŒ¨: ' + error.message;
        sheetCheck.details = { error: error.toString() };
      }
      diagnostics.checks.push(sheetCheck);

      // ê²°ê³¼ ì¶œë ¥
      console.log('ğŸ”§ ì‹œìŠ¤í…œ ì§„ë‹¨ ê²°ê³¼:', diagnostics);
      
      // ì§„ë‹¨ ê²°ê³¼ í‘œì‹œ
      const summary = diagnostics.checks.map(check => 
        `${check.passed ? 'âœ…' : 'âŒ'} ${check.test}: ${check.message}`
      ).join('\n');
      
      const alert_message = `ì‹œìŠ¤í…œ ì§„ë‹¨ ì™„ë£Œ\n\n${summary}\n\nìì„¸í•œ ë‚´ìš©ì€ ì½˜ì†”ì„ í™•ì¸í•˜ì„¸ìš”.`;
      alert(alert_message);
      
      return diagnostics;
    }

    /**
     * ğŸ” ë¹ ë¥¸ ì‹œíŠ¸ ë””ë²„ê¹…
     */
    async function quickSheetDebug() {
      try {
        console.log('ğŸ” ë¹ ë¥¸ ì‹œíŠ¸ ë””ë²„ê¹… ì‹œì‘...');
        
        // ì‹œíŠ¸ êµ¬ì¡° í™•ì¸
        const sheetInfo = await callServerFunction('debugLeaveRequestsSheet');
        console.log('ğŸ“Š ì‹œíŠ¸ ì •ë³´:', sheetInfo);
        
        // ë‚´ ì‹ ì²­ í˜„í™© ë‹¤ì‹œ ì¡°íšŒ
        const myRequests = await callServerFunction('getMyRequests', currentUser.empId);
        console.log('ğŸ“‹ ë‚´ ì‹ ì²­ í˜„í™©:', myRequests);
        
        // ìš”ì•½ ì •ë³´ í‘œì‹œ
        const summary = `
=== ğŸ” ë¹ ë¥¸ ì‹œíŠ¸ ë””ë²„ê¹… ê²°ê³¼ ===

ğŸ“Š ì‹œíŠ¸ ê¸°ë³¸ ì •ë³´:
- ì´ í–‰ ìˆ˜: ${sheetInfo.totalRows}
- ì´ ì—´ ìˆ˜: ${sheetInfo.totalCols}
- í—¤ë”: ${JSON.stringify(sheetInfo.header)}

ğŸ“‹ ë‚´ ì‹ ì²­ í˜„í™©:
- íƒ€ì…: ${typeof myRequests}
- ë°°ì—´ ì—¬ë¶€: ${Array.isArray(myRequests)}
- ê¸¸ì´: ${myRequests ? myRequests.length : 'N/A'}

ğŸ“Š í˜„ì¬ ì‚¬ìš©ì ì •ë³´:
- ì§ì›ID: ${currentUser.empId}
- ì´ë¦„: ${currentUser.name}

ìì„¸í•œ ë‚´ìš©ì€ ì½˜ì†”ì„ í™•ì¸í•˜ì„¸ìš”.
        `;
        
        console.log(summary);
        alert(summary);
        
        return {
          sheetInfo,
          myRequests,
          currentUser
        };
      } catch (error) {
        console.error('âŒ ë¹ ë¥¸ ì‹œíŠ¸ ë””ë²„ê¹… ì˜¤ë¥˜:', error);
        alert('ë¹ ë¥¸ ì‹œíŠ¸ ë””ë²„ê¹… ì‹¤íŒ¨: ' + error.message);
        return null;
      }
    }

    /**
     * ğŸš¨ ì½”ë“œ ì—…ë°ì´íŠ¸ í™•ì¸ í•¨ìˆ˜
     */
    async function checkCodeUpdate() {
      try {
        console.log('ğŸš¨ ì½”ë“œ ì—…ë°ì´íŠ¸ í™•ì¸ ì‹œì‘...');
        
        const result = await new Promise((resolve, reject) => {
          const timeoutId = setTimeout(() => {
            reject(new Error('ì½”ë“œ ì—…ë°ì´íŠ¸ í™•ì¸ ì‹œê°„ ì´ˆê³¼'));
          }, 10000);
          
          google.script.run
            .withSuccessHandler((result) => {
              clearTimeout(timeoutId);
              resolve(result);
            })
            .withFailureHandler((error) => {
              clearTimeout(timeoutId);
              reject(new Error(error.toString()));
            })
            .checkCodeUpdate();
        });
        
        console.log('âœ… ì½”ë“œ ì—…ë°ì´íŠ¸ í™•ì¸ ê²°ê³¼:', result);
        
        const message = `
=== ğŸš¨ ì½”ë“œ ì—…ë°ì´íŠ¸ í™•ì¸ ê²°ê³¼ ===

âœ… ${result.message}
ğŸ“… ì—…ë°ì´íŠ¸ ì‹œê°„: ${result.timestamp}
ğŸ”¢ ë²„ì „: ${result.version}

ì´ì œ ë‚´ì‹ ì²­ í˜„í™©ì´ ì •ìƒ ì‘ë™í•  ê²ƒì…ë‹ˆë‹¤!
        `;
        
        console.log(message);
        alert(message);
        
        return result;
      } catch (error) {
        console.error('âŒ ì½”ë“œ ì—…ë°ì´íŠ¸ í™•ì¸ ì‹¤íŒ¨:', error);
        
        const message = `
âŒ ì½”ë“œ ì—…ë°ì´íŠ¸ í™•ì¸ ì‹¤íŒ¨

ì˜¤ë¥˜: ${error.message}

í•´ê²° ë°©ë²•:
1. Google Apps Script ì—ë””í„°ì—ì„œ ì €ì¥ (Ctrl+S)
2. ìƒˆ ë²„ì „ìœ¼ë¡œ ì¬ë°°í¬
3. ì›¹ ì•± í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
        `;
        
        console.log(message);
        alert(message);
        
        return null;
      }
    }

    /**
     * ğŸ§ª ê°„ë‹¨í•œ ì„œë²„ í†µì‹  í…ŒìŠ¤íŠ¸
     */
    async function testServerConnection() {
      try {
        console.log('ğŸ§ª ì„œë²„ í†µì‹  í…ŒìŠ¤íŠ¸ ì‹œì‘...');
        
        const result = await new Promise((resolve, reject) => {
          const timeoutId = setTimeout(() => {
            reject(new Error('ì„œë²„ ì‘ë‹µ ì‹œê°„ ì´ˆê³¼'));
          }, 15000);
          
          google.script.run
            .withSuccessHandler((result) => {
              clearTimeout(timeoutId);
              resolve(result);
            })
            .withFailureHandler((error) => {
              clearTimeout(timeoutId);
              reject(new Error(error.toString()));
            })
            .testServerConnection();
        });
        
        console.log('âœ… ì„œë²„ í†µì‹  í…ŒìŠ¤íŠ¸ ì„±ê³µ:', result);
        alert(`âœ… ì„œë²„ í†µì‹  ì„±ê³µ!\n${result.message}\nì‹œê°„: ${result.timestamp}`);
        return result;
      } catch (error) {
        console.error('âŒ ì„œë²„ í†µì‹  í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨:', error);
        alert(`âŒ ì„œë²„ í†µì‹  ì‹¤íŒ¨!\n${error.message}`);
        return null;
      }
    }

    /**
     * ğŸ§ª í˜„ì¬ ì„¸ì…˜ ìƒíƒœ í™•ì¸
     */
    async function testCurrentSession() {
      try {
        console.log('ğŸ§ª ì„¸ì…˜ ìƒíƒœ í™•ì¸ ì‹œì‘...');
        
        const result = await new Promise((resolve, reject) => {
          const timeoutId = setTimeout(() => {
            reject(new Error('ì„¸ì…˜ í™•ì¸ ì‹œê°„ ì´ˆê³¼'));
          }, 15000);
          
          google.script.run
            .withSuccessHandler((result) => {
              clearTimeout(timeoutId);
              resolve(result);
            })
            .withFailureHandler((error) => {
              clearTimeout(timeoutId);
              reject(new Error(error.toString()));
            })
            .getCurrentSessionStatus();
        });
        
        console.log('âœ… ì„¸ì…˜ ìƒíƒœ í™•ì¸ ì„±ê³µ:', result);
        
        if (result.success) {
          const message = `
âœ… ì„¸ì…˜ ìƒíƒœ í™•ì¸ ì„±ê³µ!

ğŸ“‹ ì„¸ì…˜ ì •ë³´:
- ì„¸ì…˜ ì¡´ì¬: ${result.hasSession ? 'Yes' : 'No'}
- ì‚¬ìš©ì íƒ€ì…: ${result.sessionType || 'N/A'}
- ì§ì› ID: ${result.empId || 'N/A'}
- ê´€ë¦¬ì ID: ${result.adminId || 'N/A'}
- í™•ì¸ ì‹œê°„: ${result.timestamp}
          `;
          alert(message);
        } else {
          alert(`âŒ ì„¸ì…˜ ìƒíƒœ í™•ì¸ ì‹¤íŒ¨!\n${result.error}`);
        }
        
        return result;
      } catch (error) {
        console.error('âŒ ì„¸ì…˜ ìƒíƒœ í™•ì¸ ì‹¤íŒ¨:', error);
        alert(`âŒ ì„¸ì…˜ ìƒíƒœ í™•ì¸ ì‹¤íŒ¨!\n${error.message}`);
        return null;
      }
    }

    /**
     * ğŸ§ª LeaveRequests ì‹œíŠ¸ ìƒíƒœ í™•ì¸
     */
    async function testLeaveRequestsSheet() {
      try {
        console.log('ğŸ§ª LeaveRequests ì‹œíŠ¸ ìƒíƒœ í™•ì¸ ì‹œì‘...');
        
        const result = await new Promise((resolve, reject) => {
          const timeoutId = setTimeout(() => {
            reject(new Error('ì‹œíŠ¸ í™•ì¸ ì‹œê°„ ì´ˆê³¼'));
          }, 15000);
          
          google.script.run
            .withSuccessHandler((result) => {
              clearTimeout(timeoutId);
              resolve(result);
            })
            .withFailureHandler((error) => {
              clearTimeout(timeoutId);
              reject(new Error(error.toString()));
            })
            .checkLeaveRequestsSheet();
        });
        
        console.log('âœ… LeaveRequests ì‹œíŠ¸ ìƒíƒœ í™•ì¸ ì„±ê³µ:', result);
        
        if (result.success) {
          const message = `
âœ… LeaveRequests ì‹œíŠ¸ ìƒíƒœ í™•ì¸ ì„±ê³µ!

ğŸ“Š ì‹œíŠ¸ ì •ë³´:
- ì‹œíŠ¸ ì¡´ì¬: ${result.sheetExists ? 'Yes' : 'No'}
- ì´ í–‰ ìˆ˜: ${result.totalRows}
- í—¤ë”: ${JSON.stringify(result.headerRow)}
- ë°ì´í„° í–‰ ìˆ˜: ${result.totalRows - 1}
- í™•ì¸ ì‹œê°„: ${result.timestamp}

ğŸ“‹ ìƒ˜í”Œ ë°ì´í„°:
${JSON.stringify(result.sampleDataRows, null, 2)}
          `;
          alert(message);
        } else {
          alert(`âŒ LeaveRequests ì‹œíŠ¸ ìƒíƒœ í™•ì¸ ì‹¤íŒ¨!\n${result.error}`);
        }
        
        return result;
      } catch (error) {
        console.error('âŒ LeaveRequests ì‹œíŠ¸ ìƒíƒœ í™•ì¸ ì‹¤íŒ¨:', error);
        alert(`âŒ LeaveRequests ì‹œíŠ¸ ìƒíƒœ í™•ì¸ ì‹¤íŒ¨!\n${error.message}`);
        return null;
      }
    }

    /**
     * ğŸ§ª ë‹¨ê³„ë³„ ì§„ë‹¨ ì‹¤í–‰
     */
    async function runStepByStepDiagnosis() {
      console.log('ğŸš€ ë‹¨ê³„ë³„ ì§„ë‹¨ ì‹œì‘...');
      
      const results = {
        step1: null,
        step2: null,
        step3: null,
        step4: null
      };
      
      // Step 1: ì„œë²„ í†µì‹  í…ŒìŠ¤íŠ¸
      console.log('ğŸ“ Step 1: ì„œë²„ í†µì‹  í…ŒìŠ¤íŠ¸');
      results.step1 = await testServerConnection();
      if (!results.step1) {
        alert('âŒ Step 1 ì‹¤íŒ¨: ì„œë²„ í†µì‹  ë¶ˆê°€ëŠ¥\nì›¹ì•±ì´ ì˜¬ë°”ë¥´ê²Œ ë°°í¬ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.');
        return results;
      }
      
      // Step 2: ì„¸ì…˜ ìƒíƒœ í™•ì¸
      console.log('ğŸ‘¤ Step 2: ì„¸ì…˜ ìƒíƒœ í™•ì¸');
      results.step2 = await testCurrentSession();
      if (!results.step2 || !results.step2.success || !results.step2.hasSession) {
        alert('âŒ Step 2 ì‹¤íŒ¨: ì„¸ì…˜ì´ ì—†ìŠµë‹ˆë‹¤\në¡œê·¸ì•„ì›ƒ í›„ ë‹¤ì‹œ ë¡œê·¸ì¸í•˜ì„¸ìš”.');
        return results;
      }
      
      // Step 3: ì‹œíŠ¸ ìƒíƒœ í™•ì¸
      console.log('ğŸ“Š Step 3: LeaveRequests ì‹œíŠ¸ ìƒíƒœ í™•ì¸');
      results.step3 = await testLeaveRequestsSheet();
      if (!results.step3 || !results.step3.success) {
        alert('âŒ Step 3 ì‹¤íŒ¨: LeaveRequests ì‹œíŠ¸ ë¬¸ì œ\nì‹œíŠ¸ê°€ ì¡´ì¬í•˜ê³  í—¤ë”ê°€ ì˜¬ë°”ë¥¸ì§€ í™•ì¸í•˜ì„¸ìš”.');
        return results;
      }
      
      // Step 4: getMyRequests í•¨ìˆ˜ í…ŒìŠ¤íŠ¸
      console.log('ğŸ” Step 4: getMyRequests í•¨ìˆ˜ í…ŒìŠ¤íŠ¸');
      try {
        const myRequests = await new Promise((resolve, reject) => {
          const timeoutId = setTimeout(() => {
            reject(new Error('getMyRequests í•¨ìˆ˜ ì‘ë‹µ ì‹œê°„ ì´ˆê³¼'));
          }, 30000);
          
          google.script.run
            .withSuccessHandler((result) => {
              clearTimeout(timeoutId);
              resolve(result);
            })
            .withFailureHandler((error) => {
              clearTimeout(timeoutId);
              reject(new Error(error.toString()));
            })
            .getMyRequests(currentUser.empId);
        });
        
        results.step4 = {
          success: true,
          result: myRequests,
          type: typeof myRequests,
          isArray: Array.isArray(myRequests),
          length: myRequests ? myRequests.length : 0
        };
        
        console.log('âœ… Step 4 ì„±ê³µ:', results.step4);
        
        const finalMessage = `
ğŸ‰ ëª¨ë“  ë‹¨ê³„ ì„±ê³µ!

ğŸ“Š getMyRequests ê²°ê³¼:
- íƒ€ì…: ${results.step4.type}
- ë°°ì—´ ì—¬ë¶€: ${results.step4.isArray}
- ë°ì´í„° ê°œìˆ˜: ${results.step4.length}

ì´ì œ "ë‚´ ì‹ ì²­ í˜„í™©"ì´ ì •ìƒ ì‘ë™í•  ê²ƒì…ë‹ˆë‹¤!
        `;
        
        alert(finalMessage);
      } catch (error) {
        console.error('âŒ Step 4 ì‹¤íŒ¨:', error);
        results.step4 = {
          success: false,
          error: error.message
        };
        
        alert(`âŒ Step 4 ì‹¤íŒ¨: getMyRequests í•¨ìˆ˜ ì˜¤ë¥˜\n${error.message}\n\nì•ì˜ 3ë‹¨ê³„ëŠ” ì„±ê³µí–ˆìœ¼ë¯€ë¡œ í•¨ìˆ˜ ë¡œì§ì— ë¬¸ì œê°€ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.`);
      }
      
      console.log('ğŸ¯ ì „ì²´ ì§„ë‹¨ ê²°ê³¼:', results);
      return results;
    }

    // ê°œë°œì ë„êµ¬ì—ì„œ ë°”ë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆë„ë¡ ì „ì—­ í•¨ìˆ˜ë¡œ ì„¤ì •
    window.runSystemDiagnostics = runSystemDiagnostics;
    window.loadMyRequests = loadMyRequests;
    window.quickSheetDebug = quickSheetDebug;
    window.checkCodeUpdate = checkCodeUpdate;
    window.testServerConnection = testServerConnection;
    window.testCurrentSession = testCurrentSession;
    window.testLeaveRequestsSheet = testLeaveRequestsSheet;
    window.runStepByStepDiagnosis = runStepByStepDiagnosis;
  </script>
</body>
</html> 